/*! For license information please see sdk.js.LICENSE.txt */
(()=>{var e={483:(e,t,n)=>{e.exports=function e(t,n,i){function a(o,s){if(!n[o]){if(!t[o]){if(r)return r(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}l=n[o]={exports:{}},t[o][0].call(l.exports,(function(e){return a(t[o][1][e]||e)}),l,l.exports,e,t,n,i)}return n[o].exports}for(var r=void 0,o=0;o<i.length;o++)a(i[o]);return a}({1:[function(e,t,i){(function(e){"use strict";var n,i,a,r,o=e.MutationObserver||e.WebKitMutationObserver,s=o?(n=0,o=new o(c),i=e.document.createTextNode(""),o.observe(i,{characterData:!0}),function(){i.data=n=++n%2}):e.setImmediate||void 0===e.MessageChannel?"document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){c(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(c,0)}:((a=new e.MessageChannel).port1.onmessage=c,function(){a.port2.postMessage(0)}),l=[];function c(){var e,t;r=!0;for(var n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}r=!1}t.exports=function(e){1!==l.push(e)||r||s()}}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],2:[function(e,t,n){"use strict";var i=e(1);function a(){}var r={},o=["REJECTED"],s=["FULFILLED"],l=["PENDING"];function c(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=l,this.queue=[],this.outcome=void 0,e!==a&&h(this,e)}function d(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function u(e,t,n){i((function(){var i;try{i=t(n)}catch(i){return r.reject(e,i)}i===e?r.reject(e,new TypeError("Cannot resolve promise with itself")):r.resolve(e,i)}))}function g(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function h(e,t){var n=!1;function i(t){n||(n=!0,r.reject(e,t))}function a(t){n||(n=!0,r.resolve(e,t))}var o=p((function(){t(a,i)}));"error"===o.status&&i(o.value)}function p(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}(t.exports=c).prototype.catch=function(e){return this.then(null,e)},c.prototype.then=function(e,t){if("function"!=typeof e&&this.state===s||"function"!=typeof t&&this.state===o)return this;var n=new this.constructor(a);return this.state!==l?u(n,this.state===s?e:t,this.outcome):this.queue.push(new d(n,e,t)),n},d.prototype.callFulfilled=function(e){r.resolve(this.promise,e)},d.prototype.otherCallFulfilled=function(e){u(this.promise,this.onFulfilled,e)},d.prototype.callRejected=function(e){r.reject(this.promise,e)},d.prototype.otherCallRejected=function(e){u(this.promise,this.onRejected,e)},r.resolve=function(e,t){var n=p(g,t);if("error"===n.status)return r.reject(e,n.value);if(n=n.value)h(e,n);else{e.state=s,e.outcome=t;for(var i=-1,a=e.queue.length;++i<a;)e.queue[i].callFulfilled(t)}return e},r.reject=function(e,t){e.state=o,e.outcome=t;for(var n=-1,i=e.queue.length;++n<i;)e.queue[n].callRejected(t);return e},c.resolve=function(e){return e instanceof this?e:r.resolve(new this(a),e)},c.reject=function(e){var t=new this(a);return r.reject(t,e)},c.all=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var o=new Array(n),s=0,l=-1,c=new this(a);++l<n;)!function(e,a){t.resolve(e).then((function(e){o[a]=e,++s!==n||i||(i=!0,r.resolve(c,o))}),(function(e){i||(i=!0,r.reject(c,e))}))}(e[l],l);return c},c.race=function(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var n=e.length,i=!1;if(!n)return this.resolve([]);for(var o=-1,s=new this(a);++o<n;)!function(e){t.resolve(e).then((function(e){i||(i=!0,r.resolve(s,e))}),(function(e){i||(i=!0,r.reject(s,e))}))}(e[o]);return s}},{1:1}],3:[function(e,t,i){(function(t){"use strict";"function"!=typeof t.Promise&&(t.Promise=e(2))}).call(this,void 0!==n.g?n.g:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2}],4:[function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){try{if("undefined"!=typeof indexedDB)return indexedDB;if("undefined"!=typeof webkitIndexedDB)return webkitIndexedDB;if("undefined"!=typeof mozIndexedDB)return mozIndexedDB;if("undefined"!=typeof OIndexedDB)return OIndexedDB;if("undefined"!=typeof msIndexedDB)return msIndexedDB}catch(e){return}}();function r(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(a){if("TypeError"!==a.name)throw a;for(var n=new("undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder),i=0;i<e.length;i+=1)n.append(e[i]);return n.getBlob(t.type)}}"undefined"==typeof Promise&&e(3);var o=Promise;function s(e,t){t&&e.then((function(e){t(null,e)}),(function(e){t(e)}))}function l(e,t,n){"function"==typeof t&&e.then(t),"function"==typeof n&&e.catch(n)}function c(e){return"string"!=typeof e&&(console.warn(e+" used as a key, but it is not a string."),e=String(e)),e}function d(){if(arguments.length&&"function"==typeof arguments[arguments.length-1])return arguments[arguments.length-1]}var u="local-forage-detect-blob-support",g=void 0,h={},p=Object.prototype.toString,m="readonly",f="readwrite";function S(e){return"boolean"==typeof g?o.resolve(g):(t=e,new o((function(e){var n=t.transaction(u,f),i=r([""]);n.objectStore(u).put(i,"key"),n.onabort=function(t){t.preventDefault(),t.stopPropagation(),e(!1)},n.oncomplete=function(){var t=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);e(n||!t||43<=parseInt(t[1],10))}})).catch((function(){return!1})).then((function(e){return g=e})));var t}function v(e){e=h[e.name];var t={};t.promise=new o((function(e,n){t.resolve=e,t.reject=n})),e.deferredOperations.push(t),e.dbReady?e.dbReady=e.dbReady.then((function(){return t.promise})):e.dbReady=t.promise}function E(e){return(e=h[e.name].deferredOperations.pop())&&(e.resolve(),e.promise)}function _(e,t){if(e=h[e.name].deferredOperations.pop())return e.reject(t),e.promise}function b(e,t){return new o((function(n,i){if(h[e.name]=h[e.name]||{forages:[],db:null,dbReady:null,deferredOperations:[]},e.db){if(!t)return n(e.db);v(e),e.db.close()}var r=[e.name];t&&r.push(e.version);var o=a.open.apply(a,r);t&&(o.onupgradeneeded=function(t){var n=o.result;try{n.createObjectStore(e.storeName),t.oldVersion<=1&&n.createObjectStore(u)}catch(n){if("ConstraintError"!==n.name)throw n;console.warn('The database "'+e.name+'" has been upgraded from version '+t.oldVersion+" to version "+t.newVersion+', but the storage "'+e.storeName+'" already exists.')}}),o.onerror=function(e){e.preventDefault(),i(o.error)},o.onsuccess=function(){n(o.result),E(e)}}))}function y(e){return b(e,!1)}function T(e){return b(e,!0)}function I(e,t){if(!e.db)return 1;var n=!e.db.objectStoreNames.contains(e.storeName),i=e.version<e.db.version,a=e.version>e.db.version;return i&&(e.version!==t&&console.warn('The database "'+e.name+"\" can't be downgraded from version "+e.db.version+" to version "+e.version+"."),e.version=e.db.version),(a||n)&&(!n||(n=e.db.version+1)>e.version&&(e.version=n),1)}function w(e){return r([function(e){for(var t=e.length,n=new ArrayBuffer(t),i=new Uint8Array(n),a=0;a<t;a++)i[a]=e.charCodeAt(a);return n}(atob(e.data))],{type:e.type})}function A(e){return e&&e.__local_forage_encoded_blob}function O(e){var t=this,n=t._initReady().then((function(){var e=h[t._dbInfo.name];if(e&&e.dbReady)return e.dbReady}));return l(n,e,e),n}function D(e,t,n,i){void 0===i&&(i=1);try{var a=e.db.transaction(e.storeName,t);n(null,a)}catch(a){if(0<i&&(!e.db||"InvalidStateError"===a.name||"NotFoundError"===a.name))return o.resolve().then((function(){if(!e.db||"NotFoundError"===a.name&&!e.db.objectStoreNames.contains(e.storeName)&&e.version<=e.db.version)return e.db&&(e.version=e.db.version+1),T(e)})).then((function(){return function(e){v(e);for(var t=h[e.name],n=t.forages,i=0;i<n.length;i++){var a=n[i];a._dbInfo.db&&(a._dbInfo.db.close(),a._dbInfo.db=null)}return e.db=null,y(e).then((function(t){return e.db=t,I(e)?T(e):t})).then((function(i){e.db=t.db=i;for(var a=0;a<n.length;a++)n[a]._dbInfo.db=i})).catch((function(t){throw _(e,t),t}))}(e).then((function(){D(e,t,n,i-1)}))})).catch(n);n(a)}}var C={_driver:"asyncStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var i in e)n[i]=e[i];var a=h[n.name];a||(a={forages:[],db:null,dbReady:null,deferredOperations:[]},h[n.name]=a),a.forages.push(t),t._initReady||(t._initReady=t.ready,t.ready=O);var r=[];function s(){return o.resolve()}for(var l=0;l<a.forages.length;l++){var c=a.forages[l];c!==t&&r.push(c._initReady().catch(s))}var d=a.forages.slice(0);return o.all(r).then((function(){return n.db=a.db,y(n)})).then((function(e){return n.db=e,I(n,t._defaultConfig.version)?T(n):e})).then((function(e){n.db=a.db=e,t._dbInfo=n;for(var i=0;i<d.length;i++){var r=d[i];r!==t&&(r._dbInfo.db=n.db,r._dbInfo.version=n.version)}}))},_support:function(){try{if(!a)return!1;var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t="function"==typeof fetch&&-1!==fetch.toString().indexOf("[native code");return(!e||t)&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange}catch(e){return!1}}(),iterate:function(e,t){var n=this,i=new o((function(t,i){n.ready().then((function(){D(n._dbInfo,m,(function(a,r){if(a)return i(a);try{var o=r.objectStore(n._dbInfo.storeName).openCursor(),s=1;o.onsuccess=function(){var n,i=o.result;i?(A(n=i.value)&&(n=w(n)),void 0!==(n=e(n,i.key,s++))?t(n):i.continue()):t()},o.onerror=function(){i(o.error)}}catch(a){i(a)}}))})).catch(i)}));return s(i,t),i},getItem:function(e,t){var n=this;e=c(e);var i=new o((function(t,i){n.ready().then((function(){D(n._dbInfo,m,(function(a,r){if(a)return i(a);try{var o=r.objectStore(n._dbInfo.storeName).get(e);o.onsuccess=function(){var e=o.result;A(e=void 0===e?null:e)&&(e=w(e)),t(e)},o.onerror=function(){i(o.error)}}catch(a){i(a)}}))})).catch(i)}));return s(i,t),i},setItem:function(e,t,n){var i=this;e=c(e);var a=new o((function(n,a){var r;i.ready().then((function(){return r=i._dbInfo,"[object Blob]"===p.call(t)?S(r.db).then((function(e){return e?t:(n=t,new o((function(e,t){var i=new FileReader;i.onerror=t,i.onloadend=function(t){t=btoa(t.target.result||""),e({__local_forage_encoded_blob:!0,data:t,type:n.type})},i.readAsBinaryString(n)})));var n})):t})).then((function(t){D(i._dbInfo,f,(function(r,o){if(r)return a(r);try{var s=o.objectStore(i._dbInfo.storeName);null===t&&(t=void 0);var l=s.put(t,e);o.oncomplete=function(){n(t=void 0===t?null:t)},o.onabort=o.onerror=function(){var e=l.error||l.transaction.error;a(e)}}catch(r){a(r)}}))})).catch(a)}));return s(a,n),a},removeItem:function(e,t){var n=this;e=c(e);var i=new o((function(t,i){n.ready().then((function(){D(n._dbInfo,f,(function(a,r){if(a)return i(a);try{var o=r.objectStore(n._dbInfo.storeName).delete(e);r.oncomplete=function(){t()},r.onerror=function(){i(o.error)},r.onabort=function(){var e=o.error||o.transaction.error;i(e)}}catch(a){i(a)}}))})).catch(i)}));return s(i,t),i},clear:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){D(t._dbInfo,f,(function(i,a){if(i)return n(i);try{var r=a.objectStore(t._dbInfo.storeName).clear();a.oncomplete=function(){e()},a.onabort=a.onerror=function(){var e=r.error||r.transaction.error;n(e)}}catch(i){n(i)}}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){D(t._dbInfo,m,(function(i,a){if(i)return n(i);try{var r=a.objectStore(t._dbInfo.storeName).count();r.onsuccess=function(){e(r.result)},r.onerror=function(){n(r.error)}}catch(i){n(i)}}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,i=new o((function(t,i){e<0?t(null):n.ready().then((function(){D(n._dbInfo,m,(function(a,r){if(a)return i(a);try{var o=r.objectStore(n._dbInfo.storeName),s=!1,l=o.openCursor();l.onsuccess=function(){var n=l.result;n?0===e||s?t(n.key):(s=!0,n.advance(e)):t(null)},l.onerror=function(){i(l.error)}}catch(a){i(a)}}))})).catch(i)}));return s(i,t),i},keys:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){D(t._dbInfo,m,(function(i,a){if(i)return n(i);try{var r=a.objectStore(t._dbInfo.storeName).openCursor(),o=[];r.onsuccess=function(){var t=r.result;t?(o.push(t.key),t.continue()):e(o)},r.onerror=function(){n(r.error)}}catch(i){n(i)}}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=d.apply(this,arguments);var n,i=this.config();return(e="function"!=typeof e&&e||{}).name||(e.name=e.name||i.name,e.storeName=e.storeName||i.storeName),s(n=e.name?(n=e.name===i.name&&this._dbInfo.db?o.resolve(this._dbInfo.db):y(e).then((function(t){var n=h[e.name],i=n.forages;n.db=t;for(var a=0;a<i.length;a++)i[a]._dbInfo.db=t;return t})),e.storeName?n.then((function(t){if(t.objectStoreNames.contains(e.storeName)){var n=t.version+1;v(e);var i=h[e.name],r=i.forages;t.close();for(var s=0;s<r.length;s++){var l=r[s];l._dbInfo.db=null,l._dbInfo.version=n}return new o((function(t,i){var r=a.open(e.name,n);r.onerror=function(e){r.result.close(),i(e)},r.onupgradeneeded=function(){r.result.deleteObjectStore(e.storeName)},r.onsuccess=function(){var e=r.result;e.close(),t(e)}})).then((function(e){i.db=e;for(var t=0;t<r.length;t++){var n=r[t];n._dbInfo.db=e,E(n._dbInfo)}})).catch((function(t){throw(_(e,t)||o.resolve()).catch((function(){})),t}))}})):n.then((function(t){v(e);var n=h[e.name],i=n.forages;t.close();for(var r=0;r<i.length;r++)i[r]._dbInfo.db=null;return new o((function(t,n){var i=a.deleteDatabase(e.name);i.onerror=i.onblocked=function(e){var t=i.result;t&&t.close(),n(e)},i.onsuccess=function(){var e=i.result;e&&e.close(),t(e)}})).then((function(e){n.db=e;for(var t=0;t<i.length;t++)E(i[t]._dbInfo)})).catch((function(t){throw(_(e,t)||o.resolve()).catch((function(){})),t}))}))):o.reject("Invalid arguments"),t),n}},N="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",R=/^~~local_forage_type~([^~]+)~/,k="__lfsc__:",P=k.length,L="arbf",M="blob",B=P+L.length,x=Object.prototype.toString;function W(e){var t,n,i,a,r=.75*e.length,o=e.length,s=0;"="===e[e.length-1]&&(r--,"="===e[e.length-2]&&r--),r=new ArrayBuffer(r);for(var l=new Uint8Array(r),c=0;c<o;c+=4)t=N.indexOf(e[c]),n=N.indexOf(e[c+1]),i=N.indexOf(e[c+2]),a=N.indexOf(e[c+3]),l[s++]=t<<2|n>>4,l[s++]=(15&n)<<4|i>>2,l[s++]=(3&i)<<6|63&a;return r}function U(e){for(var t=new Uint8Array(e),n="",i=0;i<t.length;i+=3)n+=N[t[i]>>2],n+=N[(3&t[i])<<4|t[i+1]>>4],n+=N[(15&t[i+1])<<2|t[i+2]>>6],n+=N[63&t[i+2]];return t.length%3==2?n=n.substring(0,n.length-1)+"=":t.length%3==1&&(n=n.substring(0,n.length-2)+"=="),n}var H={serialize:function(e,t){var n="";if(e&&(n=x.call(e)),e&&("[object ArrayBuffer]"===n||e.buffer&&"[object ArrayBuffer]"===x.call(e.buffer))){var i,a=k;e instanceof ArrayBuffer?(i=e,a+=L):(i=e.buffer,"[object Int8Array]"===n?a+="si08":"[object Uint8Array]"===n?a+="ui08":"[object Uint8ClampedArray]"===n?a+="uic8":"[object Int16Array]"===n?a+="si16":"[object Uint16Array]"===n?a+="ur16":"[object Int32Array]"===n?a+="si32":"[object Uint32Array]"===n?a+="ui32":"[object Float32Array]"===n?a+="fl32":"[object Float64Array]"===n?a+="fl64":t(new Error("Failed to get type for BinaryArray"))),t(a+U(i))}else if("[object Blob]"===n)(n=new FileReader).onload=function(){var n="~~local_forage_type~"+e.type+"~"+U(this.result);t(k+M+n)},n.readAsArrayBuffer(e);else try{t(JSON.stringify(e))}catch(n){console.error("Couldn't convert value into a JSON string: ",e),t(null,n)}},deserialize:function(e){if(e.substring(0,P)!==k)return JSON.parse(e);var t,n=e.substring(B),i=e.substring(P,B);i===M&&R.test(n)&&(t=(e=n.match(R))[1],n=n.substring(e[0].length));var a=W(n);switch(i){case L:return a;case M:return r([a],{type:t});case"si08":return new Int8Array(a);case"ui08":return new Uint8Array(a);case"uic8":return new Uint8ClampedArray(a);case"si16":return new Int16Array(a);case"ur16":return new Uint16Array(a);case"si32":return new Int32Array(a);case"ui32":return new Uint32Array(a);case"fl32":return new Float32Array(a);case"fl64":return new Float64Array(a);default:throw new Error("Unkown type: "+i)}},stringToBuffer:W,bufferToString:U};function F(e,t,n,i){e.executeSql("CREATE TABLE IF NOT EXISTS "+t.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],n,i)}function K(e,t,n,i,a,r){e.executeSql(n,i,a,(function(e,o){o.code===o.SYNTAX_ERR?e.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name = ?",[t.storeName],(function(e,s){s.rows.length?r(e,o):F(e,t,(function(){e.executeSql(n,i,a,r)}),r)}),r):r(e,o)}),r)}function j(e,t,n,i){var a=this;e=c(e);var r=new o((function(r,o){a.ready().then((function(){var s=t=void 0===t?null:t,l=a._dbInfo;l.serializer.serialize(t,(function(t,c){c?o(c):l.db.transaction((function(n){K(n,l,"INSERT OR REPLACE INTO "+l.storeName+" (key, value) VALUES (?, ?)",[e,t],(function(){r(s)}),(function(e,t){o(t)}))}),(function(t){t.code===t.QUOTA_ERR&&(0<i?r(j.apply(a,[e,s,n,i-1])):o(t))}))}))})).catch(o)}));return s(r,n),r}var G={_driver:"webSQLStorage",_initStorage:function(e){var t=this,n={db:null};if(e)for(var i in e)n[i]="string"!=typeof e[i]?e[i].toString():e[i];var a=new o((function(e,i){try{n.db=openDatabase(n.name,String(n.version),n.description,n.size)}catch(e){return i(e)}n.db.transaction((function(a){F(a,n,(function(){t._dbInfo=n,e()}),(function(e,t){i(t)}))}),i)}));return n.serializer=H,a},_support:"function"==typeof openDatabase,iterate:function(e,t){var n=this,i=new o((function(t,i){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){K(n,a,"SELECT * FROM "+a.storeName,[],(function(n,i){for(var r=i.rows,o=r.length,s=0;s<o;s++){var l=r.item(s),c=(c=l.value)&&a.serializer.deserialize(c);if(void 0!==(c=e(c,l.key,s+1)))return void t(c)}t()}),(function(e,t){i(t)}))}))})).catch(i)}));return s(i,t),i},getItem:function(e,t){var n=this;e=c(e);var i=new o((function(t,i){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){K(n,a,"SELECT * FROM "+a.storeName+" WHERE key = ? LIMIT 1",[e],(function(e,n){n=(n=n.rows.length?n.rows.item(0).value:null)&&a.serializer.deserialize(n),t(n)}),(function(e,t){i(t)}))}))})).catch(i)}));return s(i,t),i},setItem:function(e,t,n){return j.apply(this,[e,t,n,1])},removeItem:function(e,t){var n=this;e=c(e);var i=new o((function(t,i){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){K(n,a,"DELETE FROM "+a.storeName+" WHERE key = ?",[e],(function(){t()}),(function(e,t){i(t)}))}))})).catch(i)}));return s(i,t),i},clear:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var i=t._dbInfo;i.db.transaction((function(t){K(t,i,"DELETE FROM "+i.storeName,[],(function(){e()}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},length:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var i=t._dbInfo;i.db.transaction((function(t){K(t,i,"SELECT COUNT(key) as c FROM "+i.storeName,[],(function(t,n){n=n.rows.item(0).c,e(n)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},key:function(e,t){var n=this,i=new o((function(t,i){n.ready().then((function(){var a=n._dbInfo;a.db.transaction((function(n){K(n,a,"SELECT key FROM "+a.storeName+" WHERE id = ? LIMIT 1",[e+1],(function(e,n){n=n.rows.length?n.rows.item(0).key:null,t(n)}),(function(e,t){i(t)}))}))})).catch(i)}));return s(i,t),i},keys:function(e){var t=this,n=new o((function(e,n){t.ready().then((function(){var i=t._dbInfo;i.db.transaction((function(t){K(t,i,"SELECT key FROM "+i.storeName,[],(function(t,n){for(var i=[],a=0;a<n.rows.length;a++)i.push(n.rows.item(a).key);e(i)}),(function(e,t){n(t)}))}))})).catch(n)}));return s(n,e),n},dropInstance:function(e,t){t=d.apply(this,arguments);var n=this.config();(e="function"!=typeof e&&e||{}).name||(e.name=e.name||n.name,e.storeName=e.storeName||n.storeName);var i=this,a=e.name?new o((function(t){var a,r=e.name===n.name?i._dbInfo.db:openDatabase(e.name,"","",0);e.storeName?t({db:r,storeNames:[e.storeName]}):t((a=r,new o((function(e,t){a.transaction((function(n){n.executeSql("SELECT name FROM sqlite_master WHERE type='table' AND name <> '__WebKitDatabaseInfoTable__'",[],(function(t,n){for(var i=[],r=0;r<n.rows.length;r++)i.push(n.rows.item(r).name);e({db:a,storeNames:i})}),(function(e,n){t(n)}))}),(function(e){t(e)}))}))))})).then((function(e){return new o((function(t,n){e.db.transaction((function(i){for(var a=[],r=0,s=e.storeNames.length;r<s;r++)a.push(function(e){return new o((function(t,n){i.executeSql("DROP TABLE IF EXISTS "+e,[],(function(){t()}),(function(e,t){n(t)}))}))}(e.storeNames[r]));o.all(a).then((function(){t()})).catch((function(e){n(e)}))}),(function(e){n(e)}))}))})):o.reject("Invalid arguments");return s(a,t),a}};function V(e,t){var n=e.name+"/";return e.storeName!==t.storeName&&(n+=e.storeName+"/"),n}function Y(e,t){for(var n,i,a=e.length,r=0;r<a;){if((n=e[r])===(i=t)||"number"==typeof n&&"number"==typeof i&&isNaN(n)&&isNaN(i))return 1;r++}}e={_driver:"localStorageWrapper",_initStorage:function(e){var t={};if(e)for(var n in e)t[n]=e[n];return t.keyPrefix=V(e,this._defaultConfig),!function(){var e="_localforage_support_test";try{return localStorage.setItem(e,!0),void localStorage.removeItem(e)}catch(e){return 1}}()||0<localStorage.length?((this._dbInfo=t).serializer=H,o.resolve()):o.reject()},_support:function(){try{return"undefined"!=typeof localStorage&&"setItem"in localStorage&&!!localStorage.setItem}catch(e){return!1}}(),iterate:function(e,t){var n=this,i=n.ready().then((function(){for(var t=n._dbInfo,i=t.keyPrefix,a=i.length,r=localStorage.length,o=1,s=0;s<r;s++){var l=localStorage.key(s);if(0===l.indexOf(i)){var c=(c=localStorage.getItem(l))&&t.serializer.deserialize(c);if(void 0!==(c=e(c,l.substring(a),o++)))return c}}}));return s(i,t),i},getItem:function(e,t){var n=this;e=c(e);var i=n.ready().then((function(){var t=n._dbInfo,i=localStorage.getItem(t.keyPrefix+e);return i&&t.serializer.deserialize(i)}));return s(i,t),i},setItem:function(e,t,n){var i=this;e=c(e);var a=i.ready().then((function(){var n=t=void 0===t?null:t;return new o((function(a,r){var o=i._dbInfo;o.serializer.serialize(t,(function(t,i){if(i)r(i);else try{localStorage.setItem(o.keyPrefix+e,t),a(n)}catch(t){"QuotaExceededError"!==t.name&&"NS_ERROR_DOM_QUOTA_REACHED"!==t.name||r(t),r(t)}}))}))}));return s(a,n),a},removeItem:function(e,t){var n=this;e=c(e);var i=n.ready().then((function(){var t=n._dbInfo;localStorage.removeItem(t.keyPrefix+e)}));return s(i,t),i},clear:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo.keyPrefix,n=localStorage.length-1;0<=n;n--){var i=localStorage.key(n);0===i.indexOf(e)&&localStorage.removeItem(i)}}));return s(n,e),n},length:function(e){var t=this.keys().then((function(e){return e.length}));return s(t,e),t},key:function(e,t){var n=this,i=n.ready().then((function(){var t,i=n._dbInfo;try{t=localStorage.key(e)}catch(i){t=null}return t&&t.substring(i.keyPrefix.length)}));return s(i,t),i},keys:function(e){var t=this,n=t.ready().then((function(){for(var e=t._dbInfo,n=localStorage.length,i=[],a=0;a<n;a++){var r=localStorage.key(a);0===r.indexOf(e.keyPrefix)&&i.push(r.substring(e.keyPrefix.length))}return i}));return s(n,e),n},dropInstance:function(e,t){t=d.apply(this,arguments),(e="function"!=typeof e&&e||{}).name||(i=this.config(),e.name=e.name||i.name,e.storeName=e.storeName||i.storeName);var n=this,i=e.name?new o((function(t){e.storeName?t(V(e,n._defaultConfig)):t(e.name+"/")})).then((function(e){for(var t=localStorage.length-1;0<=t;t--){var n=localStorage.key(t);0===n.indexOf(e)&&localStorage.removeItem(n)}})):o.reject("Invalid arguments");return s(i,t),i}};var q=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},z={},X={},Q={INDEXEDDB:C,WEBSQL:G,LOCALSTORAGE:e},J=(e=[Q.INDEXEDDB._driver,Q.WEBSQL._driver,Q.LOCALSTORAGE._driver],["dropInstance"]),$=["clear","getItem","iterate","key","keys","length","removeItem","setItem"].concat(J),Z={description:"",driver:e.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1};function ee(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];if(n)for(var i in n)n.hasOwnProperty(i)&&(q(n[i])?e[i]=n[i].slice():e[i]=n[i])}return e}function te(e){for(var t in function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,te),Q){var n,i;Q.hasOwnProperty(t)&&(i=(n=Q[t])._driver,this[t]=i,z[i]||this.defineDriver(n))}this._defaultConfig=ee({},Z),this._config=ee({},this._defaultConfig,e),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver).catch((function(){}))}e=new(te.prototype.config=function(e){if("object"!==(void 0===e?"undefined":i(e)))return"string"==typeof e?this._config[e]:this._config;if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e){if("storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),"version"===t&&"number"!=typeof e[t])return new Error("Database version must be a number.");this._config[t]=e[t]}return!("driver"in e&&e.driver)||this.setDriver(this._config.driver)},te.prototype.defineDriver=function(e,t,n){var i=new o((function(t,n){try{var i=e._driver,a=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver");if(!e._driver)return void n(a);for(var r=$.concat("_initStorage"),l=0,c=r.length;l<c;l++){var d=r[l];if((!Y(J,d)||e[d])&&"function"!=typeof e[d])return void n(a)}!function(){for(var t=0,n=J.length;t<n;t++){var i=J[t];e[i]||(e[i]=function(e){return function(){var t=new Error("Method "+e+" is not implemented by the current driver");return s(t=o.reject(t),arguments[arguments.length-1]),t}}(i))}}();var u=function(n){z[i]&&console.info("Redefining LocalForage driver: "+i),z[i]=e,X[i]=n,t()};"_support"in e?e._support&&"function"==typeof e._support?e._support().then(u,n):u(!!e._support):u(!0)}catch(a){n(a)}}));return l(i,t,n),i},te.prototype.driver=function(){return this._driver||null},te.prototype.getDriver=function(e,t,n){return l(e=z[e]?o.resolve(z[e]):o.reject(new Error("Driver not found.")),t,n),e},te.prototype.getSerializer=function(e){var t=o.resolve(H);return l(t,e),t},te.prototype.ready=function(e){var t=this,n=t._driverSet.then((function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready}));return l(n,e,e),n},te.prototype.setDriver=function(e,t,n){var i=this;q(e)||(e=[e]);var a=this._getSupportedDrivers(e);function r(){i._config.driver=i.driver()}function s(e){return i._extend(e),r(),i._ready=i._initStorage(i._config),i._ready}return e=null!==this._driverSet?this._driverSet.catch((function(){return o.resolve()})):o.resolve(),this._driverSet=e.then((function(){var e=a[0];return i._dbInfo=null,i._ready=null,i.getDriver(e).then((function(e){i._driver=e._driver,r(),i._wrapLibraryMethodsWithReady(),i._initDriver=function(e){return function(){var t=0;return function n(){for(;t<e.length;){var a=e[t];return t++,i._dbInfo=null,i._ready=null,i.getDriver(a).then(s).catch(n)}r();var l=new Error("No available storage method found.");return i._driverSet=o.reject(l),i._driverSet}()}}(a)}))})).catch((function(){r();var e=new Error("No available storage method found.");return i._driverSet=o.reject(e),i._driverSet})),l(this._driverSet,t,n),this._driverSet},te.prototype.supports=function(e){return!!X[e]},te.prototype._extend=function(e){ee(this,e)},te.prototype._getSupportedDrivers=function(e){for(var t=[],n=0,i=e.length;n<i;n++){var a=e[n];this.supports(a)&&t.push(a)}return t},te.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0,t=$.length;e<t;e++)!function(e,t){e[t]=function(){var n=arguments;return e.ready().then((function(){return e[t].apply(e,n)}))}}(this,$[e])},te.prototype.createInstance=function(e){return new te(e)},te),t.exports=e},{3:3}]},{},[4])(4)},375:(e,t,n)=>{let i;e.exports="function"==typeof queueMicrotask?queueMicrotask.bind("undefined"!=typeof window?window:n.g):e=>(i=i||Promise.resolve()).then(e).catch((e=>setTimeout((()=>{throw e}),0)))},967:(e,t,n)=>{e.exports=function(e,t,n){if("number"!=typeof t)throw new Error("second argument must be a Number");let a,r,o,s,l,c,d=!0;function u(e){function t(){n&&n(e,a),n=null}d?i(t):t()}function g(t,n,i){if(a[t]=i,n&&(l=!0),0==--o||n)u(n);else if(!l&&c<r){let t;s?(t=s[c],c+=1,e[t]((function(e,n){g(t,e,n)}))):(t=c,c+=1,e[t]((function(e,n){g(t,e,n)})))}}o=r=Array.isArray(e)?(a=[],e.length):(s=Object.keys(e),a={},s.length),c=t,o?s?s.some((function(n,i){return e[n]((function(e,t){g(n,e,t)})),i===t-1})):e.some((function(e,n){return e((function(e,t){g(n,e,t)})),n===t-1})):u(null),d=!1};const i=n(375)},877:(e,t,n)=>{var i=n(570),a=n(171);(n=a).v1=i,n.v4=a,e.exports=n},327:e=>{for(var t=[],n=0;n<256;++n)t[n]=(n+256).toString(16).substr(1);e.exports=function(e,n){var i=n||0;return[(n=t)[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],"-",n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]],n[e[i++]],n[e[+i]]].join("")}},217:e=>{var t,n,i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);i?(t=new Uint8Array(16),e.exports=function(){return i(t),t}):(n=new Array(16),e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),n[t]=e>>>((3&t)<<3)&255;return n})},570:(e,t,n)=>{var i,a,r=n(217),o=n(327),s=0,l=0;e.exports=function(e,t,n){var c=t&&n||0,d=t||[],u=(e=e||{}).node||i,g=void 0!==e.clockseq?e.clockseq:a;null!=u&&null!=g||(p=r(),null==u&&(u=i=[1|p[0],p[1],p[2],p[3],p[4],p[5]]),null==g&&(g=a=16383&(p[6]<<8|p[7])));var h=void 0!==e.msecs?e.msecs:(new Date).getTime(),p=(n=void 0!==e.nsecs?e.nsecs:l+1,h-s+(n-l)/1e4);if(p<0&&void 0===e.clockseq&&(g=g+1&16383),1e4<=(n=(p<0||s<h)&&void 0===e.nsecs?0:n))throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=h,a=g,n=(1e4*(268435455&(h+=122192928e5))+(l=n))%4294967296,d[c++]=n>>>24&255,d[c++]=n>>>16&255,d[c++]=n>>>8&255,d[c++]=255&n,h=h/4294967296*1e4&268435455,d[c++]=h>>>8&255,d[c++]=255&h,d[c++]=h>>>24&15|16,d[c++]=h>>>16&255,d[c++]=g>>>8|128,d[c++]=255&g;for(var m=0;m<6;++m)d[c+m]=u[m];return t||o(d)}},171:(e,t,n)=>{var i=n(217),a=n(327);e.exports=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||i)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var s=0;s<16;++s)t[r+s]=o[s];return t||a(o)}}},t={};function n(i){var a=t[i];return void 0!==a||(a=t[i]={exports:{}},e[i](a,a.exports,n)),a.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};(()=>{"use strict";n.r(i),n.d(i,{initializeLaunchSequence:()=>Si});const e="initData",t="browserDetails",a="unifiedLogs",r={USER_DATA:"USER_DATA",PUSH_TOKEN:"PUSH_TOKEN",SUBSCRIPTION_DETAILS:"SUBSCRIPTION_DETAILS",SETUP_TIME:"SETUP_TIME",OPT_IN_SHOWN_TIME:"OPT_IN_SHOWN_TIME",SOFT_ASK_STATUS:"SOFT_ASK_STATUS",HARD_ASK_STATUS:"HARD_ASK_STATUS",WEB_SETTINGS:"WEB_SETTINGS",GRACEFUL_DATA:"GRACEFUL_DATA",Q:{PREFIX:"Q",REPORT:"REPORT",DEVICE:"DEVICE"},INIT_DATA:"INIT_DATA",OLD_SDK:{USER_DATA:"moengage_data",SUBSCRIPTION_DETAILS:"MOE_PUSH_ENDPOINT",PUSH_TOKEN:"MOE_PUSH_TOKEN"},BROWSER_DETAILS:"browserDetails",SESSION:"SESSION"},o=2,s="MOE_WEB_UNSUBSCRIBED",l="EVENT_ACTION_WEB_SESSION_START",c="MOE_PAGE_VIEWED",d="MOE_WEB_OPTIN_BANNER_LOAD",u="MOE_WEB_OPTIN_CLOSED",g="MOE_WEB_OPTIN_ACCEPTED",h="MOE_USER_SUBSCRIBED",p="MOE_OPT_IN_SHOWN",m="MOE_OPT_IN_ALLOWED",f="MOE_OPT_IN_DISMISSED",S="MOE_OPT_IN_BLOCKED",v="MOE_OPT_IN_ATTEMPT",E="MOE_LOGOUT",_="USER_ATTRIBUTE_UNIQUE_ID",b="USER_ATTRIBUTE_USER_EMAIL",y="USER_ATTRIBUTE_USER_NAME",T="USER_ATTRIBUTE_USER_FIRST_NAME",I="USER_ATTRIBUTE_USER_LAST_NAME",w="USER_ATTRIBUTE_USER_MOBILE",A="USER_ATTRIBUTE_USER_GENDER",O="USER_ATTRIBUTE_USER_BDAY",D="USER_ID_MODIFIED_FROM";var C;const N="MOE_LIFECYCLE",R={MOE_INIT:"SDK_INITIALIZED",SETTINGS_FETCHED:"SETTINGS_FETCHED",EVENT_TRACKED:"EVENT_TRACKED"},k={HARD_ASK_SHOWN:"HARD_ASK_SHOWN",HARD_ASK_DISMISSED:"HARD_ASK_DISMISSED",HARD_ASK_ATTEMPTED:"HARD_ASK_ATTEMPTED",HARD_ASK_ALLOWED:"HARD_ASK_ALLOWED",HARD_ASK_DENIED:"HARD_ASK_DENIED",SOFT_ASK_SHOWN:"SOFT_ASK_SHOWN",SOFT_ASK_DISMISSED:"SOFT_ASK_DISMISSED",SOFT_ASK_ALLOWED:"SOFT_ASK_ALLOWED"},P={code:1e3,reason:"Web push not supported in current browser environment"},L={code:1001,reason:"Registering the service worker failed"},M={code:1002,reason:"Web push settings not configured"},B={code:1004,reason:"Hard ask was dismissed to many times"},x={code:1005,reason:"Service worker can not be registered on this page due to scope issues"},W="moe",U="moe-subd",H="STORAGE",F="EPHEMERAL_STORAGE",K="PERMISSION_STATE",j="CONFIG",G="HARD_ASK_RESULT",V="SHOW_NOTIF",Y="https://media.giphy.com/media/KDRv3QggAjyo/giphy.gif",q={DC_2:"sdk-02.moengage.com",DC_3:"sdk-03.moengage.com",DC_4:"sdk-04.moengage.com",eu:"sdk-02.moengage.com",in:"sdk-03.moengage.com"},z={MOE_DASHBOARD:"https://app.moengage.com",MIGRATION_DOCS:"https://docs.moengage.com/docs/web-sdk-integration",WEBSDK_DOCS:"https://docs.moengage.com/docs/web-sdk-integration",SELF_HANDLED_DOCS:"https://docs.moengage.com/docs/self-handled-opt-ins"},X="Dashboard --\x3e Settings --\x3e Channel --\x3e Push",Q="SESSION",J="v3/sdkconfig/",$="moe_tracking",Z="events",ee="moe_uuid",te="MoengagePageEventHistoryManager",ne={HOST_1:"https://sdk-01.moengage.com/",HOST_2:"https://sdk-02.moengage.com/",HOST_3:"https://sdk-03.moengage.com/",HOST_4:"https://sdk-04.moengage.com/",API:{META:"v3/campaigns/inapp/live",CAMPAIGN_PAYLOAD:"v3/campaigns/inapp/live/",CAMPAIGNS_PAYLOAD:"v3/campaigns/inapp/live/campaigns",DRAFT_CAMPAIGN_PAYLOAD:"v3/campaigns/inapp/test/"},DRAFT_CAMPAIGN_TPYES:{WEB_PERSONALIZATON:"web_personalization",ONSITE_MESSAGING:"onsite_messaging"},META_REFRESH_TIME:9e5,DATABASE_NAME:"moe_onsite",STORES:{CAMPAIGNS_META:{NAME:"campaigns_meta"},CAMPAIGNS_TAGS:{NAME:"campaigns_tags"},CAMPAIGNS_STATS:{NAME:"campaigns_stats"},TEST_CAMPAIGN_STORE:{NAME:"test_campaign"},EXIT_INTENT_CAMPAIGN_STORE:{NAME:"exit_intent"},SERVICE_META:{NAME:"service_meta",KEYS:{LAST_META_CALL_TIME:"last_meta_call_time",GLOBAL_DELAY:"global_delay_between_inapps",LAST_INAPP_SHOWN_TIME:"last_inapp_shown",LAST_FETCH_SDK_VERSION:"last_fetch_sdk_version",UNIQUE_ID:"unique_id"}}},EVENT_NAMES:{OSM:{CLICK:"MOE_ONSITE_MESSAGE_CLICKED",IMPRESSION:"MOE_ONSITE_MESSAGE_SHOWN",DISMISS:"MOE_ONSITE_MESSAGE_DISMISSED",AUTO_DISMIS:"MOE_ONSITE_MESSAGE_AUTO_DISMISS",TYPE:"onsite"},WP:{CLICK:"MOE_WEBP_MESSAGE_CLICKED",IMPRESSION:"MOE_WEBP_MESSAGE_SHOWN",DISMISS:"MOE_WEBP_MESSAGE_DISMISSED",DELIVERED:"MOE_WEBP_MESSAGE_DELIVERED",TYPE:"webp"}},WEB_HELPER_IFRAME_URL:"https://cdn.moengage.com/webpush/beta/webpushhelper.html",IFRAME_CHANNEL:"inapp_helper",IFRAME_TOPICS:{COOKIE_STORAGE:"COOKIE_STORAGE"},COOKIE_STORAGE:{TEST_DRAFT_TYPE:"moe_inapp_draft_type",TEST_DRAFT_ID:"moe_inapp_draft_id",TEST_DRAFT_TAG:"moe_inapp_draft_tag",TEST_CAMPAIGN_META:"test_campaign_meta",TEST_TEMPLATE_TYPE:"test_template_type",TEST_VARIATION:"moe_inapp_draft_variation",TEST_LOCALE:"moe_inapp_draft_locale"},CSS_SELECTORS:{CLICK_INAPP:"moe-inapp-click",DISMISS_INAPP:"moe-inapp-close"},EXIT_INTENT:{CONFIG:{SCROLL_DOWN_THRESHOLD:50,SCROLL_UP_THRESHOLD:5,SCROLL_INTERVAL:1e3}},POSITIONED_TEMPLATE:'data-editor-type="MOE_EDITOR"',SIDE_BANNER:'data-template-type="SIDE_BANNER"',GCG_ERROR_CODE:"E001",SCROLL_CAMPAIGN_THROTTLING_TIME:1500},ie={INAPP:{name:"INAPP",src:"https://cdn.moengage.com/webpush/modules/inapp.js",windowLocation:"moeOnsite"},CARDS:{name:"CARDS",src:"https://cdn.moengage.com/webpush/moe_webSdk_cards.min.latest.js",windowLocation:"moeCards"}};(Ve=C=C||{}).BLOCKED="blocked",Ve.ALLOWED="allowed";const ae={NAME:"offline_data"},re="v2/sdk/report/",oe=15e3,se="number",le={TOPIC:"MOE_AUTOMATED_EVENTS",NAMES:[s,l,c,d,u,g,h,v,p,m,f,S,E,ne.EVENT_NAMES.OSM.CLICK,ne.EVENT_NAMES.OSM.IMPRESSION,ne.EVENT_NAMES.OSM.DISMISS,ne.EVENT_NAMES.OSM.AUTO_DISMIS]},ce=[v],de="moe_cards",ue={STORE_NAME:"campaigns"},ge={STORE_NAME:"meta",LAST_FETCH_SDK_VERSION:"last_fetch_sdk_version",LAST_META_CALL_TIME:"last_meta_call_time",UNIQUE_ID:"unique_id",LAST_SYNC_CARDS:"last_sync_cards",SYNC_INTERVALS:"sync_intervals",SHOW_ALL_TAB:"show_all_tab"},he="appOpen";var pe=n(483);function me(e,t,n){return null!=e&&t?(e=e[(t=Array.isArray(t)?t:t.split("."))[0]])&&1<t.length?me(e,t.slice(1),n):void 0===e?n||null:e:null}class fe{static set(e,t){fe.baseLogTag,window&&(window.moeInternals?window.moeInternals.ephemeral||(window.moeInternals.ephemeral={}):(window.moeInternals={},window.moeInternals.ephemeral={}),window.moeInternals.ephemeral[e]=t)}static get(e){return me(window,"moeInternals.ephemeral."+e,null)}}fe.baseLogTag="EphemeralStorage";let Se="color: white; background: #41AE55; border-radius: 5px;";class ve{static setLogLevel(e,t){var n=ve.baseLogTag+".setLogLevel";null==fe.get(a)&&fe.set(a,[]),null==e?ve.logLevel=0:e in[0,1,2]?0<(ve.logLevel=e)&&t&&ve.releaseAllLogs():ve.warn(0,n,"Value",e,"not supported for setDebugLevel(). Current log level is",ve.logLevel,". Debug level can only be [0, 1, 2]")}static setLogTabStyle(e){ve.tagLogStyle=ve.tagLogStyle.replace("#48beab",e)}static log(e,t,n,...i){e<=ve.logLevel?console.log("%c "+ve.logBrand+" %c %c info %c %c "+t+" ",Se,"","color: white; background: #18a0bf; border-radius: 5px;","",ve.tagLogStyle,n,...i):ve.cacheLog((()=>{ve.log(e,t,n,...i)}))}static error(e,t,n,...i){e<=ve.logLevel?console.error("%c "+ve.logBrand+" %c %c error %c %c "+t+" ",Se,"","color: white; background: #cc0a0a; border-radius: 5px;","",ve.tagLogStyle,n,...i):ve.cacheLog((()=>{ve.error(e,t,n,...i)}))}static warn(e,t,n,...i){e<=ve.logLevel?console.warn("%c "+ve.logBrand+" %c %c warn %c %c "+t+" ",Se,"","color: white; background: #e8ab51; border-radius: 5px;","",ve.tagLogStyle,n,...i):ve.cacheLog((()=>{ve.warn(e,t,n,...i)}))}static customLabel(e,t,n,...i){e<=ve.logLevel?console.log("%c "+ve.logBrand+" %c %c "+t+" %c %c "+n+" %c ",Se,"",ve.tagLogStyle,"","color: white; background: #a400ff; border-radius: 5px;","",...i):ve.cacheLog((()=>{ve.customLabel(e,t,n,...i)}))}static image(e,t){e<=ve.logLevel?console.log("%c+","font-size: 1px; padding: 20px 80px; line-height: 45px; background: url("+t+"); background-size: 160px 90px; color: transparent;"):ve.cacheLog((()=>{ve.image(e,t)}))}static releaseAllLogs(){var e=fe.get(a),t=e.length;const n=e;if(fe.set(a,[]),0<t){ve.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS BEGIN ----\x3e");for(let e=0;e<t;e++)n[e]();ve.log(0,"Logger.releaseAllLogs","<---- HISTORICAL LOGS END ----\x3e")}}static setLogBrand(e){ve.logBrand=e}static setBrandColor(e){Se="color: white; background: "+e+"; border-radius: 5px;"}static cacheLog(e){let t=fe.get(a);null==t&&(t=[]),t.push(e),fe.set(a,t)}}ve.baseLogTag="Logger",ve.logBrand="MoEngage",ve.logLevel=0,ve.tagLogStyle="color: white; background: #48beab; border-radius: 5px;";class Ee{static set(e,t){var n=Ee.baseTag+".set";null==t?Ee.remove(e):(t="boolean"==typeof t?JSON.stringify({actualValue:t,MOE_DATA_TYPE:"boolean"}):"string"==typeof t?JSON.stringify({actualValue:t,MOE_DATA_TYPE:"string"}):JSON.stringify(t),ve.log(3,n,"Setting ",e,":",t),n=Date.now(),n=";expires="+new Date(n+31536e6*o).toUTCString(),document.cookie=e+"="+encodeURIComponent(t)+n+";domain="+Ee.getOrigin()+";path=/;SameSite=None; Secure")}static get(e){var t=Ee.baseTag+".get",n=e+"=",i=decodeURIComponent(document.cookie).split(";");for(let a=i.length-1;0<=a;a--){let r=i[a];for(;" "===r.charAt(0);)r=r.substring(1);if(0===r.indexOf(n)){let i=r.substring(n.length,r.length);try{i=JSON.parse(i),"string"===me(i,"MOE_DATA_TYPE",null)?(i=me(i,"actualValue",null),i=i?String(i):null):"boolean"===me(i,"MOE_DATA_TYPE",null)&&(i=me(i,"actualValue",null))}catch(e){}return ve.log(3,t,"Got ",e,":",i),i}}return null}static remove(e){var t=Ee.baseTag+".remove";document.cookie=e+"=;domain="+Ee.getOrigin()+";path=/;expires=Thu, 01 Jan 1970 00:00:01 GMT;",ve.log(3,t,"Removed ",e)}static setRaw(e,t,n){var i=Ee.baseTag+".setRaw";if(null==t)Ee.remove(e);else{ve.log(3,i,"Setting ",e,":",t);let a="";null!=n&&(a=";expires="+n.toISOString()),document.cookie=e+"="+encodeURIComponent(t)+a+";domain="+Ee.getOrigin()+";path=/;"}}static getOrigin(){var e=Ee.baseTag+".getOrigin";let t=window.location.origin;return t=t.indexOf(".")!==t.lastIndexOf(".")?t.substring(t.indexOf(".")):"."+t.substring(t.lastIndexOf("/")+1),"localhost"===window.location.hostname&&(ve.warn(1,e,"Cross domain user persitence will not work with localhost. \n\nWe will save the key-value pairs in the localhost cookie store for reference. You'll be able to test this functionality in a hosted staging/test environment."),t=""),t}}Ee.baseTag="CookieStorage";const _e="MOE_DATA";class be{static setPrefix(e){be.prefix=e+"_"}static set(e,t){if(be.baseLogTag,e=be.prefix+e,localStorage){const n=be.getMoeData();n[e]=t,localStorage.setItem(_e,JSON.stringify(n))}var n=be.KEYS_SHARED_WITH_COOKIE.indexOf(e);if(be.isSharedWithCookie&&0<=n){const i="object"!=typeof t||Array.isArray(t)?t:Object.assign({},t);0===n&&Array.isArray(i.attributes)&&(i.attributes=i.attributes.filter((e=>{switch(e.key){case _:case D:case b:case w:return!0;default:return!1}}))),e===r.SUBSCRIPTION_DETAILS&&(i.domain=t.domain,i.token=t.token,i.endpoint=t.endpoint,i.keys=t.keys),Ee.set(e,i)}}static get(e){return be.baseLogTag,e=be.prefix+e,localStorage?me(be.getMoeData(),e,null):null}static remove(e){var t=be.baseLogTag+".remove",n=be.prefix+e;if(localStorage&&null!=be.get(e)){const i=be.getMoeData();delete i[n],localStorage.setItem(_e,JSON.stringify(i)),ve.log(2,t,"Key",e,"removed.")}be.isSharedWithCookie&&0<=be.KEYS_SHARED_WITH_COOKIE.indexOf(e)&&Ee.remove(e)}static logout(){const e=["INIT_DATA","Q","WEB_SETTINGS","SUBSCRIPTION_DETAILS","PUSH_TOKEN","GRACEFUL_DATA"];for(const t in r)e.indexOf(t)<0&&be.remove(r[t]);for(const e in r.Q)ye.purge(e)}static getString(e){if(e=be.prefix+e,localStorage)return"string"==typeof(e=be.get(e))||e instanceof String?e:JSON.stringify(e)}static removePrefix(){be.prefix=""}static copyKeysFromCookie(){for(let n=0;n<be.KEYS_SHARED_WITH_COOKIE.length;n++){var e=be.KEYS_SHARED_WITH_COOKIE[n],t=Ee.get(e);if(null!=t){const n="object"!=typeof t||Array.isArray(t)?t:Object.assign({},t);if(e===r.USER_DATA&&(t=be.get(e)&&be.get(e).attributes,Array.isArray(n.attributes)&&Array.isArray(t)&&0<t.length)){const e=[...t];n.attributes.forEach((t=>{var n=e.findIndex((e=>e.key===t.key));0<=n&&(e[n]=t)})),n.attributes=e}be.set(e,n)}}}static getMoeData(){var e=be.baseLogTag+".getMoeData",t=localStorage.getItem(_e);if(null==t)return{};try{return JSON.parse(t)}catch(t){return ve.error(1,e,t),{}}}}be.baseLogTag="PersistentStorage",be.prefix="",be.isSharedWithCookie=!1,be.KEYS_SHARED_WITH_COOKIE=[r.USER_DATA,r.SUBSCRIPTION_DETAILS,r.SOFT_ASK_STATUS,r.SETUP_TIME,r.PUSH_TOKEN,r.OPT_IN_SHOWN_TIME,r.HARD_ASK_STATUS];class ye{constructor(){this.items=[]}static enqueue(e,t){e=ye.getLocalStorageQName(e);let n=new ye;be.get(e)&&(n=be.get(e)),n.items.push(t),n.items=n.items.slice(Math.max(n.items.length-50,0)),be.set(e,n)}static dequeue(e){e=ye.getLocalStorageQName(e);const t=be.get(e);let n=null;return t&&0<t.items.length&&(n=t.items[0],t.items.splice(0,1),be.set(e,t)),n}static isEmpty(e){return e=ye.getLocalStorageQName(e),!(be.get(e)&&0<be.get(e).items.length)}static purge(e){var t=ye.getLocalStorageQName(e);ye.isEmpty(e)||be.remove(t)}static getLocalStorageQName(e){return r.Q.PREFIX+"_"+e}}function Te(e){return 0===Object.keys(e).length&&e.constructor===Object}function Ie(){if(window)return"localhost"===window.location.hostname?"https":"http:"===window.location.protocol?"http":"https:"===window.location.protocol?"https":void 0}function we(e){e=(e+"=".repeat((4-e.length%4)%4)).replace(/\-/g,"+").replace(/_/g,"/");const t=atob(e),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}function Ae(e){let t="";var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=new Uint8Array(e),a=i.byteLength,r=a-(e=a%3);let o,s,l,c,d;for(let e=0;e<r;e+=3)d=i[e]<<16|i[e+1]<<8|i[e+2],o=(16515072&d)>>18,s=(258048&d)>>12,l=(4032&d)>>6,c=63&d,t+=n[o]+n[s]+n[l]+n[c];return 1==e?(d=i[r],o=(252&d)>>2,s=(3&d)<<4,t+=n[o]+n[s]+"=="):2==e&&(d=i[r]<<8|i[1+r],o=(64512&d)>>10,s=(1008&d)>>4,l=(15&d)<<2,t+=n[o]+n[s]+n[l]+"="),t}function Oe(e,t){return t.isChrome()||t.isOpera()||t.isEdge()||t.isSafari()?"vapid"===e.chrome.subscriptionMode&&e.chrome.vapidPublicKey:t.isFirefox()&&"vapid"===e.firefox.subscriptionMode&&e.firefox.vapidPublicKey}function De(e,t){return t.isChrome()||t.isOpera()||t.isEdge()||t.isSafari()?e.chrome.vapidPublicKey:t.isFirefox()?e.firefox.vapidPublicKey:""}function Ce(){const e=navigator.userAgent;return!(!/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e)&&!/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))}function Ne(e){return new Date(Date.parse(e))}function Re(){return window[window.moengage_object||"Moengage"]}class ke{constructor(){this.p=null,this.res=null,this.rej=null;try{this.p=new Promise(((e,t)=>{this.res=e,this.rej=t}))}catch(e){ve.error(1,"Utils.PromiseObject","Promises not supported")}}}const Pe=e=>"string"==typeof e,Le=e=>"[object Date]"===Object.prototype.toString.call(e);function Me(e,t){if(null==e||null==t)return e===t;if(e instanceof Function)return e===t;if(e instanceof RegExp)return e===t;if(e===t||e.valueOf()===t.valueOf())return!0;if(Array.isArray(e)&&e.length!==t.length)return!1;if(e instanceof Date)return!1;if(!(e instanceof Object))return!1;if(!(t instanceof Object))return!1;const n=Object.keys(e);return Object.keys(t).every((e=>-1!==n.indexOf(e)))&&n.every((n=>Me(e[n],t[n])))}function Be(){const e=new Date;return`${e.getDate()}:${e.getMonth()+1}:${e.getFullYear()}:${e.getHours()}:${e.getMinutes()}:`+e.getSeconds()}const xe=e=>{if(e){const t=e.replace("?","").split("&"),n={};return t.forEach((e=>{e=(t=e.split("="))[0];var t=decodeURIComponent(t[1]||"");n[e]?"[object Array]"===Object.prototype.toString.call(n[e])?n[e].push(t):n[e]=[n[e],t]:n[e]=t})),JSON.parse(JSON.stringify(n))}return{}},We=()=>window.location.search.includes("moe_migration=true"),Ue=()=>{var e,t=be.get(r.WEB_SETTINGS);"allowed"===(null==t?void 0:t.c_w_p_e)&&null!==(e=window.MoeWebP)&&void 0!==e&&e.clearLastFetchedTime()},He=(e,t)=>{e+="?";for(const n in t)t.hasOwnProperty(n)&&null!=t[n]&&(e+=n+"="+encodeURIComponent(t[n])+"&");return e};class Fe{static get(e,t){return Fe.makeNetworkCall(Fe.METHODS.GET,e,t)}static post(e,t){return Fe.makeNetworkCall(Fe.METHODS.POST,e,t)}static makeNetworkCall(e,t,n={}){return new Promise(((i,a)=>{var r=JSON.stringify(me(n,"postData",null));t=He(t,me(n,"queryParams",null));const o=new XMLHttpRequest;o.open(e,t,!0),Fe.addRequestHeaders(o,me(n,"headers",{})),o.onreadystatechange=()=>{4===o.readyState&&200===o.status||4===o.readyState&&410===o.status?i({status:o.status,responseText:o.responseText}):4===o.readyState&&200!==o.status&&a({code:o.status,reason:o.responseText})},o.send(r)}))}static addRequestHeaders(e,t){for(const n in t)t.hasOwnProperty(n)&&e.setRequestHeader(n,t[n]);return e}}(si=(si=Fe=Fe||{}).METHODS||(si.METHODS={})).GET="GET",si.POST="POST";const Ke=Fe;var je,Ge,Ve,Ye=n(877);class qe{initiateSessionAndSource(e){return new Promise(((t,n)=>{var i=()=>{this.isSessionRunning()&&this.isCurrentSourceSameAsPreviousSource()||this.startNewSession(),t(!0)};e?i():setTimeout(i,250)}))}isSessionRunning(){return this.getSessionKey()&&!this.isSessionExpired()}isSessionExpired(){var e=this.getSessionExpiryTime(),t=fe.get("wasBrowserInactive");return!(!t&&null!==t)&&(this.isWindowActive()&&fe.set("wasBrowserInactive",!1),(new Date).getTime()>e)}isNonEventInteractive(e){return qe.NON_INTERACTIVE_EVENTS.includes(e.name)||0<e.attributes.filter((e=>"moe_non_interactive"===e.key&&1===e.value)).length}getCurrentSource(){const e=xe(window.location.search);let t="";const n={};if(Object.keys(e).includes("utm_source")){t="utm_",this.geCustomIdentifiersToTrack().forEach((t=>{e[t]&&(n[t]=e[t])}));const i={source_url:window.location.href};return e[t+"source"]&&(i.source=e[t+"source"]),e[t+"medium"]&&(i.medium=e[t+"medium"]),e[t+"term"]&&(i.term=e[t+"term"]),e[t+"campaign"]&&(i.campaign_name=e[t+"campaign"]),e[t+"content"]&&(i.content=e[t+"content"]),e.utm_id&&(i.campaign_id=e.utm_id),Object.keys(n).length&&(i.extra=n),i}}getActiveSource(){return this.getSavedSource()||this.getCurrentSource()}isSourceOrganic(){const e=xe(window.location.search),t=Object.keys(e);let n=!1;return this.geCustomIdentifiersToTrack().forEach((t=>{e[t]&&(n=!0)})),!t.includes("utm_source")&&!t.includes("source")&&!n}setCurrentSource(e){const t=this.getSession();t.currentSource=e,be.set(Q,t)}removeCurrentSource(){const e=this.getSession();e&&(e.currentSource=void 0,be.set(Q,e))}getSavedSource(){var e=me(this.getSession(),"currentSource",void 0);if(e)return e}isCurrentSourceSameAsPreviousSource(){if(this.isSourceOrganic())return!0;const e=Object.assign({},this.getCurrentSource());delete e.source_url;const t=Object.assign({},this.getSavedSource());return delete t.source_url,Me(e,t)}getSessionKey(){return me(this.getSession(),"sessionKey",null)}getSessionStartTime(){return me(this.getSession(),"sessionStartTime",null)}getSessionExpiryTime(){return me(this.getSession(),"sessionExpiryTime",null)}getSessionMaxTime(){return me(this.getSession(),"sessionMaxTime",null)}getSession(){return be.get(Q)}geCustomIdentifiersToTrack(){return me(this.getSession(),"customIdentifiersToTrack",[])||[]}generateSessionKey(){return(0,Ye.v4)()}startNewSession(){this.removeCurrentSource(),Wt.getWebSDKSettings().then((e=>{var t=this.getNumberOfSessions();t={sessionKey:this.generateSessionKey(),sessionStartTime:(new Date).toISOString(),sessionMaxTime:e.s_i_d,sessionEnabled:e.s_s_s,customIdentifiersToTrack:e.src_ext,sessionExpiryTime:(new Date).getTime()+1e3*e.s_i_d,numberOfSessions:++t},be.set(Q,t)}))}extendSession(){const e=this.getSession();e&&(e.sessionExpiryTime=(new Date).getTime()+1e3*e.sessionMaxTime,be.set(Q,e))}handleBrowserInactivity(e){"hidden"===e&&fe.set("wasBrowserInactive",!0)}isWindowActive(){return!!fe.get("isWindowActive")}getNumberOfSessions(){return me(be.get(Q),"numberOfSessions")||0}}qe.NON_INTERACTIVE_EVENTS=[d,p,d,E];class ze{constructor(e,t,n){this.os="web",this.osPlatform=e.userAgent,this.isMobile=Ce(),this.os=Ce()?"mweb":"web",this.name=ze.getBrowserName(e.userAgent,t),this.isIncognito=n}static getInstance(){return function(e,t,n,i){return new(n=n||Promise)((function(t,a){function r(e){try{s(i.next(e))}catch(e){a(e)}}function o(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var i;e.done?t(e.value):((i=e.value)instanceof n?i:new n((function(e){e(i)}))).then(r,o)}s((i=i.apply(e,[])).next())}))}(this,0,void 0,(function*(){if(null!=fe.get(t))return fe.get(t);var e=yield ze.isIncognito(window),n=new ze(navigator,document,e);return fe.set(t,n),(e=be.get(r.BROWSER_DETAILS))&&ze.isBrowserUpdated(e,n)||be.set(t,n),n}))}static isIncognito(e){const t=e.RequestFileSystem||e.webkitRequestFileSystem;return new Promise((n=>{t?t(e.TEMPORARY,100,(()=>{n(!1)}),(()=>{n(!0)})):n(!1)}))}static getBrowserName(e,t){return-1!==e.indexOf("MSIE")||1==t.documentMode?ze.BROWSER_NAMES.INTERNET_EXPLORER:-1<e.indexOf("Edg")?ze.BROWSER_NAMES.EDGE:-1<e.indexOf("OPR")||-1<e.indexOf("Opera")?ze.BROWSER_NAMES.OPERA:-1<e.indexOf("Chrome")||e.match(/\b(?:crmo|crios)\/([\w\.]+)/i)?-1<e.indexOf("MMS")?ze.BROWSER_NAMES.OPERA_NEON:ze.BROWSER_NAMES.CHROME:-1<e.indexOf("Safari")?ze.BROWSER_NAMES.SAFARI:-1<e.indexOf("Firefox")?ze.BROWSER_NAMES.FIREFOX:ze.BROWSER_NAMES.OTHERS}static isBrowserUpdated(e,t){return Me(e,t)}isWebPushCompatible(){return this.isChrome()||this.isFirefox()||this.isOpera()||this.isSafari()||this.isEdge()}isChrome(){return this.name===ze.BROWSER_NAMES.CHROME}isFirefox(){return this.name===ze.BROWSER_NAMES.FIREFOX}isOpera(){return this.name===ze.BROWSER_NAMES.OPERA||this.name===ze.BROWSER_NAMES.OPERA_NEON}isSafari(){return this.name===ze.BROWSER_NAMES.SAFARI}isEdge(){return this.name===ze.BROWSER_NAMES.EDGE}static isIOS(){return!(!navigator.userAgent.match(/iPad/i)&&!navigator.userAgent.match(/iPhone/i))}}(Ve=(Ve=ze=ze||{}).BROWSER_NAMES||(Ve.BROWSER_NAMES={})).CHROME="Google Chrome",Ve.FIREFOX="Mozilla Firefox",Ve.OPERA="Opera",Ve.OPERA_NEON="Opera Neon",Ve.SAFARI="Apple Safari",Ve.INTERNET_EXPLORER="Internet Explorer",Ve.EDGE="Edge",Ve.OTHERS="Others";const Xe=ze;class Qe{constructor(e){var t=Qe.baseLogTag+".constructor";e.placeholder||ve.error(1,t,"Placeholder for cards inbox not passed in cardsConfig: ",e),this.placeholder=me(e,"placeholder",""),this.overLayColor=me(e,"overLayColor","rgba(0, 0, 0, 0.8)"),this.backgroundColor=me(e,"backgroundColor","#F6FBFC"),this.navigationBar=new Je(me(e,"navigationBar",{})),this.closeButton=new et(me(e,"closeButton",{})),this.tab=new tt(me(e,"tab",{})),this.cardDismiss=new nt(me(e,"cardDismiss",{})),this.optionButtonColor=me(e,"optionButtonColor","#C4C4C4"),this.dateTimeColor=me(e,"dateTimeColor","#8E8E8E"),this.unclickedCardIndicatorColor=me(e,"unclickedIndicatorColor","blue"),this.pinIcon=me(e,"pinIcon","https://app-cdn.moengage.com/sdk/pin-icon.svg"),this.refreshIcon=me(e,"refreshIcon","https://app-cdn.moengage.com/sdk/refresh-icon.svg"),this.webFloating=new rt(me(e,"webFloating",{})),this.mWebFloating=new rt(me(e,"mWebFloating",{countBackgroundColor:"#FF5A5F",enable:!1,icon:"https://app-cdn.moengage.com/sdk/bell-icon.svg",countColor:"#fff",postion:"0px 10px 40px 0",iconBackgroundColor:"#D9DFED"})),this.card=new Ze(me(e,"card",{})),this.errorContent=new $e(me(e,"errorContent",{})),this.noDataContent=new ot(me(e,"noDataContent",{})),this.openInbox=me(e,"openInbox",(()=>{})),this.zIndex=me(e,"zIndex","999999"),this.fontFaces=(null===(e=e.fontFaces)||void 0===e?void 0:e.map((e=>new it(e))))||[]}}Qe.baseLogTag="CardsConfigModel";class Je{constructor(e){this.backgroundColor=me(e,"backgroundColor","#00237C"),this.text=me(e,"text","Notification"),this.color=me(e,"color","#fff"),this.fontSize=me(e,"fontSize","16px"),this.fontFamily=me(e,"fontFamily","inherit")}}class $e{constructor(e={}){this.img=me(e,"img","https://app-cdn.moengage.com/sdk/cards-error.svg"),this.text=me(e,"text",'Error something went wrong <button onclick="window.location.reload();" style="color: #06A6B7; display: contents;" class="btn-icon pointer-cursor" >Refresh</button>')}}class Ze{constructor(e){this.headerFontSize=me(e,"headerFontSize","16px"),this.descriptionFontSize=me(e,"descriptionFontSize","14px"),this.ctaFontSize=me(e,"ctaFontSize","12px"),this.fontFamily=me(e,"fontFamily","inherit"),this.horizontalRowColor=me(e,"horizontalRowColor","#D9DFED")}}class et{constructor(e){this.mWebIcon=me(e,"mWebIcon","https://app-cdn.moengage.com/sdk/back-icon.svg"),this.webIcon=me(e,"webIcon","https://app-cdn.moengage.com/sdk/cross-icon.svg"),this.callBack=me(e,"callBack",(()=>{}))}}class tt{constructor(e){this.inactiveTabFontColor=me(e,"inactiveTabFontColor","#7C7C7C"),this.fontSize=me(e,"fontSize","14px"),this.fontFamily=me(e,"fontFamily","inherit"),this.backgroundColor=me(e,"backgroundColor","#F6FBFC"),this.active=new at(me(e,"active",{}))}}class nt{constructor(e){this.color=me(e,"color","red"),this.enable=me(e,"enable",!1)}}class it{constructor(e){this.family=me(e,"family",""),this.url=me(e,"url","")}}class at{constructor(e){this.color=me(e,"color","#06A6B7"),this.underlineColor=me(e,"underlineColor","#06A6B7"),this.backgroundColor=me(e,"backgroundColor","transparent")}}class rt{constructor(e){this.enable=me(e,"enable",!1),this.icon=me(e,"icon","https://app-cdn.moengage.com/sdk/bell-icon.svg"),this.postion=me(e,"postion","0px 10px 40px 0"),this.countBackgroundColor=me(e,"countBackgroundColor","#FF5A5F"),this.countColor=me(e,"countColor","#fff"),this.zIndex=me(e,"zIndex","999998"),this.iconBackgroundColor=me(e,"iconBackgroundColor","#D9DFED"),this.fontFamily=me(e,"fontFamily","inherit")}}class ot{constructor(e){this.img=me(e,"img","https://app-cdn.moengage.com/sdk/cards-no-result.svg"),this.text=me(e,"text","No notifications to show, check again later.")}}class st{constructor(e){this.debugLevel=0,this.cluster=null,this.environment=null,this.baseDomainName="https://sdk-01.moengage.com/",this.inapp=null,this.customSoftAsk=null;var t=st.baseLogTag+".constructor";null!=me(e,"app_id",null)?(this.appId=me(e,"app_id",null),this.integrationType=je.OLD_SDK):null!=me(e,"appId",null)?(this.appId=me(e,"appId",null),this.integrationType=je.NEW_SDK):(ve.error(1,t,"App Id not specified. Please check docs page to complete the integration - ",z.WEBSDK_DOCS),this.integrationType=null),null!=me(e,"debug_logs",null)?this.debugLevel=me(e,"debug_logs",0):null!=me(e,"debugLevel",null)?this.debugLevel=me(e,"debugLevel",0):(ve.log(2,t,"No log level config found. Using default value of",0),this.debugLevel=0),this.appId&&(this.baseDomainName="https://sdk-01.moengage.com/",this.forceSwUpdate=me(e,"forceSwUpdate",!1),this.cluster=me(e,"cluster",null),this.cluster&&null!=q[this.cluster]&&(this.environment=q[this.cluster]),me(e,"environment",null)&&(this.environment=e.environment),this.environment&&(this.baseDomainName="https://"+this.environment+"/"),0<this.debugLevel&&this.appId.indexOf("_DEBUG")<0?this.appId=this.appId+"_DEBUG":0===this.debugLevel&&0<=this.appId.indexOf("_DEBUG")&&(this.appId=this.appId.substr(0,this.appId.indexOf("_DEBUG"))),this.swPath=me(e,"swPath",null),null!=e.customSoftAsk?this.customSoftAsk={mainClass:me(e,"customSoftAsk.mainClass",null),allowClass:me(e,"customSoftAsk.allowClass",null),dismissClass:me(e,"customSoftAsk.dismissClass",null)}:this.customSoftAsk={mainClass:me(e,"main_class",null),allowClass:me(e,"allow_class",null),dismissClass:me(e,"block_class",null)},null!=me(e,"inapp.host",null)&&(this.inapp={host:me(e,"inapp.host",null)}),null!=me(e,"swScope",null)&&(this.swScope=me(e,"swScope",null)),null!=me(e,"disable_onsite",null)&&(this.disableOnsite=me(e,"disable_onsite",!1)),null!=me(e,"enableSPA",null)&&(this.enableSPA=me(e,"enableSPA",!1)),null!=me(e,"cards",null)&&(this.cards=new Qe(me(e,"cards",{}))))}static save(t){fe.set(e,new st(t)),be.set(r.INIT_DATA,new st(t))}static get(){return fe.get(e)}static setSoftAskConfig(e){var t=st.get();e={appId:t.appId,debugLevel:t.debugLevel,cluster:t.cluster,environment:t.environment,swPath:t.swPath,customSoftAsk:{mainClass:me(e,"main_class",me(e,"mainClass",null)),allowClass:me(e,"allow_class",me(e,"allowClass",null)),dismissClass:me(e,"block_class",me(e,"dismissClass",null))}},st.save(e)}}st.baseLogTag="InitData",(si=je=je||{}).OLD_SDK="OLD_SDK",si.NEW_SDK="NEW_SDK";class lt{constructor(e,t){this.key=e,this.value=t}static equal(e,t){return e.key===t.key&&JSON.stringify(e.value)===JSON.stringify(t.value)}}class ct{static isTokenValid(e,t){return new Promise(((n,i)=>{var a,r;null!=e&&null!=t?(a="https://iid.googleapis.com/iid/info/"+e+"?details=true",r={headers:{authorization:"key="+t}},Ke.get(a,r).then((e=>{200===e.status?n(!0):n(!1)})).catch((i=>{0===i.code?setTimeout((()=>{n(ct.isTokenValid(e,t))}),3e3):n(!1)}))):n(!1)}))}}class dt{constructor(e,t){this.channel=e,this.target=t}sendMessage(e,t){return new Promise(((n,i)=>{var a={id:(0,Ye.v4)(),channel:this.channel,topic:e,message:t};this.addToListener(a,n,i),this.target instanceof HTMLIFrameElement?this.target.contentWindow.postMessage(a,this.target.src):this.target.postMessage(a,"*")}))}static listenToChannel(e,t,n){window.addEventListener("message",(i=>{i.data&&i.data.channel&&i.data.topic&&i.data.channel===e&&i.data.topic===t&&n(i.data,(n=>{n={id:i.data.id,channel:e,topic:t,message:n},i.source.postMessage(n,i.origin)}))}))}addToListener(e,t,n){dt.pendingPromises[e.id]={resolve:t,reject:n},window.addEventListener("message",(e=>{e.data&&me(e.data,"channel",null)===this.channel&&null!=dt.pendingPromises[e.data.id]&&(dt.pendingPromises[e.data.id].resolve(e.data),delete dt.pendingPromises[e.data.id])}))}}dt.pendingPromises={},(Ve=Ge=Ge||{}).PROMPT="prompt",Ve.GRANTED="granted",Ve.DENIED="denied",Ve.DISMISSED="dismissed";class ut{constructor(e){this.sdkSettings=e,this.getIframe(),dt.listenToChannel(U,j,((e,t)=>{t(this.sdkSettings)}))}showHardAsk(){return ut.baseLogTag,new Promise(((t,n)=>{this.getIframeCommunicator().then((n=>{n.sendMessage(F,{requestType:"set",key:e,value:st.get()}).then((e=>{n.sendMessage(H,{requestType:"set",key:r.INIT_DATA,value:st.get()}).then((e=>{n.sendMessage(H,{requestType:"get",key:r.SUBSCRIPTION_DETAILS}).then((e=>{null!=e.message?this.isTokenValid().then((i=>{var a;i?t({state:Ge.GRANTED,subscriptionDetails:e.message}):(a=n.sendMessage(H,{requestType:"remove",key:r.SUBSCRIPTION_DETAILS}),i=this.removeToken(),Promise.all([a,i]).then((()=>{this.openNewTabForPermission(n).then((e=>{t(e)}))})))})):this.openNewTabForPermission(n).then((e=>{t(e)}))}))}))}))}))}))}openNewTabForPermission(e){return new Promise((t=>{e.sendMessage(j,this.sdkSettings).then((e=>{dt.listenToChannel(U,G,((e,n)=>{n("Ok"),e=e.message,t(e)})),window.open(this.sdkSettings.platformSettings.chrome.subdomainURL+"?startSubscription=true","_blank","toolbar=yes,scrollbars=yes,resizable=yes,top=500,left=500,width=400,height=400")}))}))}getCurrentPermissionState(){return new Promise(((e,t)=>{this.getIframeCommunicator().then((t=>{t.sendMessage(K,{requestType:"get"}).then((t=>{e(t.message)}))}))}))}getPushTokenDetails(){return new Promise((e=>{this.getOrSetInSubDomainStorage(r.SUBSCRIPTION_DETAILS).then((t=>{e(t)}))}))}setInSubDomainStorage(e,t){return new Promise((n=>{this.getIframeCommunicator().then((i=>{i.sendMessage(H,{requestType:"set",key:e,value:t}).then((e=>{n(!0)}))}))}))}logout(){return new Promise((e=>{this.getIframeCommunicator().then((t=>{t.sendMessage(H,{requestType:"logout"}).then((t=>{e(!0)}))}))}))}getInSubdomain(e){return ut.baseLogTag,new Promise((t=>{this.getIframeCommunicator().then((n=>{n.sendMessage(H,{requestType:"get",key:e}).then((e=>{null==e.message?t(null):t(e.message)})).catch((e=>{t(null)}))})).catch((e=>{t(null)}))}))}setInSubdomain(e,t){return ut.baseLogTag,new Promise(((n,i)=>{this.getIframeCommunicator().then((a=>{a.sendMessage(H,{requestType:"set",key:e,value:t}).then((e=>{n(!0)})).catch((e=>{i(e)}))})).catch((e=>{i(e)}))}))}getOrSetInSubDomainStorage(e,t){return new Promise((n=>{this.getInSubdomain(e).then((i=>{null==i?this.setInSubdomain(e,t).then((()=>{n(t)})).catch((e=>{n(t)})):n(i)}))}))}isTokenValid(){return new Promise((e=>{this.getPushTokenDetails().then((t=>{t&&t.token?ct.isTokenValid(t.token,this.sdkSettings.platformSettings.chrome.apiKey).then((t=>{t?e(t):this.getIframeCommunicator().then((n=>{n.sendMessage(H,{requestType:"remove",key:r.SUBSCRIPTION_DETAILS}).then((()=>{n.sendMessage(H,{requestType:"remove",key:r.HARD_ASK_STATUS}).then((()=>{e(t)}))}))}))})):e(!1)}))}))}removeToken(){return new Promise((e=>{be.remove(r.PUSH_TOKEN),this.getIframeCommunicator().then((t=>{t.sendMessage(H,{requestType:"remove",key:r.PUSH_TOKEN}).then((t=>{e(!0)}))}))}))}getIframeCommunicator(){return new Promise((e=>{ut.iframeCommunicator?e(ut.iframeCommunicator):this.getIframe().then((t=>{ut.iframeCommunicator=new dt(W,t),e(ut.iframeCommunicator)}))}))}getIframe(){return new Promise(((e,t)=>{if(null==ut.iframe){const t=document.createElement("iframe");t.id="moengage-subd-iframe",t.style.display="none",t.src=this.sdkSettings.platformSettings.chrome.subdomainURL,document.body.appendChild(t),ut.iframe=t,t.addEventListener("load",(()=>{ut.iframeLoaded=!0,e(t)}))}else ut.iframeLoaded?e(ut.iframe):setTimeout((()=>{this.getIframe().then((t=>{e(t)}))}),500)}))}showNotification(e){this.getIframeCommunicator().then((t=>{t.sendMessage(V,{notification:e,config:this.sdkSettings})}))}}ut.baseLogTag="ChromeHTTPNotificationManager",ut.iframeLoaded=!1;class gt{constructor(){this.isDomainLevelStorage=!1,this.isConfigured=!1,this.isPushSubBilling=!1,this.platformSettings=new St,this.optInConfig=new ht,this.s_i_d=1800,this.c_s=!1,this.i_b_e=!1,this.s_s_d=!1}static parseOldSettings(e){var t=gt.baseLogTag+".parseOldSettings";const n=new gt;if((n.oldWebData=e).webData&&!Te(e.webData)){n.isConfigured=!0;var i=e.webData;const a=me(i,"domain_type",null);a&&("http"===a.toLowerCase()?n.platformSettings.chrome.domainType=ft.DOMAIN_TYPE.HTTP:"https"===a.toLowerCase()?n.platformSettings.chrome.domainType=ft.DOMAIN_TYPE.HTTPS:"multi"===a.toLowerCase()?n.platformSettings.chrome.domainType=ft.DOMAIN_TYPE.MUTLI:n.platformSettings.chrome.domainType=ft.DOMAIN_TYPE.NA),n.platformSettings.chrome.subdomainURL=me(i,"subdomainUrl",null),"false"===me(i,"domain_level_storage",!1)?n.isDomainLevelStorage=!1:n.isDomainLevelStorage=!(!me(i,"domain_level_storage",!1)&&"true"!==me(i,"domain_level_storage",!1)),"allowed"!==(e=me(i,"c_s",!1))&&!0!==e&&"true"!==e||(n.c_s=!0),"allowed"!==(e=me(i,"i_b_e",!1))&&!0!==e&&"true"!==e||(n.i_b_e=!0),"allowed"!==(e=me(i,"s_s_d",!1))&&!0!==e&&"true"!==e||(n.s_s_d=!0);let r=me(i,"PushSubBilling",!1);"false"===r?r=!1:"true"===r&&(r=!0),(e=>"boolean"==typeof e)(r)||(r=!1),n.isPushSubBilling=r,n.platformSettings.chrome.domainType!==ft.DOMAIN_TYPE.HTTP&&n.platformSettings.chrome.domainType!==ft.DOMAIN_TYPE.MUTLI||n.platformSettings.chrome.subdomainURL||ve.warn(1,t,"No sub domain defined for HTTP site"),n.platformSettings.chrome.enabled=!0,n.platformSettings.chrome.apiKey=me(i,"webPushPlatformData.chrome.api_key",""),n.platformSettings.chrome.projectNumber=me(i,"webPushPlatformData.chrome.project_number",null),n.platformSettings.chrome.subscriptionMode=me(i,"webPushPlatformData.chrome.subscriptionMode","normal"),n.platformSettings.chrome.vapidPublicKey=me(i,"webPushPlatformData.chrome.vapidPublicKey",null),n.platformSettings.firefox.enabled=!0,n.platformSettings.firefox.apiKey=me(i,"webPushPlatformData.chrome.api_key",""),n.platformSettings.firefox.projectNumber=me(i,"webPushPlatformData.chrome.project_number",null),n.platformSettings.firefox.subscriptionMode=me(i,"webPushPlatformData.firefox.subscriptionMode","normal"),n.platformSettings.firefox.vapidPublicKey=me(i,"webPushPlatformData.firefox.vapidPublicKey",null),n.platformSettings.safari.websitePushId=me(i,"webPushPlatformData.safari.websitePushId",null),null==n.platformSettings.safari.websitePushId?n.platformSettings.safari.enabled=!1:n.platformSettings.safari.enabled=!0,n.optInConfig.reappearTime=parseInt(me(i,"promptAgain",24)),me(i,"call_push_moengage",!0)?me(i,"banner.banner_flag",null)?n.optInConfig.type=ht.TYPE.TWO_STEP:n.optInConfig.type=ht.TYPE.ONE_CLICK:(n.optInConfig.type=ht.TYPE.SELF_HANDLED,n.optInConfig.reappearTime=0),n.optInConfig.showOverlay=me(i,"show_overlay",!1),n.optInConfig.loadTime=me(i,"load_time",0),n.optInConfig.softAskConfig.desktop.customHTML=me(i,"bannerHtml.web",null),n.optInConfig.softAskConfig.mobile.customHTML=me(i,"bannerHtml.mweb",null),n.platformSettings.chrome.isServiceWorkerRoot=!me(i,"is_service_worker_not_root",!1),n.platformSettings.chrome.serviceWorkerFilename=me(i,"serviceworker_file","serviceworker.js"),""===n.platformSettings.chrome.serviceWorkerFilename&&(n.platformSettings.chrome.serviceWorkerFilename="serviceworker.js"),n.s_i_d=me(i,"s_i_d",1800),n.s_s_s=me(i,"s_s_s","allowed"),n.src_ext=me(i,"src_ext",[]),n.s_e_b_e=me(i,"s_e_b_e","blocked"),n.e_b_c=me(i,"e_b_c",10),n.p_f_t=me(i,"p_f_t",60),n.b_e=me(i,"b_e",[]),n.w_e=me(i,"w_e",[]),n.c_w_p_e=me(i,"c_w_p_e","blocked"),n.o_u_e=me(i,"o_u_e","blocked")}else n.isConfigured=!1;return n}}gt.baseLogTag="SdkSettings";class ht{constructor(){this.type=ht.TYPE.NA,this.reappearTime=24,this.softAskConfig={desktop:new pt,mobile:new pt}}}class pt{constructor(){this.customHTML=null}}(si=(si=ht=ht||{}).TYPE||(si.TYPE={})).NA="NA",si.ONE_CLICK="ONE_CLICK",si.TWO_STEP="TWO_STEP",si.SELF_HANDLED="SELF_HANDLED";class mt{constructor(){this.enabled=!1,this.websitePushId=null}}class ft{constructor(){this.enabled=!1,this.domainType=ft.DOMAIN_TYPE.NA,this.isServiceWorkerRoot=!0,this.serviceWorkerFilename="serviceworker.js",this.apiKey="",this.subscriptionMode="normal",this.vapidPublicKey=null}}(Ve=(Ve=ft=ft||{}).DOMAIN_TYPE||(Ve.DOMAIN_TYPE={})).NA="NA",Ve.HTTP="http",Ve.HTTPS="https",Ve.MUTLI="multi";class St{constructor(){this.safari=new mt,this.chrome=new ft,this.firefox=new ft}}const vt=gt;let Et,_t=null,bt=null;class yt{constructor(e){this.attributes=[],this.subscribedToOldSdk=!1,null==e?(this.deviceUuid=(0,Ye.v4)(),this.attributes=[],this.deviceAdded=!1):(this.deviceUuid=me(e,"deviceUuid",(0,Ye.v4)()),this.attributes=me(e,"attributes",[]),this.deviceAdded=me(e,"deviceAdded",!1))}addAttribute(e){const t=yt.baseLogTag+".addAttribute";return new Promise((n=>{e.key=yt.getMorphedKey(e.key);let i=-1;for(let t=this.attributes.length-1;0<=t;t--)e.key===this.attributes[t].key&&(i=t);ve.log(2,t,"Adding attribute:",e),0<=i?(this.attributes[i].value,e.value,this.attributes[i].value=e.value):this.attributes.push(e),this.save().then((()=>{n(!0)}))}))}static getLocalUser(){const e=yt.baseLogTag+".getLocalUser";return new Promise((t=>{var n;be.get(r.USER_DATA)?(ve.log(2,e,"Found user in localstorage"),n=be.get(r.USER_DATA),t(new yt(n))):t(null)}))}static getCookieUser(){return new Promise((e=>{var t=yt.baseLogTag+".getLocalUser";Ee.get(r.USER_DATA)?(ve.log(2,t,"Found user in cookie"),t=Ee.get(r.USER_DATA),e(new yt(t))):e(null)}))}static getSubdomainUser(){return new Promise((e=>{Wt.getWebSDKSettings().then((t=>{_t=new ut(t),_t.getInSubdomain(r.USER_DATA).then((t=>{e(t?new yt(t):null)}))}))}))}static getMigrationUser(){const e=yt.baseLogTag+".getLocalUser";return new Promise((t=>{var n=localStorage.getItem(r.OLD_SDK.USER_DATA);if(n)try{var i=JSON.parse(n);if(i.is_new_sdk_migrated)t(null);else{const e=new yt({deviceAdded:me(i,"device_add",!1),deviceUuid:me(i,"uuid",(0,Ye.v4)())}),n=me(i,"user_attrs",{});for(const t in n)n.hasOwnProperty(t)&&e.attributes.push(new lt(t,n[t]));var a=localStorage.getItem(r.OLD_SDK.PUSH_TOKEN);null!=a&&"NA"!==a&&"null"!==a&&(e.subscribedToOldSdk=!0),t(e)}}catch(n){ve.error(1,e,"Error getting the migration user. Resolving as a new user."),ve.error(1,e,n),t(null)}else t(null)}))}static getSync(){return yt.instance}static get(){const e=yt.baseLogTag+".get";return null!=bt||(bt=new Promise((t=>{Xe.getInstance().then((n=>{Wt.getWebSDKSettings().then((i=>{Et=i.isDomainLevelStorage;let a="https";n.isWebPushCompatible()&&(i.platformSettings.chrome.domainType===ft.DOMAIN_TYPE.HTTP||i.platformSettings.chrome.domainType===ft.DOMAIN_TYPE.MUTLI&&"http"===Ie())&&(a="http");var o=yt.getLocalUser(),s=i.isDomainLevelStorage?yt.getCookieUser():"resolved",l="http"===a?yt.getSubdomainUser():"resolved",c=yt.getMigrationUser();Promise.all([o,s,l,c]).then((a=>{const o=a[0],s=a[1],l=a[2],c=a[3];a=()=>{s&&"resolved"!==s?(ve.log(1,e,"User resolved from cookie: ",s),s.save().then((e=>{t(e)}))):(ve.log(1,e,"Local user: ",o),new yt(o).save().then((e=>{t(e)})))},c?c.save().then((n=>{var i=localStorage.getItem(r.OLD_SDK.USER_DATA);if(i){const e=JSON.parse(i);e.is_new_sdk_migrated=!0,localStorage.setItem(r.OLD_SDK.USER_DATA,JSON.stringify(e))}ve.log(1,e,"User resolved from older SDK: ",n),t(n)})):n.isWebPushCompatible()&&(i.platformSettings.chrome.domainType===ft.DOMAIN_TYPE.HTTP||i.platformSettings.chrome.domainType===ft.DOMAIN_TYPE.MUTLI&&"http"===Ie())&&l&&"resolved"!==l?(ve.log(1,e,"User resolved from subdomain: ",l),l.save().then((e=>{t(e)}))):a()})).catch((t=>{ve.log(1,e,"Error in fetching/creating user",t)}))}))}))}))),bt}static logout(){return new Promise((e=>{bt=null,(this.instance=null)!=_t?_t.logout().then((()=>{e(!0)})):e(!0)}))}save(){const e=yt.baseLogTag+".save";return yt.isAmpEnabled()&&(this.deviceUuid=Ee.get("moe_uuid")),yt.instance=this,new Promise((t=>{be.set(r.USER_DATA,this),Ee.setRaw(ee,yt.instance.deviceUuid),null!=_t?_t.setInSubDomainStorage(r.USER_DATA,this).then((()=>{t(this)})).catch((n=>{ve.error(1,e,"Error storing value in subdomain"),t(this)})):t(this)}))}static isAmpEnabled(){const e=Ee.get(ee);return e&&e.includes("amp")}getAttribute(e){let t=null;return e=yt.getMorphedKey(e),this.attributes.map((n=>{n.key===e&&(t=n.value)})),t}indexOfAttribute(e){let t=-1;return e=yt.getMorphedKey(e),this.attributes.map(((n,i)=>{n.key===e&&(t=i)})),t}static getMorphedKey(e){switch(e){case"id":e=_;break;case"email":e=b;break;case"name":e=y;break;case"first_name":e=T;break;case"last_name":e=I;break;case"mobile":e=w;break;case"gender":e=A;break;case"birthday":e=O}return e}}yt.baseLogTag="UserModel",yt.isResolved=!1,yt.instance=null;class Tt{constructor(){var e=Tt.baseLogTag+".constructor";const t=void 0;let n=yt.getSync().getAttribute("id");n=n?n.toString():void 0;const i=window.analytics;let a,r;if(i){r=i._VERSIONS;try{a=i.user().anonymousId()}catch(t){ve.error(1,e,"Error getting anonymous id from segment api",t)}}this.c=void 0,this.h="",this.identifiers=void 0,(n||a)&&(this.identifiers={moe_user_id:n,segment_id:a}),this.meta={bid:(0,Ye.v4)(),segmentSdkData:i?r:void 0}}}Tt.baseLogTag="ReportPostData";class It{constructor(e,t,n){It.baseLogTag,this.type=e,this.getParams=t,this.event=n,this.postData=new Tt;const i={},a={};for(const e of n.attributes)if(e&&null!=e.key&&(this.status=It.STATUS.VALID,null!=e.value))if("function"==typeof e.value.getMonth){const t={};t[e.key]=Math.round(e.value.getTime()-6e4*e.value.getTimezoneOffset()),null==a.timestamp&&(a.timestamp=[]),a.timestamp.push(t)}else i[e.key]=e.value;this.postData.e=n.name,this.postData.a=i,this.postData.c=Te(a)?void 0:a,window&&window.location&&null!=window.location.href&&(this.postData.url=window.location.href)}}It.baseLogTag="ReportClass",(Ve=(si=It=It||{}).STATUS||(si.STATUS={}))[Ve.INVALID=0]="INVALID",Ve[Ve.VALID=1]="VALID",(si=si.REPORT_ADD_TYPE||(si.REPORT_ADD_TYPE={}))[si.USER_ATTRIBUTE=0]="USER_ATTRIBUTE",si[si.EVENT=1]="EVENT";const wt=It;var At=function(e,t,n,i){return new(n=n||Promise)((function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))};class Ot{static initStore(){return At(this,void 0,void 0,(function*(){return null==Ot.ready&&(Ot.offlineDataStore=pe.createInstance({driver:[pe.INDEXEDDB],name:"moe_database",storeName:ae.NAME}),Ot.ready=Promise.resolve(Ot.offlineDataStore.ready())),yield Ot.ready}))}static initialize(){return At(this,void 0,void 0,(function*(){yield Ot.initStore()}))}}class Dt{constructor(e){this.EVENT_ACTION=e.event.name,this.EVENT_ATTRS=Ct(e.event.attributes),this.EVENT_G_TIME=(new Date).getTime().toString(),this.EVENT_L_TIME=Be(),this.EVENT_ATTRS_CUST=e.postData.c,this.N_I_E=e.postData.nie}}Dt.baseLogTag="ReportAddViewEvent";const Ct=e=>{const t={};return e.forEach((e=>{t[e.key]=e.value})),t};class Nt{static visibilityChange(){"hidden"===document.visibilityState&&(Nt.windowClosed||Lt.reactToTriggerEvents())}static beforeUnload(){Nt.windowClosed=!0,Lt.sendBeacon()}static removeEventListeners(){document.removeEventListener("visibilitychange",Nt.visibilityChange,!1),window.removeEventListener("beforeunload",Nt.beforeUnload,!1)}static addListeners(){document.addEventListener("visibilitychange",Nt.visibilityChange,!1),window.addEventListener("beforeunload",Nt.beforeUnload,!1)}}Nt.windowClosed=!1;const Rt=Nt;var kt=function(e,t,n,i){return new(n=n||Promise)((function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))};class Pt{static spliceReports(e=Pt.reports.length){return Pt.reports.splice(0,e)}static shouldCreateNewBatch(){return!Pt.lastbatchCreatedAt||(new Date).getTime()-Pt.lastbatchCreatedAt>=oe}static reactToTriggerEvents(){var e=Pt.baseLogTag+".reactToTriggerEvents";0<Pt.reports.length&&Pt.shouldCreateNewBatch()?(ve.log(1,e,`Trigger Events: Created Batch of ${Pt.reports.length} reports`,Be()),Pt.createBatch()):ve.log(2,e,Be()+": No report's to sync for this event.")}static periodicSync(e){var t=Pt.baseLogTag+".periodicSync";0<Pt.reports.length&&Pt.shouldCreateNewBatch()?(ve.log(1,t,`Periodic sync: Created Batch of ${Pt.reports.length} reports`,Be()),Pt.createBatch()):ve.log(2,t,Be()+`: No report's to sync at this interval. The next sync will attempt in ${e} seconds`)}static clearInterval(){clearInterval(Pt.periodicSyncInterval),Pt.lastbatchCreatedAt=null}static init(e){Xe.getInstance().then((t=>{Pt.isOfflineBatchingSupported(t)&&(Pt.periodicSyncInterval&&Pt.clearInterval(),Pt.periodicSyncInterval=window.setInterval(Pt.periodicSync.bind(this,e.p_f_t),1e3*e.p_f_t),Rt.addListeners())}))}static sendBatch(e){return kt(this,void 0,void 0,(function*(){var t=Pt.baseLogTag+".sendBatch";try{yield Wt.sendBatchOfReports(e).then((()=>{Pt.lastbatchCreatedAt=(new Date).getTime()}))}catch(e){ve.error(1,t,"Error in sending batch",e)}}))}static createBatch(e){0<Pt.reports.length&&(e=Pt.spliceReports(e),Pt.sendBatch(e))}static addReport(e,t){var n=Pt.baseLogTag+".addReport";e=new Dt(e),Pt.reports.push(e),Pt.reports.length===t&&(ve.log(1,n,`Created Batch of ${t} reports`,Be()),Pt.createBatch(t))}static sendBeacon(){var e=Pt.baseLogTag+".sendBeacon";0<Pt.reports.length&&(Wt.sendBeacon(Pt.reports),ve.log(1,e,`Window Unload: Created batch of ${Pt.reports.length} reports`,Be()))}static flushReports(){return kt(this,void 0,void 0,(function*(){var e=Pt.baseLogTag+".flushReports";try{Rt.removeEventListeners(),0<Pt.reports.length&&(ve.log(1,e,`Flushed ${Pt.reports.length} reports`,Be()),yield Pt.sendBatch(Pt.spliceReports()))}catch(t){ve.error(1,e,"Error in flushing reports",t)}}))}static isOfflineBatchingSupported(e){return"allowed"===be.get(r.WEB_SETTINGS).s_e_b_e&&(e.name===Xe.BROWSER_NAMES.CHROME||e.name===Xe.BROWSER_NAMES.EDGE||e.name===Xe.BROWSER_NAMES.OPERA)&&!e.isMobile&&navigator.sendBeacon}}Pt.baseLogTag="BatchManager",Pt.reports=[],Pt.lastbatchCreatedAt=null;const Lt=Pt;class Mt{static getListeners(){return this.listeners}static getTopicListeners(e){return me(Mt.topicListeners,e,[])}static addListener(e){Mt.listeners.push(e)}static addTopicListener(e,t){Mt.topicListeners[e]=Mt.getTopicListeners(e),Mt.topicListeners[e].push(t)}static broadcast(e){Mt.listeners.map((t=>{t(e)})),me(Mt.topicListeners,e.topic,[]).map((t=>{t(e)}))}static broadcastToWindow(e){window&&window.dispatchEvent(new CustomEvent(e.topic,{detail:{name:e.name,data:e.data||null}}))}static deprecatedSdkCallback(e){window.dispatchEvent(new CustomEvent("MOE_OPT_IN",{detail:e}))}static resetAllListeners(){Mt.listeners=[],Mt.topicListeners={}}}Mt.listeners=[],Mt.topicListeners={};const Bt=Mt;var xt=function(e,t,n,i){return new(n=n||Promise)((function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))};class Wt{static deviceAdd(){return new Promise(((e,t)=>{const n=st.get();return Wt.collectGetParams().then((i=>{i={queryParams:i},Ke.post(n.baseDomainName+"v2/device/add",i).then((()=>{yt.get().then((t=>{t.deviceAdded=!0,t.save().then((()=>{Ft.startPeriodicClear(r.Q.REPORT),Wt.onDeviceAdd.res(),e(!0)}))}))})).catch((e=>{ye.enqueue(r.Q.DEVICE,!0),t(!1)}))}))}))}static reportAdd(e,t){const n=Wt.baseLogTag+".reportAdd";return new Promise(((i,a)=>(t=!!t,Wt.getWebSDKSettings().then((a=>{a.isPushSubBilling?yt.get().then((a=>{a.deviceAdded?Wt.reportAddInternal(e,t).then((()=>{this.sendBroadcast(e),i(!0)})):(ye.enqueue(r.Q.REPORT,e),ve.log(1,n,"Report added to queue as device not added yet:",e.event.name),ve.log(2,n,"Event Queued:",e.event.name),e.type===wt.REPORT_ADD_TYPE.USER_ATTRIBUTE&&(Wt.isPushSubAttributeAccepted(e.event.attributes[0].key)?(ve.log(1,n,"Attribute accepted for push sub billing."),Wt.deviceAdd()):ve.log(2,n,"Attribute NOT accepted for push sub billing.")),i(!0))})):Wt.reportAddInternal(e,t).then((()=>{this.sendBroadcast(e),i(!0)}))})))))}static sendBroadcast(e){le.NAMES.includes(e.event.name)&&Bt.broadcastToWindow({topic:le.TOPIC,name:e.event.name,data:e.event.attributes})}static getSegmentId(){const e=window.analytics;if(e&&e.user)return e.user().anonymousId()}static getBatchRequestOptions(e){return new Promise((t=>{Wt.collectGetParams().then((n=>{var i=Wt.getSegmentId()||"";const a=yt.getSync(),r=new qe;var o={session_id:r.getSessionKey(),start_time:r.getSessionStartTime(),background_initiated:0};const s=[];var l=r.getActiveSource();l&&(r.setCurrentSource(l),s.push(l)),o={query_params:n,identifiers:{moe_user_id:a.getAttribute("id")||void 0,segment_id:i||void 0},meta:{bid:(0,Ye.v4)(),request_time:(new Date).toISOString(),session:o,source:s.length?s:void 0},viewsCount:e.length,viewsInfo:[...e]},t(o)}))}))}static addReportsToOfflineDB(e,t){return xt(this,void 0,void 0,(function*(){const n=Wt.baseLogTag+".addReportsToOfflineDB";var i=yield Wt.getBatchRequestOptions([]);yield Ot.offlineDataStore.setItem(t||"report_add_"+(new Date).getTime(),e),yield Ot.offlineDataStore.setItem("requestMetaData",i),navigator.serviceWorker&&navigator.serviceWorker.ready.then((e=>{e.sync?e.sync.register("moe_offline_data_sync").then((()=>{ve.log(2,n,"offline sync event registered")})).catch((e=>{ve.error(1,n,"Service worker sync error",e)})):ve.log(2,n,"Service worker sync unavailable")}))}))}static sendReportBeacon(e,t,n){return!!(e&&navigator.sendBeacon&&navigator.sendBeacon(t,new Blob([JSON.stringify(n)],{type:"text/plain;charset=UTF-8"})))}static sendBatchOfReports(e){const t=Wt.baseLogTag+".sendBatchOfReports";return new Promise(((n,i)=>{Wt.getBatchRequestOptions(e).then((a=>{var r=st.get();const o=r.baseDomainName+re+r.appId;Wt.getWebSDKSettings().then((r=>Wt.sendReportBeacon(r.i_b_e,o,a)?(ve.log(1,t,"[sendBatchOfReports] batch payload: "+JSON.stringify(e)),ve.log(1,t,"Batch sent to MoEngage successfully through beacon"),void n(!0)):void Ke.post(o,{postData:a}).then((()=>{ve.log(1,t,"[sendBatchOfReports] batch payload: "+JSON.stringify(e)),ve.log(1,t,"Batch sent to MoEngage successfully"),n(!0)})).catch((a=>{ve.error(1,t,"Batch Report add API failed",a),Xe.getInstance().then((r=>{Lt.isOfflineBatchingSupported(r)?(Wt.addReportsToOfflineDB(e).then((()=>{ve.log(2,t,"Network offline: Batch added to offline db")})),n(!0)):i(a)})).catch((()=>{i(a)}))}))))}))}))}static reportAddInternal(e,t){const n=Wt.baseLogTag+".reportAddInternal";return new Promise(((i,a)=>{Wt.getWebSDKSettings().then((a=>{Xe.getInstance().then((o=>{if("allowed"!==a.s_e_b_e||t){const l=Wt.getUpdatedPushDetails();for(const t in l)!l.hasOwnProperty(t)||e.event.name===s&&"push_id"===t||(e.getParams[t]=l[t]);const c={queryParams:e.getParams};if(e.postData.nie){const t=Object.assign({},e);delete t.postData.meta.source,delete t.postData.meta.session,c.postData=t.postData}else c.postData=e.postData;let d=st.get().baseDomainName;if(d+=t?"v2/device/add":"v2/report/add",Wt.sendReportBeacon(a.i_b_e,He(d,me(c,"queryParams",null)),c.postData))return ve.log(1,n,"Event tracked through beacon:",e.event),void i(Wt.handleReportAddSuccess(e));Ke.post(d,c).then((()=>{i(Wt.handleReportAddSuccess(e))})).catch((i=>{"allowed"!==a.s_e_b_e||o.name!==Xe.BROWSER_NAMES.CHROME&&o.name!==Xe.BROWSER_NAMES.EDGE&&o.name!==Xe.BROWSER_NAMES.OPERA||o.isMobile||!navigator.sendBeacon?Wt.handleReportAddFailure(e,i):(ve.error(1,n,"Add Report API failed, adding reports to offline db",i),t?ye.enqueue(r.Q.DEVICE,e):(i=new Dt(e),Wt.offlineEvents.push(i),Wt.addReportsToOfflineDB(Wt.offlineEvents,"report_add").then((()=>{ve.log(2,n,"Network offline: Batch added to offline db")}))))}))}else{var l;o.name!==Xe.BROWSER_NAMES.CHROME&&o.name!==Xe.BROWSER_NAMES.EDGE&&o.name!==Xe.BROWSER_NAMES.OPERA||o.isMobile||!navigator.sendBeacon?(l=new Dt(e),Wt.sendBatchOfReports([l]).then((()=>{i(Wt.handleReportAddSuccess(e))})).catch((t=>{Wt.handleReportAddFailure(e,t)}))):(Lt.addReport(e,a.e_b_c),ve.log(1,n,"Event batched successfully:",e.event),Wt.eventStore.setItem(e.event.name,e.event),i(!0))}}))}))}))}static handleReportAddSuccess(e){var t=Wt.baseLogTag+".handleReportAddSuccess";return e.type===wt.REPORT_ADD_TYPE.EVENT?(ve.log(1,t,"Event tracked successfully:",e.event),Wt.eventStore.setItem(e.event.name,e.event)):e.type===wt.REPORT_ADD_TYPE.USER_ATTRIBUTE&&ve.log(1,t,"User attribute added successfully:",e.event.attributes),Wt.addReportApiRetries=1,!0}static handleReportAddFailure(e,t){var n=Wt.baseLogTag+".handleReportAddFailure";ve.error(1,n,"Add Report API failed",t),e.type===wt.REPORT_ADD_TYPE.EVENT?ve.log(1,n,"Queueing unsuccessful event tracking:",e.event):e.type===wt.REPORT_ADD_TYPE.USER_ATTRIBUTE&&ve.log(1,n,"Queueing unsuccessful user attribute add:",e.event.attributes),Wt.addReportApiRetries<3&&setTimeout((()=>{Wt.addReportApiRetries++,ye.enqueue(r.Q.REPORT,e),Ft.startPeriodicClear(r.Q.REPORT)}),3e3*Wt.addReportApiRetries)}static checkIfTokenValid(e){const t=st.get().baseDomainName+"v2/device/token-check",n=st.get();return new Promise((i=>{e?yt.get().then((a=>{a={queryParams:{app_id:n.appId,unique_id:a.deviceUuid,push_id:e}},Ke.post(t,a).then((e=>{200===e.status?i(!0):i(!1)})).catch((e=>{i(!1)}))})):i(!1)}))}static getWebSDKSettings(){return new Promise(((e,t)=>{let n=st.get();var i,a;null!=n&&null!=n.appId||(n=new st(be.get(r.INIT_DATA))),Wt.sdkSettings?e(Wt.sdkSettings):(i=(new Date).getTime(),null==(a=be.get(r.SETUP_TIME))||0<n.debugLevel?Wt.getAndPersistWebSettings(n).then((t=>{e(t)})).catch((e=>{t(!1)})):864e5<i-a?Wt.getAndPersistWebSettings(n).then((t=>{e(t)})):be.get(r.WEB_SETTINGS)?(Wt.sdkSettings=be.get(r.WEB_SETTINGS),e(Wt.sdkSettings)):Wt.getAndPersistWebSettings(n).then((t=>{e(t)})))}))}static getAndPersistWebSettings(e){const t=Wt.baseLogTag+".getAndPersistWebSettings";return new Promise(((n,i)=>xt(this,void 0,void 0,(function*(){try{var a={queryParams:{app_id:(e=null==e.appId?new st(be.get(r.INIT_DATA)):e).appId}};ve.log(1,t,"Fetching latest web sdk settings for",e.appId);var o=yield Ke.get(e.baseDomainName+"websdksettings",a);ve.log(1,t,"Fetching config settings for",e.appId);let i=o.responseText;"string"==typeof i&&(i=JSON.parse(i));var s=Ce()?"mweb":"web",l=e.baseDomainName+J+s+"/"+e.appId;try{var c,d=yield Ke.get(l);ve.log(1,t,"Fetched latest web and config settings"),200===d.status&&(c=d.responseText,c=JSON.parse(c),i.webData=Object.assign(Object.assign({},i.webData),c))}catch(e){ve.error(1,t,"Config API failed")}var u=(new Date).getTime();i=vt.parseOldSettings(i),be.set(r.WEB_SETTINGS,i),be.set(r.SETUP_TIME,u),Wt.sdkSettings=i,n(i)}catch(a){ve.error(1,t,"Settings APi Failed: ",a),Wt.webSdkApiRetries<3?setTimeout((()=>{Wt.webSdkApiRetries++,n(Wt.getAndPersistWebSettings(e))}),3e3*Wt.webSdkApiRetries):i(!1)}}))))}static collectGetParams(){return new Promise(((e,t)=>{yt.get().then((t=>{let n=st.get();null!=n&&null!=n.appId||(n=new st(be.get(r.INIT_DATA)));const i=new Date,a=Date.UTC(i.getUTCFullYear(),i.getUTCMonth(),i.getUTCDate(),i.getUTCHours(),i.getUTCMinutes(),i.getUTCSeconds(),i.getUTCMilliseconds());Xe.getInstance().then((i=>{const o={os:i.os,os_platform:i.osPlatform,is_incognito:i.isIncognito,app_id:n.appId,os_ver:i.name,sdk_ver:"2.8.58",model:i.name,app_ver:"1.0",device_ts:Number(a),device_tz_offset:(-6e4*(new Date).getTimezoneOffset()).toString(),unique_id:t.deviceUuid,device_tz:(new Date).getTimezoneOffset().toString()};var s=be.get(r.PUSH_TOKEN);null!=s&&"NA"!==s&&""!==s&&"null"!==s&&(o.push_id=s),i.isWebPushCompatible()&&(Oe(this.sdkSettings.platformSettings,i)?(o.subscription_type="vapid",o.vapid_public=De(this.sdkSettings.platformSettings,i)):o.subscription_type="normal",o.sender_id=this.sdkSettings.platformSettings.chrome.projectNumber),null!=n.environment&&(o.environment=n.environment),i.name===Xe.BROWSER_NAMES.SAFARI&&(o.websitePushId=this.sdkSettings.platformSettings.safari.websitePushId);var l=be.get(r.SUBSCRIPTION_DETAILS);if(null!=l&&null!=l.keys){for(const e in l.keys)o["keys_"+e]=encodeURI(l.keys[e]);null!=l.endpoint&&(o.endpoint=encodeURI(l.endpoint)),o.expirationTime=l.expirationTime}e(o)}))}))}))}static getUpdatedPushDetails(){const e={};var t=be.get(r.SUBSCRIPTION_DETAILS);if(null!=t){var n=be.get(r.PUSH_TOKEN);if(null!=n&&"NA"!==n&&""!==n&&"null"!==n&&(e.push_id=n),t.keys){for(const n in t.keys)e["keys_"+n]=encodeURI(t.keys[n]);null!=t.endpoint&&(e.endpoint=encodeURI(t.endpoint)),e.expirationTime=t.expirationTime}}return e}static isPushSubAttributeAccepted(e){return e===b||e===w}static sendBeacon(e){Wt.getBatchRequestOptions(e).then((e=>{var t=(t=st.get()).baseDomainName+re+t.appId+"?"+(new Date).getTime();ve.log(1,"MoeApi.sendBeacon","[sendBeacon] batch payload: "+JSON.stringify(e)),navigator.sendBeacon(t,JSON.stringify(e))}))}}Wt.baseLogTag="MoeApi",Wt.onDeviceAdd=new ke,Wt.webSdkApiRetries=1,Wt.offlineEvents=[],Wt.addReportApiRetries=1,Wt.eventStore=pe.createInstance({driver:[pe.INDEXEDDB,pe.WEBSQL,pe.LOCALSTORAGE],name:$,storeName:Z});const Ut=n(967),Ht=r.Q;class Ft{static clear(e){var t=Ft.baseLogTag+".clear";const n=[];for(;!ye.isEmpty(e);)switch(e){case Ht.REPORT:const i=ye.dequeue(Ht.REPORT);n.push((e=>{Wt.reportAdd(i).then((()=>{e()}))}));break;case Ht.DEVICE:ye.dequeue(Ht.DEVICE)&&n.push((e=>{Wt.deviceAdd().then((()=>{e()}))}));break;default:ve.error(1,t,"Do not know how to handle queue with name:",e)}setTimeout((()=>{Ft.processing[e]=!0,Ut(n,5,((t,n)=>{Ft.processing[e]=!1}))}),0)}static startPeriodicClear(e){const t=Ft.baseLogTag+".startPeriodicCleanQ";Ft.clearInterval(e);var n=()=>{ye.isEmpty(e)?(ve.log(1,t,"If you see multiple event tracks with same, they were captured over multiple visits or page refreshes."),me(Ft.processing,e,!1)||Ft.clearInterval(e)):(Ft.clear(e),ve.log(1,t,"Starting periodic queue clear for",e))};n(),Ft.intervals[e]=setInterval(n,6e3)}static clearInterval(e){null!=Ft.intervals[e]&&(clearInterval(Ft.intervals[e]),Ft.intervals[e]=null)}}Ft.baseLogTag="QManager",Ft.intervals={},Ft.processing={};class Kt{constructor(e,t,n=!0){this.name=e,this.attributes=t,n&&this.attributes.push(new lt("URL",location.href))}static createUserAttributeEvent(e){return new Promise(((t,n)=>{const i=[],a=e.key;switch(e.key){case"id":e.key=_;break;case"email":e.key=b;break;case"name":e.key=y;break;case"first_name":e.key=T;break;case"last_name":e.key=I;break;case"mobile":e.key=w;break;case"gender":e.key=A;break;case"birthday":e.key=O}i.push(e),yt.get().then((n=>{var r=n.indexOfAttribute("oldUniqueIds");-1<r&&null!=n.attributes[r].value&&0<n.attributes[r].value.length&&i.push(new lt(D,n.attributes[r].value[n.attributes[r].value.length-1])),e.key!==a&&ve.log(2,"Event.createUserAttributeEvent","Key changed to MoE reserved keyname: ",e.key),t(new Kt("EVENT_ACTION_USER_ATTRIBUTE",i,!1))}))}))}static createEvent(e,t,n){return new Promise(((i,a)=>{yt.get().then((a=>function(e,t,n,i){return new(n=n||Promise)((function(t,a){function r(e){try{s(i.next(e))}catch(e){a(e)}}function o(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var i;e.done?t(e.value):((i=e.value)instanceof n?i:new n((function(e){e(i)}))).then(r,o)}s((i=i.apply(e,[])).next())}))}(this,0,void 0,(function*(){try{var r=new lt("moe_logged_in_status",!!a.getAttribute("id"));const s=new qe;var o=new lt("moe_first_visit",s.getNumberOfSessions()<=1);t.push(r,o),i(new Kt(e,t,n))}catch(r){ve.error(1,"Event.createEvent","Error occurred in create events ",r)}}))))}))}}class jt{static addEvent(e){jt.history.push(e),jt.listeners.forEach((t=>{t(e)}))}static getHistory(){return jt.history}static addEventListener(e){jt.listeners.push(e)}static clear(){jt.history=[]}}var Gt;jt.history=[],jt.listeners=[];class Vt{static track(e,t,n){const i="MoEngage.event.trackEvent";return new Promise(((a,r)=>function(e,t,n,i){return new(n=n||Promise)((function(t,a){function r(e){try{s(i.next(e))}catch(e){a(e)}}function o(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var i;e.done?t(e.value):((i=e.value)instanceof n?i:new n((function(e){e(i)}))).then(r,o)}s((i=i.apply(e,[])).next())}))}(this,0,void 0,(function*(){n=!!n;const r=yield Wt.getWebSDKSettings();if("string"==typeof e&&e)if(r.b_e&&r.b_e.includes(e))ve.log(1,i,`This event "${e}" is blacklisted. Please contact Moengage team to whitelist it.`),a({error:5001,message:`Event "${e}" is blacklisted.`});else if(!ce.includes(e)||r.w_e&&r.w_e.includes(e))try{const o=[];if(null==t||null!==t&&t===Object(t)&&"[object Object]"===Object.prototype.toString.call(t)){for(const e in t=null==t?{}:t)t.hasOwnProperty(e)&&o.push(new lt(e,t[e]));const i=new qe;yield i.initiateSessionAndSource(r.s_s_d);const l=yield Kt.createEvent(e,o);jt.addEvent(l),Wt.collectGetParams().then((t=>{e===s&&delete t.push_id;const o=new wt(wt.REPORT_ADD_TYPE.EVENT,t,l);var c={session_id:i.getSessionKey(),start_time:i.getSessionStartTime(),background_initiated:0};const d=[];(t=i.getActiveSource())&&(i.setCurrentSource(t),d.push(t)),o.postData.meta.session=c,d.length&&(o.postData.meta.source=d),i.isNonEventInteractive(l)&&(o.postData.nie=1),Wt.reportAdd(o,n).then((()=>{r.s_s_s!==C.ALLOWED||i.isNonEventInteractive(l)||i.extendSession(),a(!0)}))}))}else ve.error(1,i,"Event attributes were not passed a key-value pair object for event: ",e),a({error:5002,message:"Event value needs to be a key-value pair object"})}catch(e){ve.error(1,i,"Error occurred in tracking events ",e)}else ve.log(1,i,`This event "${e}" has not been whitelisted. Please contact Moengage team to whitelist it.`),a({error:5001,message:`Event "${e}" is not whitelisted.`});else ve.log(1,i,"Event name not a string or null or empty string:",e),a({error:5001,message:"Event name can not be null"})}))))}}class Yt{static addCallback(e,t){null!=e&&null!=t&&(null==Yt.callbacks[e]&&(Yt.callbacks[e]=[]),Yt.callbacks[e].push(t))}static getCallbacks(e){return Yt.callbacks[e]||[]}static runCallbacks(e){Yt.getCallbacks(e).forEach((e=>{e()}))}}Yt.callbacks={};class qt{constructor(e){this.swRegisterPromise=null,this.swActiveRetries=1;const t=qt.baseLogTag+".constructor";this.sdkSettings=e,this.registerServiceWorker().then((e=>{this.sendDataToServiceWorker()})).catch((e=>{ve.error(1,t,"Error registering serviceworker:",e)}))}showHardAsk(){const e=qt.baseLogTag+".showHardAsk";return new Promise(((t,n)=>{qt.isWebPushSupported().then((i=>{i?this.getCurrentPermissionState().then((i=>{this.registerServiceWorker().then((a=>{i!==Ge.DENIED?(ve.log(1,e,"Attempting to open hard ask"),Vt.track(v),Bt.broadcastToWindow({topic:N,name:k.HARD_ASK_ATTEMPTED}),this.showOverlay(),this.askPermission().then((n=>{this.hideOverlay(),ve.log(2,e,"Permission state after hard ask:",n),n===Ge.GRANTED?this.getPushTokenDetails().then((e=>{this.sendDataToServiceWorker(e.token),t({state:n,subscriptionDetails:e})})):(this.sendDataToServiceWorker(),t({state:n,subscriptionDetails:null}))})).catch((t=>{ve.error(1,e,t),n(L)}))):(ve.log(1,e,"Hard ask not shown as permission state is",i),t({state:i,subscriptionDetails:null}))})).catch((t=>{ve.error(1,e,"Error registering serviceworker:",t),n(t)}))})).catch((t=>{ve.error(1,e,"Registering service worker failed:",t),n(L)})):(ve.warn(1,e,"Web push not supported in current browser environment"),n(P))}))}))}sendDataToServiceWorker(e){return new Promise((t=>{Wt.collectGetParams().then((t=>{e&&(t.push_id=e||be.get(r.PUSH_TOKEN)||void 0),t.isBatchingEnabled=be.get(r.WEB_SETTINGS).s_e_b_e;const n=st.get().swPath;if(n&&n.includes("tools/moengage")){const e=pe.createInstance({driver:[pe.INDEXEDDB],name:"moe_database",storeName:"moe_data"});e.ready().then((()=>{e.setItem("reportParams",{data:t})}))}else navigator.serviceWorker.ready.then((()=>{this.sendDataToServiceWorkerOnControllerReady(t)}))}))}))}sendDataToServiceWorkerOnControllerReady(e){navigator.serviceWorker.controller?navigator.serviceWorker.controller.postMessage({data:e}):this.swActiveRetries<3&&setTimeout((()=>{this.swActiveRetries++,this.sendDataToServiceWorkerOnControllerReady(e)}),500)}getCurrentPermissionState(){return Xe.getInstance().then((e=>navigator.permissions&&!e.isSafari()?navigator.permissions.query({name:"notifications"}).then((e=>qt.parsePermissionState(e.state))).catch((e=>{})):new Promise((t=>{let n=Notification.permission;e.isSafari()&&"default"===n&&(n="prompt"),t(qt.parsePermissionState(n))}))))}getPushTokenDetails(){const e=qt.baseLogTag+".getPushTokenDetails";return new Promise(((t,n)=>{this.getCurrentPermissionState().then((n=>{Xe.getInstance().then((i=>{n!==Ge.GRANTED?t({token:null,raw:null}):this.registerServiceWorker().then((n=>{let a=null;const r={userVisibleOnly:!0};Oe(this.sdkSettings.platformSettings,i)&&(a=De(this.sdkSettings.platformSettings,i),r.applicationServerKey=we(a));const o=()=>{n.pushManager.subscribe(r).then((e=>{(e=>{const n=e.toJSON();var a=e.endpoint.substring(0,n.endpoint.lastIndexOf("/")+1);e=n.expirationTime;let r=n.endpoint.split("/")[n.endpoint.split("/").length-1];i.isEdge()&&(r=r.replace("?token=",""));const o={};if(n.keys)for(const e in n.keys)n.keys.hasOwnProperty(e)&&(o[e]=n.keys[e]);t({token:r,endpoint:a,keys:o,expirationTime:e,raw:n})})(e)})).catch((n=>{ve.error(1,e,"Error in subscribtion: ",n),t({token:null,raw:null})}))};n.pushManager.getSubscription().then((e=>{if(e)if("vapid"===this.sdkSettings.platformSettings.chrome.subscriptionMode&&e.options&&e.options.applicationServerKey){var t=Ae(e.options.applicationServerKey);[a,a+"=",a+"==",Ae(we(a))].indexOf(t)<0?e.unsubscribe().then((()=>{o()})):o()}else o();else o()}))})).catch((n=>{ve.error(1,e,"Error in getting push token: ",n),t({token:null,raw:null})}))}))}))}))}isTokenValid(){return this.getPushTokenDetails().then((e=>ct.isTokenValid(e.token,this.sdkSettings.platformSettings.chrome.apiKey)))}removeToken(){return be.remove(r.PUSH_TOKEN),Promise.resolve()}askPermission(){return new Promise(((e,t)=>{Notification.requestPermission().then((t=>{be.set(r.OPT_IN_SHOWN_TIME,Date.now()),Vt.track(p),Bt.broadcastToWindow({topic:N,name:k.HARD_ASK_SHOWN}),Bt.deprecatedSdkCallback("opt_in_shown"),Yt.runCallbacks(k.HARD_ASK_SHOWN),e(qt.parsePermissionState(t))})).catch((e=>{t(B)}))}))}registerServiceWorker(){const e=qt.baseLogTag+".registerServiceWorker";return null!=this.swRegisterPromise||(this.swRegisterPromise=new Promise(((t,n)=>{if(qt.registeredServiceWorker)t(qt.registeredServiceWorker);else if("serviceWorker"in navigator){let i,a=!1;if(a=st.get()&&null!=st.get().swPath?(i=st.get().swPath,!0):(i=this.sdkSettings.platformSettings.chrome.serviceWorkerFilename,!1),"/"===i[0]||i.startsWith("http")||(i="/"+i),i.includes("tools/moengage"))ve.log(1,e,"Removing scope in case of shopify."),navigator.serviceWorker.register(i).then((i=>{ve.log(2,e,"Serviceworker registered"),navigator.serviceWorker.getRegistrations().then((n=>{n.forEach((n=>{n.active&&n.active.scriptURL.match(/moengage/)&&(ve.log(2,e,"Serviceworker ready"),qt.registeredServiceWorker=n,st.get()&&st.get().forceSwUpdate&&n.update(),t(n))}))})).catch((t=>{ve.error(1,e,"Service worker register failed:",t),n(L)}))})).catch((t=>{ve.error(1,e,"Service worker register failed:",t),n(L)}));else{let r="/";if(st.get()&&null!=st.get().swScope)r=st.get().swScope;else if(this.sdkSettings.platformSettings.chrome.isServiceWorkerRoot)a&&(ve.log(1,e,"Using user defined path to serviceworker:",i),r=i.substr(0,i.lastIndexOf("/")+1),qt.canSwBeRegisteredWithScope(r)||(ve.error(1,e,"Service worker can only be registered from same directory or child directory."),n(x)));else{const e=window.location.pathname;r=e.substring(0,e.lastIndexOf("/")+1)}ve.log(1,e,"Scope for serviceworker:",r),navigator.serviceWorker.register(i,{scope:r}).then((i=>{ve.log(2,e,"Serviceworker registered"),navigator.serviceWorker.ready.then((n=>{ve.log(2,e,"Serviceworker ready"),qt.registeredServiceWorker=n,st.get()&&st.get().forceSwUpdate&&n.update(),t(n)})).catch((t=>{ve.error(1,e,"Service worker register failed:",t),n(L)}))})).catch((t=>{ve.error(1,e,"Service worker register failed:",t),n(L)}))}}else ve.error(1,e,"Service worker not supported"),n("Service worker not supported")}))),this.swRegisterPromise}static canSwBeRegisteredWithScope(e){var t=window.location.pathname;return e=e,!((t=t).indexOf(e)<0)&&0<=t.substring(t.indexOf(e)).length}static isWebPushSupported(){return new Promise((e=>{Xe.getInstance().then((t=>{!t.isIncognito&&"serviceWorker"in navigator&&"PushManager"in window&&t.isWebPushCompatible()?e(!0):e(!1)}))}))}static parsePermissionState(e){return"prompt"===e?Ge.PROMPT:"granted"===e?Ge.GRANTED:"denied"===e?Ge.DENIED:"default"===e?Ge.DISMISSED:null}showNotification(e){const t=qt.baseLogTag+".showNotification";this.registerServiceWorker().then((n=>{e?e.title?e.body?(null==e.requireInteraction&&(e.requireInteraction=!0),n.showNotification(e.title,e)):ve.error(1,t,"Notification body can not be blank"):ve.error(1,t,"Notification title can not be blank"):ve.error(1,t,"Notification object can not be blank")})).catch((e=>{ve.error(1,t,"Error registering serviceworker:",e)}))}showOverlay(){if(this.sdkSettings.optInConfig.showOverlay){const e=document.createElement("div");e.id="moe-push-div",e.style.display="none",e.className="moe-push-class",Xe.getInstance().then((t=>{t.isMobile?e.innerHTML=this.sdkSettings.optInConfig.softAskConfig.mobile.customHTML:e.innerHTML=this.sdkSettings.optInConfig.softAskConfig.desktop.customHTML;const n=document.body.firstChild;let i;if(n.parentNode.insertBefore(e,n),(t=t.name)===Xe.BROWSER_NAMES.CHROME||t===Xe.BROWSER_NAMES.OPERA_NEON?i=document.getElementsByClassName("moe_chrome"):t===Xe.BROWSER_NAMES.FIREFOX?i=document.getElementsByClassName("moe_firefox"):t!==Xe.BROWSER_NAMES.OPERA&&t!==Xe.BROWSER_NAMES.SAFARI||(i=document.getElementsByClassName("moe_opera")),0===i.length)document.getElementById("moe-push-div").style.display="none";else for(let e=i.length-1;0<=e;e--)i[e].style.display="block";this.overlayTimer=window.setTimeout((()=>{""===e.style.opacity&&(e.style.display="block")}),1500),e.onclick=()=>{this.hideOverlay()}}))}}hideOverlay(){clearTimeout(this.overlayTimer);const e=document.getElementById("moe-push-div");null!=e&&(e.style.visibility="none",e.style.opacity="0",e.parentNode.removeChild(e))}}qt.baseLogTag="HTTPS-NotificationManager";const zt="Web push settings not configured on MoEngage dashboard: "+X;class Xt{constructor(e,t){this.currentManager=null;var n=Xt.baseLogTag+".constructor";this.config=e,(this.browser=t).isIncognito?(this.currentManager=null,ve.warn(1,n,"Web push not supported in incognito mode")):this.browser.isWebPushCompatible()&&e.platformSettings.chrome?(e.platformSettings.chrome.domainType===ft.DOMAIN_TYPE.HTTPS?"http"===Ie()?ve.error(1,n,"Domain configured as a HTTPS site and this is a HTTP site. Please update correct settings at",X):this.currentManager=new qt(e):e.platformSettings.chrome.domainType===ft.DOMAIN_TYPE.HTTP?this.currentManager=new ut(e):e.platformSettings.chrome.domainType===ft.DOMAIN_TYPE.MUTLI&&("https"===Ie()?this.currentManager=new qt(e):this.currentManager=new ut(e)),!1===e.platformSettings.chrome.enabled&&ve.warn(1,n,"Web push settings not configured. Please configure at ",X)):this.browser.name===Xe.BROWSER_NAMES.SAFARI&&e.platformSettings.safari&&"safari"in window&&"pushNotification"in window.safari&&(this.currentManager=null,ve.warn(1,n,"Web push is only supported on Safari 16 and above."))}showHardAsk(){const e=Xt.baseLogTag+".showHardAsk";return new Promise(((t,n)=>{this.getCurrentPermissionState().then((i=>{null!=this.currentManager?i===Ge.PROMPT?this.currentManager.showHardAsk().then((n=>{n.state===Ge.DISMISSED?(Vt.track(f),Bt.broadcastToWindow({topic:N,name:k.HARD_ASK_DISMISSED}),Bt.deprecatedSdkCallback("opt_in_dismissed"),Yt.runCallbacks(k.HARD_ASK_DISMISSED),ve.log(1,e,"Hard ask was dismissed")):n.state===Ge.GRANTED?(Vt.track(m),Bt.broadcastToWindow({topic:N,name:k.HARD_ASK_ALLOWED,data:n.subscriptionDetails}),Bt.deprecatedSdkCallback("opt_in_allowed"),Yt.runCallbacks(k.HARD_ASK_ALLOWED),ve.log(1,e,"Push permission was granted"),ve.customLabel(1,e,"token",n.subscriptionDetails.token)):n.state===Ge.DENIED&&(Vt.track(S),Vt.track("Web Push Opt-in Denied"),Bt.broadcastToWindow({topic:N,name:k.HARD_ASK_DENIED}),Bt.deprecatedSdkCallback("opt_in_blocked"),Yt.runCallbacks(k.HARD_ASK_DENIED),ve.log(1,e,"Notification permission was denied")),t(n)})).catch((n=>{ve.error(1,e,"Error showing hard ask:",n),t({state:i,subscriptionDetails:null})})):(ve.log(1,e,"Not showing Hard Ask as current permission state is",i),this.getPushTokenDetails().then((n=>{ve.customLabel(1,e,"token",n.token),t({state:i,subscriptionDetails:n})})).catch((n=>{ve.warn(1,e,"Could not get push token details"),t({state:i,subscriptionDetails:null})}))):(ve.log(1,e,"MoEngage web push settings not configured. Please configure at",X),n(M))})).catch((e=>{n(e)}))}))}getCurrentPermissionState(){return null!=this.currentManager?this.currentManager.getCurrentPermissionState():Promise.reject(zt)}getPushTokenDetails(){return null!=this.currentManager?this.currentManager.getPushTokenDetails():Promise.reject(zt)}isTokenValid(){return null!=this.currentManager?this.currentManager.isTokenValid():Promise.reject(zt)}removeToken(){return null!=this.currentManager?this.currentManager.removeToken():Promise.reject(zt)}showNotification(e){var t=Xt.baseLogTag+".showNotification";if(null!=this.currentManager)return this.currentManager.showNotification(e);ve.warn(1,t,zt)}}Xt.baseLogTag="NotificationManager";class Qt{constructor(e){this.mainDivs=[],this.config=e}showSoftAsk(){const e=Qt.baseLogTag+".showSoftAsk";return new Promise(((t,n)=>{let i=this.config.optInConfig.loadTime;Xe.getInstance().then((n=>{(this.config.optInConfig.type===ht.TYPE.SELF_HANDLED||n.isSafari()&&this.config.optInConfig.type===ht.TYPE.ONE_CLICK)&&(i=0),i&&ve.log(1,e,"Delay of",i," second(s) requested before opt-in flow"),setTimeout((()=>{n.isWebPushCompatible()&&"https"===Ie()&&this.config.platformSettings.chrome.domainType===ft.DOMAIN_TYPE.MUTLI||this.config.optInConfig.type!==ht.TYPE.TWO_STEP&&this.config.optInConfig.type!==ht.TYPE.SELF_HANDLED?(be.set(r.SOFT_ASK_STATUS,Gt.NOT_SHOWN),t({showHardAsk:!0,softAskState:Gt.NOT_SHOWN})):this.showOptIn((()=>{ve.log(1,e,"Soft ask was shown"),be.set(r.OPT_IN_SHOWN_TIME,Date.now()),be.set(r.SOFT_ASK_STATUS,Gt.SHOWN),Bt.broadcastToWindow({topic:N,name:k.SOFT_ASK_SHOWN}),Bt.deprecatedSdkCallback("soft_ask_shown"),Yt.runCallbacks(k.SOFT_ASK_SHOWN)}),(()=>{Vt.track(g),this.hideOptIn(),ve.log(1,e,"Soft ask was allowed"),be.set(r.SOFT_ASK_STATUS,Gt.ALLOWED),t({showHardAsk:!0,softAskState:Gt.ALLOWED}),Bt.broadcastToWindow({topic:N,name:k.SOFT_ASK_ALLOWED}),Bt.deprecatedSdkCallback("soft_ask_allowed"),Yt.runCallbacks(k.SOFT_ASK_ALLOWED)}),(()=>{this.hideOptIn(),Vt.track(u),ve.log(1,e,"Soft ask was dismissed"),be.set(r.SOFT_ASK_STATUS,Gt.DISMISSED),t({showHardAsk:!1,softAskState:Gt.DISMISSED}),Bt.broadcastToWindow({topic:N,name:k.SOFT_ASK_DISMISSED}),Bt.deprecatedSdkCallback("soft_ask_closed"),Yt.runCallbacks(k.SOFT_ASK_DISMISSED)}),(e=>{e=!!e,this.hideOptIn(),t({showHardAsk:e,softAskState:Gt.NOT_SHOWN})}))}),1e3*i)}))}))}showOptIn(e,t,n,i){const a=Qt.baseLogTag+".showOptIn";if(this.config.optInConfig.type===ht.TYPE.TWO_STEP){let r=document.getElementById("moe-push-div");null==r&&(r=document.createElement("div"),r.id="moe-push-div",r.className="moe-push-class"),Xe.getInstance().then((o=>{let s=null;if(s=(o.isMobile?this.config.optInConfig.softAskConfig.mobile:this.config.optInConfig.softAskConfig.desktop).customHTML,null!=s){r.innerHTML=s;const o=document.body.firstChild;o.parentNode.insertBefore(r,o),this.moeDiv=r;const l=document.getElementById("optInText")||document.getElementById("optInTextConventional"),c=document.getElementById("moe-dontallow_button");null==l?(ve.error(1,a,"Error showing soft ask. Allow button id is missing"),i()):(e(),Vt.track(d),l.onclick=()=>{t()},c?c.onclick=()=>{n()}:window.moeRemoveBanner=()=>{n()})}else ve.error(1,a,"Error displaying soft ask"),i()}))}else if(this.config.optInConfig.type===ht.TYPE.SELF_HANDLED){var r=st.get();if(r.customSoftAsk){var o=document.getElementsByClassName(r.customSoftAsk.mainClass),s=document.getElementsByClassName(r.customSoftAsk.allowClass),l=document.getElementsByClassName(r.customSoftAsk.dismissClass);if(o.length<1)ve.error(1,a,"Could not find main class for the soft ask. Class name given:",r.customSoftAsk.mainClass),Xe.getInstance().then((e=>{(e.isWebPushCompatible()&&this.config.platformSettings.chrome.domainType===ft.DOMAIN_TYPE.HTTPS||this.config.platformSettings.chrome.domainType===ft.DOMAIN_TYPE.MUTLI&&"https"===Ie()||e.name===Xe.BROWSER_NAMES.SAFARI)&&(ve.warn(1,a,"Proceeding to hard ask directly"),i(!0))}));else{e(),s.length<1&&(ve.warn(1,a,"Could not find any element for allow button. Class name given:",r.customSoftAsk.allowClass),ve.warn(1,a,"Docs for self-handled opt in available here - ",z.SELF_HANDLED_DOCS)),l.length<1&&ve.warn(1,a,"Could not find any element for dismiss button. Class name given:",r.customSoftAsk.dismissClass);for(let e=o.length-1;0<=e;e--){const t=o[e];this.mainDivs.push(t),t.style.display="block"}for(let e=s.length-1;0<=e;e--)s[e].onclick=()=>{t()};for(let e=l.length-1;0<=e;e--)l[e].onclick=()=>{n()}}}else Xe.getInstance().then((e=>{e.isWebPushCompatible()&&this.config.platformSettings.chrome.domainType===ft.DOMAIN_TYPE.HTTPS||this.config.platformSettings.chrome.domainType===ft.DOMAIN_TYPE.MUTLI&&"https"===Ie()||e.name===Xe.BROWSER_NAMES.SAFARI?(ve.warn(1,a,"No soft ask configured. Proceeding to hard ask directly. \n\nYou can ignore this message if you do not want any soft ask."),i(!0)):(ve.error(1,a,"Soft ask needs to be present in case of http implementation. Can not show hard ask otherwise."),i())}))}}hideOptIn(){null!=this.moeDiv&&(this.moeDiv.style.display="none"),0<this.mainDivs.length&&this.mainDivs.map((e=>{e.style.display="none"}))}}Qt.baseLogTag="SoftAskManager",(si=Gt=Gt||{}).SHOWN="shown",si.NOT_SHOWN="not shown",si.ALLOWED="allowed",si.DISMISSED="dismissed";class Jt{constructor(e){this.deviceToLogout=me(e,"deviceToLogout",null)}static get(){return new Jt(be.get(r.GRACEFUL_DATA))}save(){be.set(r.GRACEFUL_DATA,this)}}var $t=function(e,t,n,i){return new(n=n||Promise)((function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))};const Zt="MoEngage.user";class en{static addAttribute(e,t){const n=Zt+".addUserAttribute";return new Promise(((i,a)=>{let r=!1;if("string"!=typeof e||null==e)ve.error(1,n,"Attribute name needs to be a string"),i({error:5e3,message:"Attribute name needs to be a string. Type provided was "+typeof e});else if(""===e)ve.error(1,n,"Attribute name can not be an empty string"),i({error:5001,message:"Attribute name can not be an empty string"});else if(null==t)ve.error(1,n,"Attribute value null"),i({error:5003,message:"Attribute value was empty"});else if("string"==typeof t&&""===t)i({error:5004,message:"Attribute value needs to be non-empty string, non-empty array or date object"});else if("object"!=typeof t||Array.isArray(t)||"function"==typeof t.getMonth)if("object"==typeof t&&Array.isArray(t)&&0===t.length)ve.error(1,n,"Value cannot be empty, non-string, non-array or non-date object"),i({error:5006,message:"Attribute value needs to be non-empty string, non-empty array or date object"});else if("object"==typeof t&&Array.isArray(t)&&void 0!==t.find((e=>"object"==typeof e&&"function"!=typeof e.getMonth)))ve.error(1,n,"Elements of the attribute value-array cannot be non-Date objects"),i({error:5007,message:"Attribute value-array cannot have non-Date objects as its elements"});else{const a=new lt(e,t),o=()=>{yt.get().then((e=>{e.addAttribute(a).then((e=>{e?("id"===a.key&&ve.log(1,n,"Logging in the user with id: ",a.value),Kt.createUserAttributeEvent(a).then((e=>{ve.log(2,n,"Event to be converted to report:",e),jt.addEvent(e),Wt.collectGetParams().then((t=>{t=new wt(wt.REPORT_ADD_TYPE.USER_ATTRIBUTE,t,e),Wt.reportAdd(t).then((()=>{r&&oi.onsite.refresh&&oi.onsite.refresh(),i(!0)}))}))}))):(ve.log(1,n,"Attribute already present/queued. Not adding again."),i({error:5005,message:"Attribute already present/queued. Not adding again."}))}))}))};"id"===e?(r=!0,yt.get().then((e=>{var a=e.indexOfAttribute("id");-1<a?(r=!1,t===e.attributes[a].value?(ve.log(1,n,"User already logged in with id:",t),i(!0)):(ve.log(1,n,"Logging out previous user with id:",e.attributes[a].value),en.logout(!0,t).then((()=>{o()})))):o()}))):o()}else ve.error(1,n,"Value cannot be empty, non-string, non-array or non-date object"),i({error:5005,message:"Attribute value needs to be non-empty string, non-empty array or date object"})}))}static login(e){return Ue(),en.addAttribute("id",e)}static logout(e,t){const n=e?{type:"forced",new_uid:t}:null;return function(){const e=Jt.get();null!=yt.getSync()&&(e.deviceToLogout=yt.getSync().deviceUuid,e.save())}(),new Promise((e=>{Vt.track(E,n).then((()=>$t(this,void 0,void 0,(function*(){ve.log(1,"MoEngage.user.logout","Logging out now!"),yield Lt.flushReports(),Wt.getWebSDKSettings().then((t=>$t(this,void 0,void 0,(function*(){t.isDomainLevelStorage&&Ee.remove(r.USER_DATA),jt.clear(),yield di(),yield function(){return ti(this,void 0,void 0,(function*(){st.get();try{Wt.getWebSDKSettings().then((e=>ti(this,void 0,void 0,(function*(){if(null!=e&&e.c_s){const e=yield nn.loadModule(ie.CARDS);yield e.logout(),ai=new ke}}))))}catch(e){ve.error(1,"Moengage.disableCards","Error logging out from cards module:",e)}}))}(),Ue(),be.logout(),yield yt.logout(),be.remove(r.GRACEFUL_DATA),Wt.onDeviceAdd=new ke,yield Si(),e(!0)}))))}))))}))}static updateUniqueId(e){const t=Zt+".updateUniqueId";return new Promise((n=>{yt.get().then((i=>{var a=i.indexOfAttribute(_),r=i.indexOfAttribute("oldUniqueIds");if(!(-1<a))return ve.log(2,t,"Logging in as no id found"),en.login(e);var o=i.attributes[a].value;e!==o?(ve.log(2,t,"Different ids found"),-1<r?(i.attributes[r].value.push(o),i.attributes.splice(a,1)):(i.attributes.splice(a,1),i.addAttribute(new lt("oldUniqueIds",[o]))),i.save().then((()=>{en.login(e).then((()=>{n(!0)}))}))):(ve.warn(1,t,"New id and old id are the same. Not updating the id."),n(!0))}))}))}static getAttributes(){const e=yt.getSync().attributes,t={};return e.map((e=>{t[e.key]=e.value})),t}}class tn{constructor(e,t){this.notificationManager=null,this.softAskManager=null,tn.baseLogTag,this.sdkSettings=e,this.browser=t,this.softAskManager=new Qt(this.sdkSettings),this.notificationManager=new Xt(this.sdkSettings,t)}callWebPush(){const e=tn.baseLogTag+".callWebPush";this.isWebPushEnabled()&&this.notificationManager.getCurrentPermissionState().then((t=>{const n=()=>{yt.get().then((n=>{let i=!1;var a=n.getAttribute("email"),o=n.getAttribute("mobile");null===a&&null===o||(i=!0),n.deviceAdded=i,n.save().then((()=>{this.notificationManager.removeToken().then((()=>{t===Ge.DENIED?ve.log(1,e,"Not asking for permission as current state is denied."):(be.remove(r.OPT_IN_SHOWN_TIME),this.startPushSubscription())}))}))}))};var i=be.get(r.PUSH_TOKEN);null==i&&t!==Ge.DENIED?this.startPushSubscription():null!=i&&t===Ge.DENIED?(ve.log(1,e,"User has removed the permission"),ve.image(1,Y),Vt.track(s,{Source:"Website"}).then((()=>{n()}))):t===Ge.DENIED?ve.warn(1,e,"Not proceeding with push subscription as current state is denied"):null!=i&&t===Ge.GRANTED?this.browser.name===Xe.BROWSER_NAMES.CHROME?Oe(this.sdkSettings.platformSettings,this.browser)?this.startPushSubscription():ve.warn(1,e,"Subscription mode is not VAPID type. Cannot subscribe to web push."):(this.startPushSubscription(),this.notificationManager.getPushTokenDetails().then((t=>{ve.customLabel(1,e,"token",t.token)}))):this.sdkSettings.isDomainLevelStorage?"granted"===Ee.get(r.HARD_ASK_STATUS)?(i=Ee.get(r.SUBSCRIPTION_DETAILS).domain)&&i===window.location.origin?(ve.log(1,e,"It seems that the user has unsubscribed manually. Starting push subscription.."),n()):ve.log(1,e,"Not showing opt-in as user subscribed to sub-domain"):this.startPushSubscription():n()})).catch((t=>{ve.error(1,e,"Error in getting current state:",t)}))}startPushSubscription(){const e=tn.baseLogTag+".startPushSubscription",t=()=>{be.set(r.HARD_ASK_STATUS,Ge.PROMPT);const t=be.get(r.PUSH_TOKEN);this.notificationManager.showHardAsk().then((n=>{be.set(r.HARD_ASK_STATUS,n.state),n.state===Ge.GRANTED?null!=n.subscriptionDetails.token?(be.set(r.PUSH_TOKEN,n.subscriptionDetails.token),n.subscriptionDetails.domain=window.location.origin,be.set(r.SUBSCRIPTION_DETAILS,n.subscriptionDetails),n.subscriptionDetails.token&&t!==n.subscriptionDetails.token&&Wt.deviceAdd().then((()=>{ve.image(1,"https://media.giphy.com/media/90F8aUepslB84/giphy.gif"),yt.getSync().subscribedToOldSdk?ve.log(1,e,"User subscribed from older sdk, hence not sending subscription event"):(null!=t?en.addAttribute("Web Migrated User","true"):(en.addAttribute("Web Push Preference","granted"),en.addAttribute("Web Subscription URL",location.href)),We(),Vt.track(h,{MOE_WEB_PUSH_TOKEN:n.subscriptionDetails.token,migrated_user:!!We()||void 0}))})),this.sdkSettings.isDomainLevelStorage&&(Ee.set(r.SUBSCRIPTION_DETAILS,{domain:n.subscriptionDetails.domain,token:n.subscriptionDetails.token,endpoint:n.subscriptionDetails.endpoint,keys:n.subscriptionDetails.keys}),Ee.set(r.PUSH_TOKEN,n.subscriptionDetails.token))):(ve.error(1,e,"Push token was received as null."),ve.error(1,e,"Please contact MoEngage support if this troubleshooting does not solve the issue.")):n.state===Ge.DENIED&&ve.image(1,Y)})).catch((t=>{ve.warn(1,e,t)}))},n=()=>{this.softAskManager?this.softAskManager.showSoftAsk().then((e=>{e.showHardAsk&&t()})):ve.log(1,e,"SoftAskManager not set.")};this.notificationManager.getCurrentPermissionState().then((i=>{if(i===Ge.GRANTED)this.sdkSettings.optInConfig.type!==ht.TYPE.ONE_CLICK&&ve.log(1,e,"Skipping soft ask as browser permission is set to allow all notifications"),t();else{var a=parseInt(be.get(r.OPT_IN_SHOWN_TIME));if(be.get(r.SOFT_ASK_STATUS),be.get(r.HARD_ASK_STATUS),i=(Date.now()-a)/36e5,!a||i>this.sdkSettings.optInConfig.reappearTime)if(this.browser.name===Xe.BROWSER_NAMES.SAFARI&&this.sdkSettings.optInConfig.type===ht.TYPE.ONE_CLICK){ve.log(1,e,"1 step optin configured. In Safari 16+ and macOS 13+, the web push optin will be shown after a user click. Any delay will be ignored.");const t=()=>{window.removeEventListener("click",t),n()};window.addEventListener("click",t)}else n();else{let t,n;n=i<1?(t=Math.floor(60*i),"minute(s)"):(t=Math.floor(100*i)/100,"hour(s)"),ve.log(1,e,"Not showing opt in as last it was shown",t,n,"back on",new Date(a),". Reappear time is set to",this.sdkSettings.optInConfig.reappearTime,"hours."),ve.log(1,e,"You can clear localstorage to get opt-in again.")}}}))}isWebPushEnabled(){return!this.browser.isIncognito&&0<=tn.SUPPORTED_BROWSERS.indexOf(this.browser.name)&&navigator.serviceWorker&&"PushManager"in window}getPermissionState(){return this.notificationManager.getCurrentPermissionState()}showNotification(e){this.notificationManager&&this.notificationManager.showNotification(e)}}tn.baseLogTag="WebPushManager",tn.SUPPORTED_BROWSERS=[Xe.BROWSER_NAMES.CHROME,Xe.BROWSER_NAMES.FIREFOX,Xe.BROWSER_NAMES.OPERA,Xe.BROWSER_NAMES.SAFARI,Xe.BROWSER_NAMES.EDGE];class nn{static loadModule(e){var t=nn.baseLogTag+".loadModule";return null!=nn.loadPromises[e.name]||(ve.log(1,t,"Starting to fetch module: ",e.name),nn.loadPromises[e.name]=new Promise(((t,n)=>{nn.addScript(e.src,(()=>{var n=new(0,window[ie[e.name].windowLocation])(n=st.get());t(n)}))}))),nn.loadPromises[e.name]}static addScript(e,t){const n=document.createElement("script");n.setAttribute("src",e),n.onload=t,n.async=!0,document.body.appendChild(n)}}nn.baseLogTag="ModuleManager",nn.loadPromises={};var an=function(e,t,n,i){return new(n=n||Promise)((function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))};class rn{static initialize(){return an(this,void 0,void 0,(function*(){var e;return null==rn.ready&&(rn.serviceMetaStore=pe.createInstance({driver:[pe.INDEXEDDB,pe.WEBSQL,pe.LOCALSTORAGE],name:ne.DATABASE_NAME,storeName:ne.STORES.SERVICE_META.NAME}),rn.campaingsMetaStore=pe.createInstance({driver:[pe.INDEXEDDB,pe.WEBSQL,pe.LOCALSTORAGE],name:ne.DATABASE_NAME,storeName:ne.STORES.CAMPAIGNS_META.NAME}),rn.campaingsTagsStore=pe.createInstance({driver:[pe.INDEXEDDB,pe.WEBSQL,pe.LOCALSTORAGE],name:ne.DATABASE_NAME,storeName:ne.STORES.CAMPAIGNS_TAGS.NAME}),rn.campaingsStatsStore=pe.createInstance({driver:[pe.INDEXEDDB,pe.WEBSQL,pe.LOCALSTORAGE],name:ne.DATABASE_NAME,storeName:ne.STORES.CAMPAIGNS_STATS.NAME}),rn.testCampaignStore=pe.createInstance({driver:[pe.INDEXEDDB,pe.WEBSQL,pe.LOCALSTORAGE],name:ne.DATABASE_NAME,storeName:ne.STORES.CAMPAIGNS_STATS.NAME}),rn.exitIntentCampaignStore=pe.createInstance({driver:[pe.INDEXEDDB,pe.WEBSQL,pe.LOCALSTORAGE],name:ne.DATABASE_NAME,storeName:ne.STORES.EXIT_INTENT_CAMPAIGN_STORE.NAME}),e=[rn.serviceMetaStore.ready(),rn.campaingsMetaStore.ready(),rn.campaingsTagsStore.ready(),rn.campaingsStatsStore.ready(),rn.testCampaignStore.ready(),rn.exitIntentCampaignStore.ready()],rn.ready=Promise.all(e)),rn.ready}))}static clear(){return an(this,void 0,void 0,(function*(){var e=rn.baseLogTag+".clear";try{yield rn.initialize(),yield Promise.all([rn.serviceMetaStore.clear(),rn.campaingsMetaStore.clear(),rn.campaingsTagsStore.clear(),rn.campaingsStatsStore.clear(),rn.testCampaignStore.clear(),rn.exitIntentCampaignStore.clear()]);var t=[rn.serviceMetaStore.ready(),rn.campaingsMetaStore.ready(),rn.campaingsTagsStore.ready(),rn.campaingsStatsStore.ready(),rn.testCampaignStore.ready(),rn.exitIntentCampaignStore.ready()];rn.ready=Promise.all(t)}catch(t){ve.error(1,e,"Error clearing onsite stores:",t)}return rn.ready}))}}rn.baseLogTag="MOE_ONSITE_STORES";var on,sn,ln,cn,dn,un=function(e,t,n,i){return new(n=n||Promise)((function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))};const gn=(e,t,n)=>null==e.campaignId?()=>{}:()=>(rn.campaingsStatsStore.getItem(e.campaignId).then((t=>{t=null!=t?Object.assign(Object.assign({},t),{clicks:me(t,"clicks",0)+1}):{clicks:1},rn.campaingsStatsStore.setItem(e.campaignId,t)})),null==n&&(n={}),fn().track_event(ne.EVENT_NAMES[t].CLICK,Object.assign(Object.assign({campaign_id:e.campaignId,campaign_name:e.campaignName,type:ne.EVENT_NAMES[t].TYPE},n),e.campaignContext))),hn=(e,t,n=!1)=>null==e.campaignId?()=>{}:()=>{if(rn.initialize().then((()=>{rn.campaingsStatsStore.getItem(e.campaignId).then((t=>{t=null!=t?Object.assign(Object.assign({},t),{impressions:me(t,"impressions",0)+1,lastImpression:new Date}):{impressions:1,lastImpression:new Date},rn.campaingsStatsStore.setItem(e.campaignId,t)}))})),!n)return fn().track_event(ne.EVENT_NAMES[t].IMPRESSION,Object.assign({campaign_id:e.campaignId,campaign_name:e.campaignName,type:ne.EVENT_NAMES[t].TYPE,templateType:e.templateType},e.campaignContext))},pn=(e,t,n)=>{n=n?ne.EVENT_NAMES[t].AUTO_DISMIS:ne.EVENT_NAMES[t].DISMISS,fn().track_event(n,Object.assign({campaign_id:e.campaignId,campaign_name:e.campaignName,type:ne.EVENT_NAMES[t].TYPE},e.campaignContext))},mn=(e,t)=>{fn().track_event(ne.EVENT_NAMES[t].DELIVERED,Object.assign({campaign_id:e.campaignId,campaign_name:e.campaignName,type:ne.EVENT_NAMES[t].TYPE},e.campaignContext))},fn=()=>window.Moengage;class Sn{static isValid(e,t){return!Sn.isCampaignExpired(e)&&Sn.isCampaignActive(e)&&Sn.isUserInCampaignSegment(e)&&Sn.isCampaignWithinFC(e,t)}static isValidMessagingCampaign(e,t,n,i,a){return Sn.canCampaignBeRenderedOverExisting(e,a)&&Sn.hasCampaignClearedSelfDelay(e,t)&&Sn.hasCampaignClearedGlobalDelay(e,n,i)}static isCampaignExpired(e){if((new Date).getTime>e.expiryTime.getTime){var t=Sn.baseLogTag+".isValid";return ve.warn(1,t,`Campaign ${e.campaignId} : Expired`),!0}return!1}static isCampaignActive(e){var t=Sn.baseLogTag+".isValid";return e.status===ln.ACTIVE||(ve.warn(1,t,`Campaign ${e.campaignId} : Status is `+e.status),!1)}static isUserInCampaignSegment(e){var t=Sn.baseLogTag+".isValid";return!!e.userInSegment||(ve.warn(1,t,`Campaign ${e.campaignId} : User is not in segment`),!1)}static isCampaignWithinFC(e,t){var n=Sn.baseLogTag+".isValid";if([dn.SELF_HANDLED].indexOf(e.templateType)<0){var i=me(e,"delivery.fc_meta.count",0);if(0<i){var a=me(t,"impressions",0);if(null!=t)return!(i<=a&&(ve.warn(1,n,`Campaign ${e.campaignId} : FC reached. ${t.impressions} times shown`),1))}}return!0}static canCampaignBeRenderedOverExisting(e,t){var n=Sn.baseLogTag+".isValid";return!(0<(t&&t.length)&&!e.display.config.showOverOtherCampaigns&&(ve.warn(1,n,`Can not show ${e.campaignId} over other existing campaigns`),1))}static hasCampaignClearedSelfDelay(e,t){var n=Sn.baseLogTag+".isValid",i=me(e,"delivery.fc_meta.delay",0);try{if(0<i&&null!=t){const i=t.lastImpression;var a=((new Date).getTime()-i.getTime())/1e3;if(a<=me(e,"delivery.fc_meta.delay",0))return ve.warn(1,n,`Can't render ${e.campaignId} as it was rendered ${a} seconds ago.`),!1}}catch(t){return ve.error(1,n,"Can't check self delay for "+e.campaignId,t),!1}return!0}static hasCampaignClearedGlobalDelay(e,t,n){var i=Sn.baseLogTag+".isValid",a=me(e,"delivery.fc_meta.ignore_global_delay",!1);try{if(!a){const a=new Date;if(n){var r=(a.getTime()-n.getTime())/1e3;if(t&&r<=t)return ve.log(1,i,`Can't render ${e.campaignId} as last global campaign was rendered ${r} seconds ago.`),!1}}}catch(e){return ve.error(1,i,"Error checking global delay:",e),!1}return!0}static comparator(e,t){return t.delivery.priority>e.delivery.priority||!(t.delivery.priority<e.delivery.priority)&&t.updatedTime>e.updatedTime?1:-1}}Sn.baseLogTag="CampaignUtils";const vn=e=>un(void 0,void 0,void 0,(function*(){var t=e.map((e=>rn.campaingsStatsStore.getItem(e.campaignId)));let n;try{n=yield Promise.all(t);const i=e.filter(((e,t)=>Sn.isValid(e,n[t])));return i.sort(Sn.comparator)}catch(t){return ve.error(1,"filterAndSortCampaigns","Error filtering and sorting campaigns: ",t),[]}}));class En{}En.REMOVE_TRAIL_CHARS=/[^\w\s]+$/gi;class _n{constructor(e,t,n,i){this.dataType=e,this.availableOperations=t,this.event=n,this.filter=i}validate(){return!(this.availableOperations.indexOf(this.filter.operator)<0)}checkEq(){let e=!1;return this.event.attributes.forEach((t=>{let n=t.value,i=this.filter.value;this.dataType===on.STRING&&typeof n===on.STRING&&(n=this.removeSpecialChars(n),i=this.removeSpecialChars(i)),t.key===this.filter.name&&(this.dataType!==on.STRING||this.filter.case_sensitive?n===i&&(e=!0):n.toLowerCase()===i.toLowerCase()&&(e=!0))})),e}checkExists(){let e=!1;return this.event.attributes.forEach((t=>{t.key===this.filter.name&&(e=!0)})),e}removeSpecialChars(e){return e.replace(En.REMOVE_TRAIL_CHARS,"")}}(si=on=on||{}).BOOL="bool",si.STRING="string",si.DATE="datetime",si.NUMBER="double",si.LONG="long",(si=sn=sn||{}).EQ="is",si.LT="lessThan",si.GT="greaterThan",si.BETWEEN="between",si.IN="in",si.EXISTS="exists",si.CONTAINS="contains",si.STARTSWITH="startsWith",si.ENDSWITH="endsWith",si.INTHELAST="inTheLast",si.INTHENEXT="inTheNext",si.AFTER="after",si.BEFORE="before",si.ON="on",si.TODAY="today";const bn=[sn.EQ,sn.EXISTS,sn.CONTAINS,sn.STARTSWITH,sn.ENDSWITH,sn.IN];class yn extends _n{constructor(e,t){super(on.STRING,bn,e,t)}evaluate(){yn.baseLogTag;let e=!1;var t=this.event.attributes.filter((e=>e.key===this.filter.name)),n=0<t.length?t[0]:null;if(null!=n&&Pe(n.value))switch(this.filter.operator){case sn.EQ:e=this.checkEq();break;case sn.EXISTS:e=this.checkExists();break;case sn.CONTAINS:e=this.checkContains(n);break;case sn.STARTSWITH:e=this.checkStartsWith(n);break;case sn.ENDSWITH:e=this.checkEndsWith(n);break;case sn.IN:e=this.checkIn(n)}return this.filter.negate?!e:e}checkContains(e){return this.filter.case_sensitive?0<=e.value.indexOf(this.filter.value):0<=e.value.toLowerCase().indexOf(this.filter.value.toLowerCase())}checkStartsWith(e){var t=(e,t)=>e.substr(0,t.length)===t;return this.filter.case_sensitive?t(e.value,this.filter.value):t(e.value.toLowerCase(),this.filter.value.toLowerCase())}checkEndsWith(e){var t=(e,t,n)=>((void 0===n||n>e.length)&&(n=e.length),e.substring(n-t.length,n)===t);if(this.filter.case_sensitive)return t(e.value,this.filter.value);const n=this.removeSpecialChars(e.value),i=this.removeSpecialChars(this.filter.value);return t(n.toLowerCase(),i.toLowerCase())}checkIn(e){let t=!1;if(Array.isArray(this.filter.value))for(let n=this.filter.value.length-1;0<=n;n--)if(this.filter.case_sensitive){if(this.filter.value[n]===e.value){t=!0;break}}else if(this.filter.value[n].toLowerCase()===e.value.toLowerCase()){t=!0;break}return t}}yn.baseLogTag="StringDataType";const Tn=[sn.EQ,sn.EXISTS];class In extends _n{constructor(e,t){super(on.BOOL,Tn,e,t)}evaluate(){let e=!1;switch(this.filter.operator){case sn.EQ:e=this.checkEq();break;case sn.EXISTS:e=this.checkExists()}return this.filter.negate?!e:e}}In.baseLogTag="BooleanDataType";const wn=[sn.EQ,sn.EXISTS,sn.GT,sn.LT,sn.BETWEEN,sn.IN];class An extends _n{constructor(e,t){super(on.NUMBER,wn,e,t)}evaluate(){An.baseLogTag;let e=!1;var t=this.event.attributes.filter((e=>e.key===this.filter.name)),n=0<t.length?t[0]:null;if(null!=n&&"number"==typeof n.value)switch(this.filter.operator){case sn.EQ:e=this.checkEq();break;case sn.EXISTS:e=this.checkExists();break;case sn.GT:e=this.checkGreaterThan(n);break;case sn.LT:e=this.checkLessThan(n);break;case sn.BETWEEN:e=this.checkBetween(n);break;case sn.IN:e=this.checkIn(n)}return this.filter.negate?!e:e}checkGreaterThan(e){return e.value>this.filter.value}checkLessThan(e){return e.value<this.filter.value}checkBetween(e){return this.filter.value2?this.filter.value&&this.filter.value2&&this.filter.value<=e.value&&e.value<this.filter.value2:this.filter.value&&this.filter.value1&&this.filter.value<=e.value&&e.value<this.filter.value1}checkIn(e){return Array.isArray(this.filter.value)&&0<=this.filter.value.indexOf(e.value)}}An.baseLogTag="NumberDataType";const On=[sn.EXISTS,sn.ON,sn.BETWEEN,sn.BEFORE,sn.AFTER,sn.INTHELAST,sn.INTHENEXT,sn.TODAY];class Dn extends _n{constructor(e,t){!Le(t.value)&&Pe(t.value)&&(t.value=new Date(t.value.split("Z").join(""))),!Le(t.value2)&&Pe(t.value2)&&null!=t.value2&&(t.value2=new Date(t.value2.split("Z").join(""))),!Le(t.value1)&&Pe(t.value1)&&null!=t.value1&&(t.value1=new Date(t.value1.split("Z").join(""))),super(on.DATE,On,e,t)}evaluate(){Dn.baseLogTag;let e=!1;var t=this.event.attributes.filter((e=>e.key===this.filter.name));const n=0<t.length?t[0]:null;if(null!=n)switch(n.value.setHours(0,0,0,0),this.filter.operator){case sn.EQ:e=this.checkEq();break;case sn.EXISTS:e=this.checkExists();break;case sn.ON:e=this.checkOn(n);break;case sn.BETWEEN:e=this.checkBetween(n);break;case sn.BEFORE:e=this.checkBefore(n);break;case sn.AFTER:e=this.checkAfter(n);break;case sn.INTHELAST:e=this.checkLastX(n);break;case sn.INTHENEXT:e=this.checkNextX(n);break;case sn.TODAY:e=this.checkToday(n)}return this.filter.negate?!e:e}checkOn(e){return e.value.setHours(0,0,0,0)===this.filter.value.setHours(0,0,0,0)}checkBetween(e){return this.filter.value2?this.filter.value.getTime()<=e.value.getTime()&&e.value.getTime()<this.filter.value2.getTime():this.filter.value.getTime()<=e.value.getTime()&&e.value.getTime()<this.filter.value1.getTime()}checkBefore(e){const{value:t}=this.filter;return typeof t===se?((new Date).setHours(0,0,0,0)-e.value.setHours(0,0,0,0))/864e5>t:e.value.setHours(0,0,0,0)<t.setHours(0,0,0,0)}checkAfter(e){const{value:t}=this.filter;return typeof t===se?(e.value.setHours(0,0,0,0)-(new Date).setHours(0,0,0,0))/864e5>t:e.value.setHours(0,0,0,0)>t.setHours(0,0,0,0)}checkLastX(e){var t=(new Date).setHours(0,0,0,0);return 0<t-(e=e.value.setHours(0,0,0,0))&&(t-e)/864e5<=this.filter.value}checkNextX(e){var t=(new Date).setHours(0,0,0,0);return 0<(e=e.value.setHours(0,0,0,0))-t&&(e-t)/864e5<=this.filter.value}checkToday(e){return e.value.setHours(0,0,0,0)===(new Date).setHours(0,0,0,0)}}Dn.baseLogTag="DateTimeDataType";class Cn{static doesEventMatchFilters(e,t){Cn.baseLogTag;let n=!1,i=null;switch(t.data_type){case on.BOOL:i=new In(e,t),i.validate()&&(n=i.evaluate());break;case on.STRING:i=new yn(e,t),i.validate()&&(n=i.evaluate());break;case on.NUMBER:case on.LONG:i=new An(e,t),i.validate()&&(n=i.evaluate());break;case on.DATE:i=new Dn(e,t),i.validate()&&(n=i.evaluate())}return n}static doesValueMatchFilter(e,t){return e=new lt(t.name,e),e=new Kt("sample event",[e]),Cn.doesEventMatchFilters(e,t)}}Cn.baseLogTag="TriggerEvaluator";class Nn{constructor(e){var t=Nn.baseLogTag+".constructor";this.campaignId=me(e,"campaign_id",null),this.campaignName=me(e,"campaign_name",null),this.templateType=me(e,"template_type",null),this.personalizationType=me(e,"personalization_type",null),this.campaignContext=me(e,"campaign_context",null);var n=me(e,"status",null);const i=[ln.ACTIVE,ln.EXPIRED,ln.PAUSED];i.indexOf(n)<0?this.status=ln.ACTIVE:this.status=i[i.indexOf(n)],this.tag=me(e,"tag",null),this.triggerData=null,Rn.validate(me(e,"trigger"))?this.triggerData=new Rn(me(e,"trigger")):ve.log(2,t,"Rejecting trigger data for :",e),this.expiryTime=Ne(me(e,"expiry_time")+"Z"),this.updatedTime=Ne(me(e,"updated_time")+"Z"),this.delivery=new Bn(me(e,"delivery")),this.userInSegment=me(e,"user_in_segment",!0),t=me(e,"display",this.display=null),e=me(e,"display_filter",null),this.templateType!==dn.SELF_HANDLED&&(null!=e?this.display=new Un({rules:{uri_filters:e}},this.templateType):null!=t&&(this.display=new Un(t,this.templateType)))}static isValidMetaJSON(e){Nn.baseLogTag;let t=!0;var n=["campaign_id","campaign_name","template_type","status","expiry_time","updated_time","delivery","user_in_segment"];for(let i=0;i<n.length;i++)if(null==e[n[i]]){t=!1;break}return t}static getFilters(e){return me(e,"triggerData.primary_condition.attributes.filters",[])}static getSecondaryFilters(e){return me(e,"triggerData.secondary_condition.attributes.filters",[])}static getFilterResult(e,t){const n=Nn.getFilters(t);var i=Nn.getSecondaryFilters(t);if(null==n&&null==i)return!0;let a=!0;if(n&&0<n.length){var r=me(t,"triggerData.primary_condition.attributes.filterOperator","and"),o=n.map((t=>Cn.doesEventMatchFilters(e,t)));a=o[0];for(let e=1;e<o.length;e++)if(r===cn.AND){if(a=a&&o[e],!1===a)break}else if(r===cn.OR&&(a=a||o[e],!0===a))break}return!1!==a&&(t=Nn.getURLFilterResult(t),a&&t)}static getURLFilterResult(e){const t=Nn.getSecondaryFilters(e);let n=!0;if(t&&0<t.length){const r=new Kt(e.triggerData.secondary_condition.action_name,[]);var i=e.triggerData.secondary_condition.attributes.filterOperator,a=t.map((e=>Cn.doesEventMatchFilters(r,e)));n=a[0];for(let e=0;e<a.length;e++)if(i===cn.AND){if(n=n&&a[e],!1===n)break}else if(i===cn.OR&&(n=n||a[e],!0===n))break}return n}}Nn.baseLogTag="OnsiteCampaignMeta";class Rn{constructor(e){this.cs_id=e.cs_id,this._id=e._id,this.references=e.references,Pn.validate(e.primary_condition)?this.primary_condition=new Pn(e.primary_condition):this.primary_condition=null,0<me(e,"secondary_condition.filters",[]).length&&(this.secondary_condition=new Ln(e.secondary_condition.filters[0])),this.description=e.description,null!=e.trigger_delay?this.trigger_delay=new kn(e.trigger_delay):this.trigger_delay=null}static validate(e){let t=!1;return["primary_condition"].forEach((n=>{null!=me(e,n,null)&&(t=!0)})),t}}class kn{constructor(e){if(this.delay=me(e,"delay",0),this.unit=me(e,"unit","seconds"),this.delay_type=me(e,"delay_type",""),this.attribute=me(e,"attribute",""),me(e,"delay",null)&&me(e,"unit",null)){let e=this.delay;"minutes"!==this.unit&&"hours"!==this.unit&&"days"!==this.unit||(e*=60),"hours"!==this.unit&&"days"!==this.unit||(e*=60),"days"===this.unit&&(e*=24),this.delayInSeconds=e}else this.delayInSeconds=0}}class Pn{constructor(e){this.action_name=null,this.attributes=null,this.action_name=me(e,"action_name",null),e=me(e,"attributes",null),Mn.validateJson(e)&&(this.attributes=new Mn(e))}static validate(e){let t=!1;return e&&null!=e.action_name&&(t=!0),t}}class Ln{constructor(e){this.action_name=null,this.attributes=null,this.action_name=me(e,"action_name",null),e=me(e,"attributes",null),Mn.validateJson(e)&&(this.attributes=new Mn(e))}static validate(e){let t=!1;return e&&null!=e.action_name&&(t=!0),t}}class Mn{constructor(e){this.filters=[],this.filterOperator=me(e,"filter_operator",cn.AND),this.filters=me(e,"filters",[])}static validateJson(e){if(null==e)return!1;var t=["filters"];for(let n=0;n<t.length;n++)if(null==e[t[n]])return!1;return!0}}(si=ln=ln||{}).ACTIVE="ACTIVE",si.PAUSED="PAUSED",si.EXPIRED="EXPIRED",(si=cn=cn||{}).AND="and",si.OR="or";class Bn{constructor(e){this.priority=me(e,"priority",0),this.dismiss_interval=me(e,"dismiss_interval",0),this.fc_meta=new xn(me(e,"fc_meta",null))}}class xn{constructor(e){this.count=0,this.delay=0,this.ignore_global_delay=!1,null!=e&&(this.count=me(e,"count",0),this.delay=me(e,"delay",0),this.ignore_global_delay=me(e,"ignore_global_delay",!1))}}class Wn{constructor(e){this.aggregations=[],this.filters=[],this.aggregations=me(e,"aggregations",[]),this.filter_operator=me(e,"filter_operator",cn.AND),this.filters=me(e,"filters",[])}}class Un{constructor(e,t){this.config={blocking:me(e,"config.blocking",Un.getDefaultValue("blocking",t)),pushPage:me(e,"config.push_page",Un.getDefaultValue("push_page",t)),sticky:me(e,"config.sticky",Un.getDefaultValue("sticky",t)),scrollable:me(e,"config.scrollable",Un.getDefaultValue("scrollable",t)),showOverOtherCampaigns:me(e,"config.show_over_campaigns",Un.getDefaultValue("show_over_campaigns",t))},this.rules={uriFilters:new Wn(me(e,"rules.uri_filters",{}))}}static getDefaultValue(e,t){return{blocking:{POP_UP:!0,BANNER:!1},push_page:{POP_UP:!1,BANNER:!0},sticky:{POP_UP:!1,BANNER:!0},scrollable:{POP_UP:!1,BANNER:!0},show_over_campaigns:{POP_UP:!1,BANNER:!1}}[e][t]}}(si=dn=dn||{}).SELF_HANDLED="SELF_HANDLED",si.POP_UP="POP_UP",si.BANNER="BANNER";class Hn{constructor(e){this.draftId=me(e,"draft_id",null),this.draftType=me(e,"draft_type",null),this.templateType=me(e,"template_type",null),this.action=me(e,"action",null);var t=me(e,"campaign_meta",{});this.locale=me(e,"locale",null),this.variation=me(e,"variation",null),this.displaySettings=new Un({config:t.config},this.templateType)}static isValidRawJson(e){var{draft_id:t,draft_tag:e}=e;return null!=t&&null!=e}}class Fn{getIframe(){return null==this.iFramePromise&&(this.iFramePromise=new Promise((e=>{const t=document.createElement("iframe");t.id="moengage-web-helper-frame",t.style.display="none",t.src=ne.WEB_HELPER_IFRAME_URL,document.body.appendChild(t),t.addEventListener("load",(()=>{this.helper=new dt(ne.IFRAME_CHANNEL,t),e(t)}))}))),this.iFramePromise}getDraftCampaignInfo(){return function(e,t,n,i){return new(n=n||Promise)((function(t,a){function r(e){try{s(i.next(e))}catch(e){a(e)}}function o(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var i;e.done?t(e.value):((i=e.value)instanceof n?i:new n((function(e){e(i)}))).then(r,o)}s((i=i.apply(e,[])).next())}))}(this,0,void 0,(function*(){var e="IframeHelper.getDraftCampaignInfo";try{ve.log(1,e,"Loading helper frame"),yield this.getIframe(),ve.log(1,e,"Helper frame loaded");var t=yield this.helper.sendMessage(ne.IFRAME_TOPICS.COOKIE_STORAGE,{TYPE:"GET",KEY:ne.COOKIE_STORAGE.TEST_DRAFT_ID});ve.log(1,e,"Data from iframe: ",t);var n=t.message;ve.log(1,e,"Raw test campaign",n);let i=null;return null!=n&&(Hn.isValidRawJson(n)?i=new Hn(n):ve.error(1,e,"Data is not a valid test campaign")),i}catch(e){return null}}))}}class Kn{constructor(e){this.templateType=me(e,"template_type",null),this.payloadType=me(e,"payload_type",null),this.payload=me(e,"payload",null),this.position=me(e,"position",null),this.campaignContext=me(e,"campaign_context",null),this.updatedTime=Ne(me(e,"updated_time")+"Z")}}var jn=function(e,t,n,i){return new(n=n||Promise)((function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))};class Gn{constructor(e,t){this.appId=e,this.store=pe.createInstance({driver:[pe.INDEXEDDB,pe.WEBSQL,pe.LOCALSTORAGE],name:ne.DATABASE_NAME,storeName:ne.STORES.SERVICE_META.NAME}),this.host=ne.HOST_1,null!=t&&null!=t.host&&(this.host=t.host)}getCampaignsMeta(e){return jn(this,void 0,void 0,(function*(){var t=Gn.baseLogTag+".getCampaignsMeta";try{var n=yield this.getRequestOptions();let t;const a=yield this.store.getItem(ne.STORES.SERVICE_META.KEYS.LAST_META_CALL_TIME);null!=a&&(t=a.toISOString());var i=yield Ke.post(this.host+ne.API.META,Object.assign(Object.assign({},n),{postData:{campaign_ids:e},last_fetch_time:t}));this.store.setItem(ne.STORES.SERVICE_META.KEYS.LAST_META_CALL_TIME,new Date),this.store.setItem(ne.STORES.SERVICE_META.KEYS.UNIQUE_ID,n.queryParams.unique_id);const r=JSON.parse(i.responseText),o=[];return r.campaigns.forEach((e=>{Nn.isValidMetaJSON(e)&&o.push(new Nn(e))})),{campaignsMeta:o,globalDelayBetweenInapps:me(r,"min_delay_btw_inapps",0)}}catch(e){throw ve.error(1,t,"Error getting meta for inapp: ",e),new Error("Could not get meta payload")}}))}getCampaignPayload(e,t){return jn(this,void 0,void 0,(function*(){var n=Gn.baseLogTag+".getCampaignPayload";let i;try{if(t){const n={};for(let e=0;e<t.attributes.length;e++)n[t.attributes[e].key]=t.attributes[e].value;var a={event:{name:t.name,attributes:n,time:(new Date).toISOString()},contexts:["string"],campaign_context:e.campaignContext};i=yield Ke.post(this.host+ne.API.CAMPAIGN_PAYLOAD+e.campaignId,yield this.getRequestOptions(a))}else i=yield Ke.post(this.host+ne.API.CAMPAIGN_PAYLOAD+e.campaignId,yield this.getRequestOptions());return i=JSON.parse(i.responseText),i.code===ne.GCG_ERROR_CODE&&(i={payload:i}),new Kn(i)}catch(i){throw ve.error(1,n,"Error geting payload",i),new Error("Could not get payload for "+e.campaignId)}}))}getCampaignsPayload(e,t){return jn(this,void 0,void 0,(function*(){var n=Gn.baseLogTag+".getCampaignsPayload";let i;try{if(t){const n={};for(let e=0;e<t.attributes.length;e++)n[t.attributes[e].key]=t.attributes[e].value;var a={event:{name:t.name,attributes:n,time:(new Date).toISOString()},contexts:["string"],campaign_ids:e};i=yield Ke.post(this.host+ne.API.CAMPAIGNS_PAYLOAD,this.getRequestOptions(a))}else i=yield Ke.post(this.host+ne.API.CAMPAIGNS_PAYLOAD,this.getRequestOptions());const n=[];return JSON.parse(i.responseText).forEach((e=>{n.push(new Kn(e))})),n}catch(i){throw ve.error(1,n,"Error geting payload",i),new Error("Could not get payload for "+e)}}))}getDraftCampaign(e){return jn(this,void 0,void 0,(function*(){var t=Gn.baseLogTag+".getDraftCampaign";try{const t=yield this.getRequestOptions();t.queryParams=Object.assign({},t.queryParams,{locale:e.locale,variation:e.variation});var n=yield Ke.get(this.host+ne.API.DRAFT_CAMPAIGN_PAYLOAD+e.draftId,t);const i=JSON.parse(n.responseText);return"JSON"===i.payload_type&&(i.payload=JSON.parse(i.payload)),new Kn(i)}catch(n){return ve.error(1,t,"Error geting test campaign payload",n),null}}))}getRequestOptions(e){const t=Re();return Wt.getWebSDKSettings().then((n=>{var i=be.get(r.USER_DATA);let a;const{deviceUuid:o,attributes:s}=i;if(s.map((e=>{e.key===_&&(a=e.value)})),!o)throw new Error("device_unique_id not found in localStorage.");return{headers:{"Content-Type":"application/json","MOE-APPKEY":this.appId},queryParams:{sdk_ver:t.getSdkVersion(),os:Ce()?"mweb":"web",unique_id:o,uid:"allowed"===n.o_u_e?a:void 0},postData:e||{}}}))}}Gn.baseLogTag="OnsiteApi";class Vn{constructor(){this.isExitIntentShown=!1,this.isPopStateEventBound=!1}onScroll(e){const t=Vn.baseLogTag+".onScroll";null==e&&(e=()=>{});var n=Vn.throttle((()=>{ve.log(1,t,"Scrolled percent:",Vn.getScrollPercent()),e(Vn.getScrollPercent())}),ne.SCROLL_CAMPAIGN_THROTTLING_TIME);return e(Vn.getScrollPercent()),window.addEventListener("scroll",n),n}onMobileTabChange(e){const t=Vn.baseLogTag+".onMobileTabChange";document.addEventListener("visibilitychange",(()=>{this.isExitIntentShown||"hidden"!==document.visibilityState||(ve.log(1,t,"TRIGGERED: MOBILE EXIT INTENT"),e(),this.isExitIntentShown=!0)}))}onMobileBackHit(e){const t=Vn.baseLogTag+".onMobileBackHit";setTimeout((()=>{this.isPopStateEventBound=!0,window.addEventListener("popstate",(n=>{!this.isExitIntentShown&&n.state&&"exit_intent"===n.state.moeIntent&&(ve.log(1,t,"TRIGGERED: MOBILE EXIT INTENT"),e("onBackClick"),this.isExitIntentShown=!0)}))}),1e3),this.setHistoryState()}setHistoryState(){window.history.state&&"no_intent"===window.history.state.moeIntent||(window.history.replaceState(Object.assign(Object.assign({},window.history.state),{moeIntent:"exit_intent"}),""),window.history.pushState(Object.assign(Object.assign({},window.history.state),{moeIntent:"no_intent"}),""))}onMobileScrollAndExit(e){const t=Vn.baseLogTag+".onMobileScrollAndExit",n=document.documentElement.offsetHeight;let i,a=Vn.getScrollY(),r=null;0<n&&(r=window.setInterval((()=>{let o=a-Vn.getScrollY();o<0&&(o=0,a=Vn.getScrollY()),i=Vn.getScrollPercent()>ne.EXIT_INTENT.CONFIG.SCROLL_DOWN_THRESHOLD,i&&o/n>ne.EXIT_INTENT.CONFIG.SCROLL_UP_THRESHOLD/100&&(clearInterval(r),r=null,this.isExitIntentShown||(ve.log(1,t,"TRIGGERED: MOBILE EXIT INTENT"),e(),this.isExitIntentShown=!0))}),ne.EXIT_INTENT.CONFIG.SCROLL_INTERVAL))}mobileExitIntent(e){this.onMobileScrollAndExit(e),this.onMobileBackHit(e),this.onMobileTabChange(e)}onExit(e){const t=Vn.baseLogTag+".onExit";Ce()?this.mobileExitIntent(e):document.addEventListener("mouseout",(n=>function(e,t,n,i){return new(n=n||Promise)((function(t,a){function r(e){try{s(i.next(e))}catch(e){a(e)}}function o(e){try{s(i.throw(e))}catch(e){a(e)}}function s(e){var i;e.done?t(e.value):((i=e.value)instanceof n?i:new n((function(e){e(i)}))).then(r,o)}s((i=i.apply(e,[])).next())}))}(this,0,void 0,(function*(){var i=window.innerWidth,a=window.innerHeight;(n.clientY<0||n.clientX<0||n.clientY>=a||n.clientX>=i)&&(ve.log(1,t,"TRIGGERED: EXIT INTENT"),e())}))),!1)}static getScrollPercent(){const e=window,t=document,n=t.documentElement,i=t.getElementsByTagName("body")[0],a=e.innerHeight||n.clientHeight||i.clientHeight;var r=document.body,o=document.documentElement;return a<(o=Math.max(r.scrollHeight,r.offsetHeight,o.clientHeight,o.scrollHeight,o.offsetHeight))?100*Vn.getScrollY()/(o-a):100}static getScrollY(){let e=0;return"number"==typeof window.pageYOffset?e=window.pageYOffset:document.body&&document.body.scrollTop&&(e=document.body.scrollTop),e}static throttle(e,t){let n;return(...i)=>{n=n||window.setTimeout((()=>{n=null,e.apply(null,i)}),t)}}}Vn.baseLogTag="WindowEventManager";var Yn=function(e,t,n,i){return new(n=n||Promise)((function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))};class qn{constructor(e){this.eventNameCampaignHash={},this.messagingCampaigns=[],this.scrollCampaigns=[],this.scrollCampaignTriggered=!1,this.exitIntentCampaigns=[],this.exitCampaignTriggered=!1,this.listener=null,this.historyManager=window[te],this.onEvent=e=>Yn(this,void 0,void 0,(function*(){var t=qn.baseLogTag+".onEvent";try{if(null!=this.eventNameCampaignHash[e.name]){var n=(yield vn(this.eventNameCampaignHash[e.name])).filter((t=>Nn.getFilterResult(e,t)));ve.log(1,t,`Campaigns triggered for event ${e.name}: `+n.length),this.trigger(e,n)}}catch(n){ve.error(1,t,"Error occurred during check event trigger campaigns: ",n)}})),this.onScroll=e=>Yn(this,void 0,void 0,(function*(){const t=qn.baseLogTag+".onScroll";try{this.scrollCampaigns&&0<this.scrollCampaigns.length&&!this.scrollCampaignTriggered&&(yield vn(this.eventNameCampaignHash.MOE_PAGE_SCROLL)).map((n=>Yn(this,void 0,void 0,(function*(){var i=n.triggerData.primary_condition.attributes.filters[0];i=new lt(i.name,i.value),i=yield Kt.createEvent("MOE_PAGE_SCROLL",[i]),Nn.getFilterResult(i,n)&&e>n.triggerData.primary_condition.attributes.filters[0].value&&!this.scrollCampaignTriggered&&(this.scrollCampaignTriggered=!0,window.removeEventListener("scroll",this.scrollListenerCallback),ve.log(1,t,"Triggered Scroll campaign"),this.trigger(i,[n]))}))))}catch(e){ve.error(1,t,"Error occurred in triggering scroll campaigns ",e)}})),this.onExit=e=>Yn(this,void 0,void 0,(function*(){var t=qn.baseLogTag+".onExit";try{if(0<this.exitIntentCampaigns.length&&!this.exitCampaignTriggered){const i=yield Kt.createEvent("MOE_EXIT",[]);var n=(yield vn(this.eventNameCampaignHash.MOE_PAGE_EXIT)).filter((e=>Nn.getFilterResult(i,e)));n.length?(ve.log(1,t,"Triggered Exit Intent campaign: ",n),this.trigger(i,n)):("onBackClick"===e&&window.history.back(),ve.log(1,t,"No Exit Intent campaign is eligible."))}}catch(n){ve.error(1,t,"Error occurred in triggering exit intent campaigns ",n)}})),this.messagingCampaigns=e,this.windowEventManager=new Vn}onTrigger(e){this.listener=e}startWatching(){return Yn(this,void 0,void 0,(function*(){qn.baseLogTag,this.messagingCampaigns=yield vn(this.messagingCampaigns),this.eventNameCampaignHash={},this.messagingCampaigns.forEach((e=>{var t=me(e,"triggerData.primary_condition.action_name",null);null!=t&&(null==this.eventNameCampaignHash[t]&&(this.eventNameCampaignHash[t]=[]),this.eventNameCampaignHash[t].push(e))})),this.historyManager&&(this.historyManager.getHistory().forEach(this.onEvent),this.historyManager.addEventListener(this.onEvent)),this.scrollCampaignTriggered=!1,this.scrollCampaigns=this.messagingCampaigns.filter((e=>"MOE_PAGE_SCROLL"===me(e,"triggerData.primary_condition.action_name",null))),0<this.scrollCampaigns.length&&(this.scrollListenerCallback=this.windowEventManager.onScroll(this.onScroll)),this.exitCampaignTriggered=!1,this.exitIntentCampaigns=this.messagingCampaigns.filter((e=>"MOE_PAGE_EXIT"===me(e,"triggerData.primary_condition.action_name",null))),0<this.exitIntentCampaigns.length&&this.windowEventManager.onExit(this.onExit)}))}setScrollListenerCallback(e){this.scrollListenerCallback=e}getScrollListenerCallback(){return this.scrollListenerCallback}getWindowEventManager(){return this.windowEventManager}trigger(e,t){null!=this.listener&&this.listener(e,t)}destory(){this.listener=null}}qn.baseLogTag="OnsiteTriggerManager";class zn{constructor(e,t){this.waitForDelay=null,this.iframe=null,this.onFrameLoad=new ke,this.active=!1,this.dismissInterval=null,this.isActive=()=>this.active,this.campaignMeta=e,this.data=t,this.active=!1;const n=me(e,"triggerData.trigger_delay.delayInSeconds",0)||0;this.waitForDelay=new Promise((e=>{this.delayTimer=setTimeout((()=>{e()}),1e3*n)}))}setIsActive(e){this.active=e}}const Xn={CENTER:{position:"absolute",top:"50%",left:"50%",bottom:"auto",right:"auto",transform:"translate(-50%, -50%)"},CENTER_LEFT:{position:"absolute",top:"50%",left:"10px",bottom:"auto",right:"auto",transform:"translate(0,-50%)"},CENTER_RIGHT:{position:"absolute",top:"50%",right:"10px",bottom:"auto",left:"auto",transform:"translate(0,-50%)"},TOP_LEFT:{position:"absolute",top:"10px",left:"10px",bottom:"auto",right:"auto"},TOP_CENTER:{position:"absolute",top:"0",left:"50%",bottom:"auto",right:"auto",transform:"translate(-50%, 0)"},TOP_RIGHT:{position:"absolute",top:"10px",right:"10px",bottom:"auto",left:"auto"},BOTTOM_LEFT:{position:"absolute",bottom:"10px",left:"10px",top:"auto",right:"auto"},BOTTOM_CENTER:{position:"absolute",left:"50%",bottom:"10px",top:"auto",right:"auto",transform:"translate(-50%, 0)"},BOTTOM_RIGHT:{position:"absolute",bottom:"10px",right:"10px",top:"auto",left:"auto"},TOP:{position:"absolute",top:"0",left:"50%",bottom:"auto",right:"auto",transform:"translate(-50%, 0)"},BOTTOM:{position:"absolute",bottom:"0",top:"auto",right:"auto",left:"50%",transform:"translate(-50%, 0)"},LEFT:{position:"absolute",left:"0",bottom:"auto",right:"auto",top:"auto"},RIGHT:{position:"absolute",right:"0",bottom:"auto",left:"auto",top:"auto"}};var Qn=function(e,t,n,i){return new(n=n||Promise)((function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))};class Jn{constructor(){this.renderListener=null,this.initializationPromiseObject=null,this.campaignRenderOrder=[],this.campaignRenderMap={},this.dismissTestInapp=e=>{this.initialInlineBodyStyle?document.body.setAttribute("style",this.initialInlineBodyStyle):document.body.removeAttribute("style"),this.moeInappPusher.style.height="0",setTimeout((()=>document.getElementById("moe-onsite-campaign-"+e).remove()),0)},this.dismissInapp=e=>{if(0!==this.getActiveCampaigns().length){const t=this.getActiveCampaigns();setTimeout((()=>{t.forEach((t=>{t.campaignMeta.campaignId===e&&t.iframe.remove()}))}),0),this.campaignRenderMap[e].setIsActive(!1),clearInterval(this.campaignRenderMap[e].dismissInterval),this.renderAllActiveCampaigns()}else this.dismissTestInapp(e)},this.startInitialization(),this.initialInlineBodyStyle=document.body.getAttribute("style"),window.addEventListener("resize",(()=>{this.renderAllActiveCampaigns()}))}startInitialization(){return Qn(this,void 0,void 0,(function*(){var e=Jn.baseLogTag+".startInitialization";try{if(null==this.initializationPromiseObject&&(this.initializationPromiseObject=new ke),this.moeInappPusher=document.createElement("div"),this.moeInappPusher.style.setProperty("display","block","important"),this.moeInappPusher.style.height="0px","FRAMESET"===document.body.nodeName){const e=document.head;e.parentNode.insertBefore(this.moeInappPusher,e)}else{const e=document.body.firstChild;e.parentNode.insertBefore(this.moeInappPusher,e)}this.initializationPromiseObject.res()}catch(t){ve.error(1,e,"Error initializing display managaer:",t)}}))}static getIframeId(e){return"moe-onsite-campaign-"+e}queueDraftCampaign(e,t){return Qn(this,void 0,void 0,(function*(){const n=Jn.baseLogTag+".queueDraftCampaign";try{yield this.initializationPromiseObject.p,e.position=t.position,this.testCampaign=e;const i=Jn.createDefaultIframe(this.testCampaign.draftId,t.payload);if(ve.warn(1,n,"Going to render test campaign "+e.draftId),"FRAMESET"===document.body.nodeName){const e=this.moeInappPusher;e.parentNode.insertBefore(i,e)}else{const e=document.body.firstChild;e.parentNode.insertBefore(i,e)}i.onload=()=>{i.contentWindow.postMessage({campaignId:e.draftId},"*");var a=(o=e=>Array.prototype.slice.call(e))(i.contentDocument.getElementsByClassName(ne.CSS_SELECTORS.DISMISS_INAPP)),r=o(i.contentDocument.getElementsByClassName(ne.CSS_SELECTORS.CLICK_INAPP)),o=o(i.contentDocument.getElementsByTagName("a"));if(0===a.length&&ve.warn(1,n,"No dismiss class items present in this template"),0===r.length&&ve.warn(1,n,"No click class items present in this template"),-1<t.payload.indexOf("TEXT_INPUT")||-1<t.payload.indexOf('dynamic-listeners="true"'))i.contentDocument.body.addEventListener("click",(t=>{t.target&&t.target.classList.contains(ne.CSS_SELECTORS.CLICK_INAPP)&&ve.log(1,n,"Clicked on test campaign element. No data will be sent to BE right now. We'll start sending the click events once the campaign is live"),t.target&&t.target.classList.contains(ne.CSS_SELECTORS.DISMISS_INAPP)&&this.dismissTestInapp(e.draftId)}));else{for(const e of r)e.addEventListener("click",(e=>{ve.log(1,n,"Clicked on test campaign element. No data will be sent to BE right now. We'll start sending the click events once the campaign is live")}));for(const t of a)t.addEventListener("click",(()=>{this.dismissTestInapp(e.draftId)}))}for(const e of o)"_blank"!==e.getAttribute("target")&&e.setAttribute("target","_parent");this.renderTestCampaign(e,i)}}catch(e){ve.error(1,n,"Error queueing draft campaign",e)}}))}renderTestCampaign(e,t){return Qn(this,void 0,void 0,(function*(){if(t.style.visibility="hidden",t.style.display="block",t.style.zIndex="2147483647",e.displaySettings.config.blocking?(t.style.height=window.innerHeight+"px",t.style.width="100%"):(t.style.height=getComputedStyle(t.contentDocument.body).height,t.style.width=getComputedStyle(t.contentDocument.body).width,e.templateType===dn.POP_UP&&(t.style.margin="0px auto"),-1<t.srcdoc.indexOf(ne.POSITIONED_TEMPLATE)&&(n=-1<t.srcdoc.indexOf(ne.SIDE_BANNER),this.adjustPositionOfCampaign(t.style,e.position,n))),t.style.visibility="visible",e.templateType===dn.BANNER?e.displaySettings.config.sticky?t.style.position="fixed":t.style.position="absolute":e.templateType===dn.POP_UP&&(t.style.position="fixed",t.style.backgroundColor="rgba(99, 99, 99, 0.21)"),e.displaySettings.config.scrollable||(document.body.style.overflow="hidden"),e.templateType===dn.BANNER){const i=parseInt(getComputedStyle(t.contentDocument.body).height);var n=-1<t.srcdoc.indexOf(ne.POSITIONED_TEMPLATE);e.displaySettings.config.pushPage&&(n&&"TOP"===e.position||!n)&&(this.moeInappPusher.style.height=i.toString()+"px")}}))}queueLiveCampaign(e,t){return Qn(this,void 0,void 0,(function*(){var n=Jn.baseLogTag+".queueLiveCampaign";e.campaignContext=t.campaignContext;try{if(yield this.initializationPromiseObject.p,null==this.campaignRenderMap[e.campaignId]){this.campaignRenderOrder.push(e.campaignId),this.campaignRenderMap[e.campaignId]=new zn(e,t);var i=Jn.createDefaultIframe(e.campaignId,this.campaignRenderMap[e.campaignId].data.payload);if(this.campaignRenderMap[e.campaignId].iframe=i,yield this.campaignRenderMap[e.campaignId].waitForDelay,yield this.canCampaignBeRendered(e)){if(ve.warn(1,n,"Going to render "+e.campaignId),this.campaignRenderMap[e.campaignId].setIsActive(!0),t.payload.code===ne.GCG_ERROR_CODE)return ve.warn(1,n,`Can not render ${e.campaignId} as it falls under Control Group.`),void hn(e,"OSM",!0)();hn(e,"OSM")(),null!=this.renderListener&&this.renderListener(e),this.renderAllActiveCampaigns()}else ve.warn(1,n,"Can not render "+e.campaignId)}else ve.warn(1,n,`Can not render ${e.campaignId}, as it already being displayed or has been displayed once on this page already.`)}catch(i){ve.error(1,n,"Error queuing campaign "+e.campaignId,i)}}))}renderAllActiveCampaigns(){return Qn(this,void 0,void 0,(function*(){const e=Jn.baseLogTag+".renderAllActiveCampaigns",t=this.getActiveCampaigns();if(this.restoreBodyStyle(),0<t.length){for(let i=0;i<t.length;i++){var n;if(null==document.getElementById(Jn.getIframeId(t[i].campaignMeta.campaignId))){if("FRAMESET"===document.body.nodeName){const e=this.moeInappPusher;e.parentNode.insertBefore(t[i].iframe,e)}else{const e=document.body.firstChild;e.parentNode.insertBefore(t[i].iframe,e)}t[i].iframe.onload=()=>{$n.setScrollState(t),t[i].iframe.contentWindow.postMessage({campaignId:t[i].campaignMeta.campaignId},"*");const n=t[i].iframe;var a=e=>Array.prototype.slice.call(e),r=a(n.contentDocument.getElementsByClassName(ne.CSS_SELECTORS.DISMISS_INAPP)),o=a(n.contentDocument.getElementsByClassName(ne.CSS_SELECTORS.CLICK_INAPP));if(a=a(n.contentDocument.getElementsByTagName("a")),0===r.length&&ve.warn(1,e,"No dismiss class items present in this template"),0===o.length&&ve.warn(1,e,"No click class items present in this template"),t[i].data.payload&&(-1<t[i].data.payload.indexOf("TEXT_INPUT")||-1<t[i].data.payload.indexOf('dynamic-listeners="true"')))n.contentDocument.body.addEventListener("click",(e=>{var n;e.target&&e.target.classList.contains(ne.CSS_SELECTORS.CLICK_INAPP)&&(n=e.target.dataset.id,gn(t[i].campaignMeta,"OSM",{widget_id:n})()),e.target&&e.target.classList.contains(ne.CSS_SELECTORS.DISMISS_INAPP)&&(this.dismissInapp(t[i].campaignMeta.campaignId),e.target.classList.contains(ne.CSS_SELECTORS.CLICK_INAPP)||pn(t[i].campaignMeta,"OSM"))}));else{for(const e of o)e.addEventListener("click",(e=>{e=e.target.dataset.id,gn(t[i].campaignMeta,"OSM",{widget_id:e})()}));for(const e of r)e.addEventListener("click",(()=>{this.dismissInapp(t[i].campaignMeta.campaignId),e.classList.contains(ne.CSS_SELECTORS.CLICK_INAPP)||pn(t[i].campaignMeta,"OSM")}))}for(const e of a)"_blank"!==e.getAttribute("target")&&e.setAttribute("target","_parent");t[i].onFrameLoad.res()}}yield t[i].onFrameLoad.p,t[i].iframe.style.visibility="hidden",t[i].iframe.style.display="block",ve.log(1,e,"zindex for "+t[i].campaignMeta.campaignId,2147483647..toString()),t[i].iframe.style.zIndex=(2147483647-(t.length-i-1)).toString(),t[i].iframe.style.margin="0",t[i].campaignMeta.display.config.blocking?(t[i].iframe.style.height=window.innerHeight+"px",t[i].iframe.style.width="100%"):(t[i].iframe.style.height=getComputedStyle(t[i].iframe.contentDocument.body).height,t[i].iframe.style.padding.includes("10px")?t[i].iframe.style.width=parseInt(getComputedStyle(t[i].iframe.contentDocument.body).width)+20+"px":t[i].iframe.style.width=getComputedStyle(t[i].iframe.contentDocument.body).width,t[i].campaignMeta.templateType===dn.POP_UP&&(t[i].iframe.style.margin="0px auto"),t[i].data.payload&&-1<t[i].data.payload.indexOf(ne.POSITIONED_TEMPLATE)&&(n=-1<t[i].data.payload.indexOf(ne.SIDE_BANNER),this.adjustPositionOfCampaign(t[i].iframe.style,t[i].data.position,n))),t[i].iframe.style.visibility="visible",t[i].campaignMeta.templateType===dn.BANNER?t[i].campaignMeta.display.config.sticky?t[i].iframe.style.position="fixed":t[i].iframe.style.position="absolute":t[i].campaignMeta.templateType===dn.POP_UP&&(t[i].iframe.style.position="fixed",t[i].iframe.style.backgroundColor="rgba(99, 99, 99, 0.21)"),null!=t[i].dismissInterval||0<(n=1e3*me(t[i].campaignMeta,"delivery.dismiss_interval",0))&&(t[i].dismissInterval=setTimeout((()=>{const e=this.campaignRenderMap[t[i].campaignMeta.campaignId];e&&e.isActive()&&(this.dismissInapp(t[i].campaignMeta.campaignId),pn(t[i].campaignMeta,"OSM",!0))}),n))}var i,a;let r=0,o=0;for(let e=t.filter((e=>e.campaignMeta.templateType===dn.BANNER)).length-1;0<=e;e--)t[e].iframe.contentDocument&&(i=parseInt(getComputedStyle(t[e].iframe.contentDocument.body).height),r+=i,a=t[e].data.payload&&-1<t[e].data.payload.indexOf(ne.POSITIONED_TEMPLATE),t[e].campaignMeta.display.config.pushPage&&(a&&"TOP"===t[e].data.position||!a)&&(o+=i));this.moeInappPusher.style.height=o.toString()+"px"}}))}restoreBodyStyle(){this.moeInappPusher.style.height="0px";let e=0;Object.keys(this.campaignRenderMap).forEach((t=>{this.campaignRenderMap[t].campaignMeta.templateType===dn.POP_UP&&this.campaignRenderMap[t].isActive()&&e++})),1<=e||(this.initialInlineBodyStyle?document.body.setAttribute("style",this.initialInlineBodyStyle):document.body.removeAttribute("style"))}canCampaignBeRendered(e){return Qn(this,void 0,void 0,(function*(){var t=Jn.baseLogTag+".queueLiveCampaign";try{var n=yield rn.campaingsStatsStore.getItem(e.campaignId),i=yield rn.serviceMetaStore.getItem(ne.STORES.SERVICE_META.KEYS.GLOBAL_DELAY),a=yield rn.serviceMetaStore.getItem(ne.STORES.SERVICE_META.KEYS.LAST_INAPP_SHOWN_TIME);return Sn.isValid(e,n)&&Sn.isValidMessagingCampaign(e,n,i,a,this.getActiveCampaigns())&&Nn.getURLFilterResult(e)}catch(n){ve.error(1,t,`Error checking if campaign ${e.campaignId} can be rendered:`,n)}return!1}))}static createDefaultIframe(e,t){Jn.baseLogTag,e=Jn.getIframeId(e);const n=document.createElement("iframe");return n.setAttribute("id",e),n.style.left="0px",n.style.top="0px",n.style.bottom="0px",n.style.right="0px",n.style.border="0px none",n.style.height="100%",n.style.width=window.innerWidth.toString()+"px",n.style.padding="0",n.style.overflow="hidden",n.style.overflowY="hidden",n.style.zIndex="999999",n.style.display="none",n.style.position="fixed",n.setAttribute("srcdoc",t),n}onRender(e){this.renderListener=e}getActiveCampaigns(){return this.campaignRenderOrder.map((e=>this.campaignRenderMap[e])).filter((e=>e.isActive()))}destroy(){this.getActiveCampaigns().forEach((e=>{e.setIsActive(!1)})),this.renderAllActiveCampaigns(),this.campaignRenderOrder=[],this.campaignRenderMap={}}adjustPositionOfCampaign(e,t,n){t&&(Object.assign(e,Xn[t]),Ce()&&n&&this.addMarginInMweb(e,t))}addMarginInMweb(e,t){const n={paddingLeft:"10px",paddingRight:"10px",marginTop:"0",marginBottom:"0"};"TOP"===t&&(n.marginTop="10px"),"BOTTOM"===t&&(n.marginBottom="10px"),Object.assign(e,n)}}Jn.baseLogTag="MessagingDisplayManager";class $n{static setScrollState(e){let t=!0;for(let n=0;n<e.length;n++)t=t&&e[n].campaignMeta.display.config.scrollable;t||(document.body.style.overflow="hidden")}}var Zn=function(e,t,n,i){return new(n=n||Promise)((function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))};class ei{constructor(e){this.initializationPomise=null,this.testDraftInfo=null,this.triggerManager=null,this.displayManager=null,this.globalDelay=0,this.onsiteSelfHandledTriggerListeners={},this.appId=e.appId,ve.setLogLevel(e.debugLevel),this.config={host:ne.HOST_1},"DC_2"===e.cluster||"eu"===e.cluster?this.config.host=ne.HOST_2:"DC_3"===e.cluster||"in"===e.cluster?this.config.host=ne.HOST_3:"DC_4"===e.cluster&&(this.config.host=ne.HOST_4),e.inapp&&e.inapp.host&&(this.config.host=e.inapp.host),this.OnsiteApiClient=new Gn(this.appId,this.config),this.iframeHelper=new Fn}setLogLevel(e){ve.setLogLevel(e,!1)}initialize(){const e=ei.baseLogTag+".initialize";return null==this.initializationPomise&&(this.initializationPomise=new Promise((t=>Zn(this,void 0,void 0,(function*(){try{yield rn.initialize(),yield this.checkForTestCampaign(),yield this.syncCampaigns();const r=yield this.getCampaignsFromDB();var n=this.isExitIntentCampaignFound(r);n.length&&(yield this.prefetchExitIntentCampaigns(n));var i=r.filter((e=>null!=e.triggerData));if(this.displayManager=new Jn,this.displayManager.onRender((t=>{ve.log(1,e,"Campaign rendered: "+t.campaignId),rn.serviceMetaStore.setItem(ne.STORES.SERVICE_META.KEYS.LAST_INAPP_SHOWN_TIME,new Date)})),null!=this.testDraftInfo&&this.testDraftInfo.draftType===ne.DRAFT_CAMPAIGN_TPYES.ONSITE_MESSAGING){ve.log(1,e,"Test campaigns present, will be showing only the test campaign."),ve.log(1,e,"No live campaign will be shown till draft campaign expires from cookies (15 mins)");try{ve.log(1,e,"Trying to render draft campaign with id "+this.testDraftInfo.draftId);var a=yield this.OnsiteApiClient.getDraftCampaign(this.testDraftInfo);ve.log(1,e,"Test campaign payload: ",a),this.displayManager.queueDraftCampaign(this.testDraftInfo,a)}catch(n){ve.error(1,e,`Error fetching data for test campaign ${this.testDraftInfo.draftId}: `,n)}}else this.triggerManager=new qn(i),this.triggerManager.onTrigger(((t,n)=>Zn(this,void 0,void 0,(function*(){n=yield vn(n),ve.log(1,e,"Triggered for: ",t.name,n);const i=[];let a=[];var r,o;n.forEach((e=>{(e.templateType===dn.SELF_HANDLED?i:a).push(e)})),r=a,o=this.displayManager.getActiveCampaigns(),a=yield un(void 0,void 0,void 0,(function*(){var e=r.map((e=>rn.campaingsStatsStore.getItem(e.campaignId)));const t=yield rn.serviceMetaStore.getItem(ne.STORES.SERVICE_META.KEYS.GLOBAL_DELAY),n=yield rn.serviceMetaStore.getItem(ne.STORES.SERVICE_META.KEYS.LAST_INAPP_SHOWN_TIME);let i;try{return i=yield Promise.all(e),r.filter(((e,a)=>Sn.isValidMessagingCampaign(e,i[a],t,n,o)))}catch(e){return ve.error(1,"validateMessagingCampaigns","Error vaildating messaging campaigns: ",e),[]}})),i.length&&this.handlePersonalizationCampagins(i,t),a.length&&this.handleMessagingCampaigns(a,t)})))),this.triggerManager.startWatching();t(!0)}catch(n){ve.error(1,e,n)}}))))),this.initializationPomise}handleMessagingCampaigns(e,t){return Zn(this,void 0,void 0,(function*(){var n=ei.baseLogTag+".handleMessagingCampaigns";try{let a;var i=e[0];this.isExitIntentCampaign(i)&&(a=yield this.isCampaignPrefetched(i)),a=a||(yield this.OnsiteApiClient.getCampaignPayload(i,t)),ve.log(1,n,"Campaign triggered: "+i.campaignId),ve.log(1,n,"Payload for campaign:",a),this.displayManager.queueLiveCampaign(i,a)}catch(e){ve.error(1,n,"Error getting campaign data for messaging campaign",e)}}))}handlePersonalizationCampagins(e,t){return Zn(this,void 0,void 0,(function*(){const n=ei.baseLogTag+".handlePersonalizationCampagins";try{ve.log(1,n,"Going to Trigger: ",e);const i={},a=[];e.forEach((e=>{null!=e.tag&&null!=this.onsiteSelfHandledTriggerListeners[e.tag]&&(a.indexOf(e.tag)<0&&a.push(e.tag),null==i[e.tag]&&(i[e.tag]=[]),i[e.tag].push(e))})),a.forEach((e=>Zn(this,void 0,void 0,(function*(){try{if(null!=i[e])for(let n=0;n<i[e].length;n++){const a=yield this.OnsiteApiClient.getCampaignPayload(i[e][n],t);this.onsiteSelfHandledTriggerListeners[e].forEach((t=>{this.handleSelfHandledCallback(i[e][n],a,t)}));break}}catch(e){ve.error(1,n,"Error in triggered web personalization campaign: ",e)}}))))}catch(e){ve.error(1,n,"Error handling trigger for self handled web personalization campaign: ",e)}}))}logout(){return Zn(this,void 0,void 0,(function*(){var e=ei.baseLogTag+".logout";ve.log(1,e,"Starting module logout"),this.initializationPomise=null,this.displayManager&&(Object.keys(this.displayManager.campaignRenderMap).forEach((e=>{const t=document.getElementById("moe-onsite-campaign-"+e);t&&t.remove()})),this.displayManager.destroy()),this.triggerManager&&this.triggerManager.destory(),this.displayManager=null,yield rn.clear(),ve.log(1,e,"Starting module logout complete")}))}getCampaignsFromDB(){return new Promise((e=>{setTimeout((()=>Zn(this,void 0,void 0,(function*(){const t=[];for(const e of yield rn.campaingsMetaStore.keys())t.push(yield this.getCampaignById(e));e(t)}))),0)}))}checkForTestCampaign(){return Zn(this,void 0,void 0,(function*(){var e=ei.baseLogTag+".checkForTestCampaign";try{var t=yield this.iframeHelper.getDraftCampaignInfo();null==t?(ve.log(1,e,"No draft campaign found"),this.testDraftInfo=null):(ve.log(1,e,"Found draft campaign: ",t),this.testDraftInfo=t,null==this.testDraftInfo.draftId&&(this.testDraftInfo.draftType=ne.DRAFT_CAMPAIGN_TPYES.WEB_PERSONALIZATON))}catch(t){ve.error(1,e,"Error getting test campaign",t)}}))}getCampaignById(e){return Zn(this,void 0,void 0,(function*(){var t=ei.baseLogTag+".getCampaignById";try{return yield rn.campaingsMetaStore.getItem(e)}catch(e){return ve.error(1,t,"Error getting campaign from stroe: ",e),null}}))}getData(e,t){return Zn(this,void 0,void 0,(function*(){const n=ei.baseLogTag+".getData";null==t&&(ve.warn(1,n,"Moengage.onsite.getData called without a providing a callback."),t=()=>{});try{if(yield this.initializationPomise,null!=this.testDraftInfo){var i;ve.log(1,n,"Fetching test campaign: ",this.testDraftInfo),this.testDraftInfo.draftType===ne.DRAFT_CAMPAIGN_TPYES.WEB_PERSONALIZATON&&(i=yield this.OnsiteApiClient.getDraftCampaign(this.testDraftInfo),t(null,{payload:i.payload,click:()=>{ve.log(1,n,"This is a test campaign")},imp:()=>{ve.log(1,n,"This is a test campaign")}}))}else{const i=yield rn.campaingsTagsStore.getItem(e);if(i){const l=yield Promise.all(i.map((e=>this.getCampaignById(e))));var a=l.filter((e=>null==e.triggerData)),r=yield vn(a);ve.log(1,n,"Eligible campaigns with tag ",e,"are",r);for(let i=0;i<r.length;i++){var o,s=r[0];ve.log(1,n,"Campaign with highest priority for tag",e,"is",s.campaignId),o=yield this.OnsiteApiClient.getCampaignPayload(s),this.handleSelfHandledCallback(s,o,t);break}}else ve.warn(1,n,"Could not find any eligible campaign for tag",e),t({message:"Could not find any eligible campaign for tag "+e},null)}}catch(i){ve.error(1,n,"Error getting campaign",i),t({message:"There was an error fetching data for this tag"},null)}}))}registerCallback(e,t){return Zn(this,void 0,void 0,(function*(){var n=ei.baseLogTag+".registerCallback";try{yield this.initializationPomise,null==this.onsiteSelfHandledTriggerListeners[e]?this.onsiteSelfHandledTriggerListeners[e]=[t]:this.onsiteSelfHandledTriggerListeners[e].push(t)}catch(t){ve.error(1,n,"Error setting callback for tag",e),ve.error(1,n,"Error stack:",t)}}))}handleSelfHandledCallback(e,t,n){return Zn(this,void 0,void 0,(function*(){var i=ei.baseLogTag+".handleSelfHandledCallback";if(e.campaignContext=t.campaignContext,"JSON"===t.payloadType)try{t.payload=JSON.parse(t.payload);var a=me(e,"triggerData.trigger_delay.delayInSeconds",0)||0;setTimeout((()=>{mn(e,"WP"),n(null,{payload:t.payload,click:t=>{gn(e,"WP",t)()},imp:hn(e,"WP")})}),1e3*a)}catch(r){a=`Payload for campaign_id ${e.campaignId} is not a valid JSON`,ve.error(1,i,a),ve.error(1,i,"Payload provided:",t.payload),n({message:a},null)}else mn(e,"WP"),n(null,{payload:t.payload,click:t=>{gn(e,"WP",t)()},imp:hn(e,"WP")})}))}syncCampaigns(){return Zn(this,void 0,void 0,(function*(){var e=ei.baseLogTag+".syncCampaigns";try{(yield this.shouldClearMetaStorage())&&(yield rn.campaingsMetaStore.clear(),yield this.rebuildTagStore()),(yield this.shouldSaveRemoteCampaigns())&&(yield this.saveRemoteCampaigns())}catch(t){ve.error(1,e,"Error getting remote campaigns: ",t)}}))}shouldClearMetaStorage(){return Zn(this,void 0,void 0,(function*(){return(yield rn.serviceMetaStore.getItem(ne.STORES.SERVICE_META.KEYS.LAST_FETCH_SDK_VERSION))!==Re().getSdkVersion()}))}shouldSaveRemoteCampaigns(){return Zn(this,void 0,void 0,(function*(){var e=ei.baseLogTag+".shouldSaveRemoteCampaigns",t=yield rn.serviceMetaStore.getItem(ne.STORES.SERVICE_META.KEYS.LAST_FETCH_SDK_VERSION),n=yield rn.serviceMetaStore.getItem(ne.STORES.SERVICE_META.KEYS.LAST_META_CALL_TIME),i=(new Date).getTime();return null==n||i-n>ne.META_REFRESH_TIME||(ve.log(1,e,"Last fetch was less than 15 mins ago at ",n),t!==Re().getSdkVersion()?(ve.log(1,e,"Version change detected. Will proceed to fetch latest campaigns"),!0):!(!(t=yield rn.serviceMetaStore.getItem(ne.STORES.SERVICE_META.KEYS.UNIQUE_ID))||t===be.get(r.USER_DATA).deviceUuid||(ve.log(1,e,"Unique device id change detected. Will proceed to fetch latest campaigns"),0)))}))}saveRemoteCampaigns(){return Zn(this,void 0,void 0,(function*(){var e=ei.baseLogTag+".saveRemoteCampaigns",t=(yield rn.campaingsMetaStore.keys())||[];null!=(t=yield this.OnsiteApiClient.getCampaignsMeta(t))&&(yield this.addCampaignsToDB(t.campaignsMeta),ve.log(1,e,"Inapp campaigns meta saved!")),yield rn.serviceMetaStore.setItem(ne.STORES.SERVICE_META.KEYS.GLOBAL_DELAY,t.globalDelayBetweenInapps),yield rn.serviceMetaStore.setItem(ne.STORES.SERVICE_META.KEYS.LAST_FETCH_SDK_VERSION,Re().getSdkVersion())}))}addCampaignsToDB(e){return Zn(this,void 0,void 0,(function*(){var t=ei.baseLogTag+".addCampaignsToDB";ve.log(1,t,`Adding/Updating ${e.length} campaigns in DB`,e.map((e=>e.campaignId)));try{yield Promise.all(e.map((e=>rn.campaingsMetaStore.setItem(e.campaignId,e)))),yield this.rebuildTagStore()}catch(e){ve.error(1,t,"Error saving remote campaigns:",e)}}))}rebuildTagStore(){return Zn(this,void 0,void 0,(function*(){var e=ei.baseLogTag+".rebuildTagStore";try{yield rn.campaingsTagsStore.clear();var t=yield this.getCampaignsFromDB();const e={};for(const n of t)null!=n.tag&&(null==e[n.tag]&&(e[n.tag]=[]),e[n.tag].push(n.campaignId));const n=[];yield rn.campaingsTagsStore.clear();for(const t in e)e.hasOwnProperty(t)&&n.push(rn.campaingsTagsStore.setItem(t,e[t]));yield Promise.all(n)}catch(t){ve.error(1,e,"Error updating tags store:",t)}}))}isExitIntentCampaignFound(e){return e.filter((e=>e.templateType!==dn.SELF_HANDLED&&this.isExitIntentCampaign(e)))}isExitIntentCampaign(e){return"MOE_PAGE_EXIT"===me(e,"triggerData.primary_condition.action_name",null)}prefetchExitIntentCampaigns(e){return Zn(this,void 0,void 0,(function*(){var t=ei.baseLogTag+".prefetchExitIntentCampaigns";const n=yield Kt.createEvent("MOE_EXIT",[]),i=(yield vn(e)).filter((e=>Nn.getFilterResult(n,e)));if(!i||!i.length)return ve.log(1,t,"Exit intent campaign not eligible to prefetch"),!1;{const e=yield this.isCampaignPrefetched(i[0]);if(!e||e.updatedTime.getTime()!==i[0].updatedTime.getTime()){var a=i[0].campaignId;const e=yield this.OnsiteApiClient.getCampaignPayload(i[0]);e.updatedTime=i[0].updatedTime,yield rn.exitIntentCampaignStore.setItem(a,e),ve.log(1,t,"Exit intent campaign prefetched: "+a)}}}))}isCampaignPrefetched(e){return Zn(this,void 0,void 0,(function*(){var t=ei.baseLogTag+".isCampaignPrefetched",n=yield rn.exitIntentCampaignStore.getItem(e.campaignId);return!!n&&(ve.log(1,t,"Prefetched exit intent campaign found: "+e.campaignId),n)}))}refresh(){return Zn(this,void 0,void 0,(function*(){oi.onsite.appId&&(yield di(),ci())}))}}ei.baseLogTag="MoeOnsite",window[ie.INAPP.windowLocation]=ei;var ti=function(e,t,n,i){return new(n=n||Promise)((function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))};const ni="MoEngage";let ii=new ke,ai=new ke;const ri={getData:(e,t)=>{Wt.getWebSDKSettings().then((n=>{ii.p.then((n=>{n.getData(e,t)}))}))},registerCallback:(e,t)=>{Wt.getWebSDKSettings().then((n=>{ii.p.then((n=>{n.registerCallback(e,t)}))}))}};class oi{static callWebPush(e){const t=ni+".callWebPush";Wt.getWebSDKSettings().then((n=>{var i,a,r,o,s,l,c;n.isConfigured?n.optInConfig.type===ht.TYPE.SELF_HANDLED?(ve.log(1,t,"Starting web push functions"),null!=e&&(st.setSoftAskConfig(e),i=me(e,"soft_ask_display_callback",null),a=me(e,"soft_ask_allow_callback",null),r=me(e,"soft_ask_block_callback",null),o=me(e,"hard_ask_allow_callback",null),s=me(e,"hard_ask_dismiss_callback",null),l=me(e,"hard_ask_block_callback",null),c=k,Yt.addCallback(c.SOFT_ASK_SHOWN,i),Yt.addCallback(c.SOFT_ASK_ALLOWED,a),Yt.addCallback(c.SOFT_ASK_DISMISSED,r),Yt.addCallback(c.HARD_ASK_ALLOWED,o),Yt.addCallback(c.HARD_ASK_DISMISSED,s),Yt.addCallback(c.HARD_ASK_DENIED,l)),Xe.getInstance().then((e=>{new tn(n,e).callWebPush()}))):ve.warn(1,t,"This feature can only be used when you have chosed self-handled approach in the dashboard. You can check dashboard here:",X):ve.log(1,t,"Web push settings not configured on dashboard yet. To start web push subscriptions, please configure the settings on dashboard.")}))}static showNotification(e){Wt.getWebSDKSettings().then((t=>{Xe.getInstance().then((n=>{new tn(t,n).showNotification(e)}))}))}static getSdkVersion(){return"2.8.58"}static setDebugLevel(e){return ti(this,void 0,void 0,(function*(){try{"number"==typeof e&&(!st.get().disableOnsite&&oi.onsite.setLogLevel&&oi.onsite.setLogLevel(e),Wt.getWebSDKSettings().then((t=>{null!=t&&t.c_s&&oi.cards&&oi.cards.setLogLevel(e),"allowed"===(null==t?void 0:t.c_w_p_e)&&window.MoeWebP&&window.MoeWebP.setLogLevel&&window.MoeWebP.setLogLevel(e),ve.setLogLevel(e,!0)})))}catch(e){ve.error(0,"MoEngage.setDebugLevel","Error changing log level:",e)}}))}static vitals(){var e=yt.getSync();return{deviceUuid:e.deviceUuid,userDetails:e,pushToken:be.get(r.PUSH_TOKEN),softAskStatus:be.get(r.SOFT_ASK_STATUS),hardAskStatus:be.get(r.HARD_ASK_STATUS)}}static help(){var e=ni+".help";ve.log(0,e,"Moengage Dashboard - ",z.MOE_DASHBOARD);for(const t in z)z.hasOwnProperty(t)&&ve.log(0,e,t,"-",z[t])}static track_event(e,t){return Vt.track(e,t)}static add_unique_user_id(e){return ti(this,void 0,void 0,(function*(){var t=yield en.login(e);return st.get(),Wt.getWebSDKSettings().then((e=>{null!=e&&e.c_s&&oi.cards&&(ve.log(1,"Moengage.add_unique_user_id","Fetching new Cards after login"),oi.cards.refreshCards())})),t}))}static update_unique_user_id(e){return en.updateUniqueId(e)}static add_user_attribute(e,t){return en.addAttribute(e,t)}static add_first_name(e){return en.addAttribute("first_name",e)}static add_last_name(e){return en.addAttribute("last_name",e)}static add_email(e){return en.addAttribute("email",e)}static add_mobile(e){return en.addAttribute("mobile",e)}static add_user_name(e){return en.addAttribute("name",e)}static add_gender(e){return en.addAttribute("gender",e)}static add_birthday(e){return en.addAttribute("birthday",e)}static destroy_session(){return oi.user.logout()}static call_web_push(e){oi.callWebPush(e)}static getBranch(){return"master"}static track_page_view(){return Vt.track(l,{timestamp:Number(Date.now())}),Vt.track(c,{timestamp:Number(Date.now())})}}oi.user=en,oi.event=Vt,oi.device=class{static getUuid(){return be.get(r.USER_DATA).deviceUuid}static getPushToken(){return be.get(r.PUSH_TOKEN)}static getPermissionState(e){return new Promise(((t,n)=>{Wt.getWebSDKSettings().then((i=>{Xe.getInstance().then((a=>{new tn(i,a).getPermissionState().then((n=>{t(n),e&&e(null,n)})).catch((t=>{n(t),e&&e(t,null)}))}))}))}))}},oi.onsite=ri,oi.reports=Lt.reports;var si=()=>{};const li={track_event:si,add_user_attribute:si,add_first_name:si,add_last_name:si,add_email:si,add_mobile:si,add_user_name:si,add_gender:si,add_birthday:si,destroy_session:si,add_unique_user_id:si,moe_events:si,location_type_attribute:si,call_web_push:si};function ci(){var e;oi.onsite.appId||(e=st.get(),oi.onsite=new ei(e),ii.res(oi.onsite),oi.onsite.initialize())}function di(){return ti(this,void 0,void 0,(function*(){oi.onsite.appId&&(ve.log(1,"Moengage.disableOnsiteApi","logging out from inapp module"),yield oi.onsite.logout(),ii=new ke,oi.onsite=ri)}))}class ui{onWindowVisibilityChange(e,t){fe.set("isWindowActive",!0),document.addEventListener("focus",(()=>{n(!0)}),!1),document.addEventListener("blur",(()=>{n(!1)}),!1),window.addEventListener("focus",(()=>{n(!0)}),!1),window.addEventListener("blur",(()=>{"IFRAME"!==document.activeElement.tagName&&n(!1)}),!1);const n=e=>"boolean"==typeof e?a(e?"visible":"hidden"):document.hidden?a("hidden"):a("visible");var i=t=>{fe.set("isWindowActive","visible"===t),e(t)};const a=t?i:((e,t,n)=>{let i=0;return function(...t){const n=this;clearTimeout(i),i=setTimeout((()=>{i=null,e.apply(n,t)}),250)}})(i);window.addEventListener("visibilitychange",n,!1)}}ui.baseLogTag="WindowEventManager";var gi=function(e,t,n,i){return new(n=n||Promise)((function(a,r){function o(e){try{l(i.next(e))}catch(e){r(e)}}function s(e){try{l(i.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?a(e.value):((t=e.value)instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((i=i.apply(e,t||[])).next())}))};class hi{static initialize(){return gi(this,void 0,void 0,(function*(){var e;return null==hi.ready&&(hi.campaignStore=pe.createInstance({driver:[pe.INDEXEDDB,pe.WEBSQL,pe.LOCALSTORAGE],name:de,storeName:ue.STORE_NAME}),hi.metaStore=pe.createInstance({driver:[pe.INDEXEDDB,pe.WEBSQL,pe.LOCALSTORAGE],name:de,storeName:ge.STORE_NAME}),e=[hi.campaignStore.ready(),hi.metaStore.ready()],hi.ready=Promise.all(e)),hi.ready}))}static clear(){return gi(this,void 0,void 0,(function*(){var e=hi.baseLogTag+".clear";try{yield hi.initialize(),yield Promise.all([hi.campaignStore.clear(),hi.metaStore.clear()]);var t=[hi.campaignStore.ready(),hi.metaStore.ready()];hi.ready=Promise.all(t)}catch(t){ve.error(1,e,"Error clearing cards stores:",t)}return hi.ready}))}}let pi;hi.baseLogTag="MOE_CARDS_STORES";const mi=()=>new Promise((e=>{"complete"!==window.document.readyState?window.addEventListener("load",(()=>{e(!0)})):e(!0)}));window&&(window.moe=function(e){const t="Pre-Initialization";if(ve.log(1,t,"Init data: ",e),"undefined"==typeof Promise)return ve.error(1,t,"Promises not supported"),li;if(e.app_id||e.appId){var n=fi();return n&&(e=Object.assign({},e,n)),st.save(e),mi().then((()=>{Bt.broadcastToWindow({topic:N,name:R.MOE_INIT,data:st.get()}),pe.createInstance({driver:[pe.INDEXEDDB,pe.WEBSQL,pe.LOCALSTORAGE],name:$,storeName:Z}).clear(),ve.setLogLevel(st.get().debugLevel),ve.log(1,t,"Script loaded!"),ve.customLabel(1,t,"SDK Version","2.8.58"),0<st.get().debugLevel&&(ve.warn(1,t,"You are currently using MoEngage in debug environment. You'll find all the data captured in this environment in the TEST mode on the dashoard."),ve.warn(1,t,"Please initialize with debugLevel as",0,"when using on your production environment.")),Si()})),e=window.moengage_object||"Moengage",window[e]=oi,oi}return ve.error(1,t,"App Id not specified. Please check docs page to complete the integration - ",z.WEBSDK_DOCS),li},window.moeBannerText="banner",window[te]=jt);const fi=()=>{try{var e=localStorage.getItem("moe_segment_cluster"),t=localStorage.getItem("moe_segment_sw_path"),n=localStorage.getItem("moe_segment_sw_scope");const i={};return e&&(i.cluster=e),t&&(i.swPath=t),n&&(i.swScope=n),!!(e||t||n)&&(ve.log(1,".isSegmentDataFound","Data found for segment initialisation",i),i)}catch(e){return!1}},Si=()=>{const e="Initialization";return new Promise((t=>{Wt.getWebSDKSettings().then((n=>{n.isDomainLevelStorage&&(be.isSharedWithCookie=!0,be.copyKeysFromCookie()),"allowed"===n.s_e_b_e&&(Ot.initialize(),Lt.init(n)),yt.get().then((i=>{if(Jt.get().deviceToLogout===i.deviceUuid)return ve.log(1,e,"User was not able to logout last time. Completing the logout now and starting new session."),oi.user.logout();i.deviceAdded&&Wt.onDeviceAdd.res(),n.isPushSubBilling&&ve.warn(1,e,"You are under push subscriber based billing plan. We are only tracking users with an email, phone number or have subscribed to web push. All user attributes and events will be stored in a queue till we receive either of the properties.");var a=new qe;(new ui).onWindowVisibilityChange(a.handleBrowserInactivity,n.s_s_d),ve.customLabel(1,e,"Device UUID",i.deviceUuid),ve.customLabel(1,e,"Device Added",i.deviceAdded),Bt.broadcastToWindow({topic:N,name:R.SETTINGS_FETCHED,data:n}),n.isPushSubBilling||i.deviceAdded||Wt.deviceAdd(),oi.track_page_view(),Ft.clear(r.Q.DEVICE),Ft.clear(r.Q.REPORT),st.get().enableSPA&&!pi&&Ei(),Xe.getInstance().then((t=>{const i=new tn(n,t);var a=!(null!==(a=window.MoeWebP)&&void 0!==a&&a.isEditorModeEnabled());i.isWebPushEnabled()&&a?0<=[ht.TYPE.ONE_CLICK,ht.TYPE.TWO_STEP].indexOf(n.optInConfig.type)?i.callWebPush():(ve.log(1,e,"Self handled setting. Will show opt-in on manual invocation, if required."),i.getPermissionState().then((t=>{var n=be.get(r.PUSH_TOKEN);(t===Ge.GRANTED||null!=n&&t===Ge.DENIED)&&(t===Ge.GRANTED&&ve.log(1,e,"Notification permission already granted. Proceeding to subscribe the user"),i.callWebPush())})).catch((t=>{ve.warn(1,e,"Cannot get permission state: ",t)}))):tn.SUPPORTED_BROWSERS.indexOf(t.name)<0?ve.warn(1,e,"Web push not supported on this browser. Supported browsers are:\n\t\t1. Google Chrome\n\t\t2. Mozilla Firefox\n\t\t3. Opera\n\t\t4. Edge\n\t\t5. Safari 16 and above + macOS 13 and above"):ve.warn(1,e,"Web push feature not enabled for current environment"),!st.get().disableOnsite&&a?Wt.onDeviceAdd.p.then((()=>{ci()})):ve.warn(1,e,"Onsite is disabled in this page since `disableOnsite: true` is passed during initialization."),null!=n&&n.c_s&&a?nn.loadModule(ie.CARDS).then((e=>{ai.res(e),e.initialize(),oi.cards=e})).catch((e=>{ai.rej(e)})):hi.clear(),vi()})),t(!0)}))}))}))},vi=()=>{const e="Moengage.clearWindowQ";mi().then((()=>{try{var t=window.moengage_object||"Moengage";if(window[t]&&window.moengage_q){let i=window.moengage_q;if(window.moengage_q=[],i&&0<i.length&&window[t])for(let t=0;t<i.length;t++){ve.log(1,e,"Method called before SDK downloaded:",[i[t].f],i[t].a);var n=i[t].f;"onsite.getData"===n?oi.onsite.getData(...i[t].a):"onsite.registerCallback"===n?oi.onsite.registerCallback(...i[t].a):null!=oi[i[t].f]&&oi[i[t].f].apply(null,i[t].a)}i=[]}}catch(t){ve.error(1,e,t)}}))},Ei=()=>{const e="startSpaUrlHandler";let t=document.location.href;(()=>{pi=!0,ve.log(1,e,"Start listening to URL changes");const n=document.querySelector("body"),i=new MutationObserver((n=>{n.forEach((n=>{t!==document.location.href&&(t=document.location.href,ve.log(1,e,"URL Change detected",t),(()=>{const e=window.Moengage;if(e.onsite.displayManager){e.onsite.triggerManager&&e.onsite.triggerManager.eventNameCampaignHash.MOE_PAGE_SCROLL&&(window.removeEventListener("scroll",e.onsite.triggerManager.getScrollListenerCallback()),e.onsite.triggerManager.setScrollListenerCallback(e.onsite.triggerManager.getWindowEventManager().onScroll(e.onsite.triggerManager.onScroll)));const{displayManager:t,triggerManager:n}=e.onsite,i=Object.keys(t.campaignRenderMap);n&&(n.scrollCampaignTriggered=!1),i.forEach((e=>{document.getElementById("moe-onsite-campaign-"+e)&&document.getElementById("moe-onsite-campaign-"+e).remove(),t.campaignRenderMap[e].isActive()&&t.dismissInapp(e),clearTimeout(t.campaignRenderMap[e].delayTimer),delete t.campaignRenderMap[e],t.campaignRenderOrder=t.campaignRenderOrder.filter((t=>t!==e))})),Ce()&&e.onsite.triggerManager.windowEventManager.isPopStateEventBound&&setTimeout((()=>{e.onsite.triggerManager.windowEventManager.setHistoryState(),e.onsite.triggerManager.windowEventManager.isExitIntentShown=!1}),0)}})(),oi.track_page_view(),Wt.getWebSDKSettings().then((t=>{null!=t&&t.c_s&&oi.cards&&oi.cards.checkCacheAndSaveRemote(he),"allowed"===(null==t?void 0:t.c_w_p_e)&&(null!==(t=window.MoeWebP)&&void 0!==t&&t.handleLiveExperience(),ve.log(1,e,"webP sync function called"))})))}))}));i.observe(n,{childList:!0,subtree:!0})})()}})()})();